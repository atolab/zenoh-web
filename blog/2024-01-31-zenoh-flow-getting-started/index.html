<!doctype html><html lang=en><head><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.png><meta name=msapplication-TileImage content="/safari-pinned-tab.png"><meta name=msapplication-TileColor content="#7da7d8"><meta name=theme-color content="#7da7d8"><meta charset=utf-8><meta name=description content="Eclipse Zenoh, unify data in motion, data at rest and computations."><meta name=keywords content="pub/sub,query,geo distributed storage,Rust,protocol,DDS,MQTT,Edge,IoT,MEC"><meta name=author content="The Zenoh Team"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta http-equiv=x-ua-compatible content="ie=edge"><link rel=stylesheet href=../../css/bootstrap-reboot.css><link rel=stylesheet href=../../css/bootstrap.css><link rel=stylesheet href=../../css/font-awesome.min.css><link rel=stylesheet href=../../css/ato.css><link rel=stylesheet href=../../css/syntax.css><link rel=alternate type=application/rss+xml href=../../blog/index.xml><title>Zenoh-Flow 0.6.0-rc: Getting Started · Zenoh - pub/sub, geo distributed storage, query</title></head><body><header class="navbar-expand navbar-dark d-flex flex-column flex-md-row align-items-md-center ato-navbar"><div class="d-flex flex-row justify-content-between pl-2 pr-2"><a class=navbar-brand href=../../><img src=../../img/zenoh-dragon-bg-150x163.png class=align-middle alt></a>
<button class="btn btn-link d-md-none p-0" type=button data-toggle=collapse data-target=#ato-nav aria-controls=ato-nav aria-expanded=false aria-label="Toggle navigation"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 30 30" width="30" height="30" focusable="false"><title>Menu</title><path stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-miterlimit="10" d="M4 7h22M4 15h22M4 23h22"/></svg></button></div><div class="ato-links collapse pl-4 pl-md-0" id=ato-nav><ul class="navbar-nav flex-column flex-md-row"><li class=nav-item><a class=nav-link href=../../>Home</a></li><li class=nav-item><a class=nav-link href=../../docs/getting-started/first-app/>Documentation</a></li><li class=nav-item><a class=nav-link href=../../usecases/>Use Cases</a></li><li class=nav-item><a class=nav-link href=../../community/>Community</a></li><li class=nav-item><a class=nav-link href=../../adopters/>Adopters</a></li><li class=nav-item><a class=nav-link href=../../media/>Media</a></li><li class=nav-item><a class="nav-link active" href=../../blog/2024-12-12-zenoh-firesong-1.1.0/>Blog</a></li></ul></div><ul class="navbar-nav flex-row ml-md-auto d-none d-md-flex"><li class=nav-item><a class="nav-link p-2" href=https://github.com/eclipse-zenoh/zenoh target=_blank rel=noopener aria-label=GitHub><svg class="navbar-nav-svg" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 512 499.36" focusable="false"><title>GitHub</title><path d="M256 0C114.64.0.0 114.61.0 256c0 113.09 73.34 209 175.08 242.9 12.8 2.35 17.47-5.56 17.47-12.34.0-6.08-.22-22.18-.35-43.54-71.2 15.49-86.2-34.34-86.2-34.34-11.64-29.57-28.42-37.45-28.42-37.45-23.27-15.84 1.73-15.55 1.73-15.55 25.69 1.81 39.21 26.38 39.21 26.38 22.84 39.12 59.92 27.82 74.5 21.27 2.33-16.54 8.94-27.82 16.25-34.22-56.84-6.43-116.6-28.43-116.6-126.49.0-27.95 10-50.8 26.35-68.69-2.63-6.48-11.42-32.5 2.51-67.75.0.0 21.49-6.88 70.4 26.24a242.65 242.65.0 01128.18.0c48.87-33.13 70.33-26.24 70.33-26.24 14 35.25 5.18 61.27 2.55 67.75 16.41 17.9 26.31 40.75 26.31 68.69.0 98.35-59.85 120-116.88 126.32 9.19 7.9 17.38 23.53 17.38 47.41.0 34.22-.31 61.83-.31 70.23.0 6.85 4.61 14.81 17.6 12.31C438.72 464.97 512 369.08 512 256.02 512 114.62 397.37.0 256 0z" fill="currentcolor" fill-rule="evenodd"/></svg></a></li><li class=nav-item><a class="nav-link p-2" href=https://twitter.com/zettascaletech target=_blank rel=noopener aria-label=Twitter><svg class="navbar-nav-svg" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 512 416.32" focusable="false"><title>Twitter</title><path d="M160.83 416.32c193.2.0 298.92-160.22 298.92-298.92.0-4.51.0-9-.2-13.52A214 214 0 00512 49.38a212.93 212.93.0 01-60.44 16.6 105.7 105.7.0 0046.3-58.19 209 209 0 01-66.79 25.37 105.09 105.09.0 00-181.73 71.91 116.12 116.12.0 002.66 24c-87.28-4.3-164.73-46.3-216.56-109.82A105.48 105.48.0 0068 159.6a106.27 106.27.0 01-47.53-13.11v1.43a105.28 105.28.0 0084.21 103.06 105.67 105.67.0 01-47.33 1.84 105.06 105.06.0 0098.14 72.94A210.72 210.72.0 0125 370.84a202.17 202.17.0 01-25-1.43 298.85 298.85.0 00160.83 46.92" fill="currentcolor"/></svg></a></li><li class=nav-item><a class="nav-link p-2" href=https://discord.gg/2GJ958VuHs target=_blank rel=noopener aria-label=Discord><svg class="navbar-nav-svg" xmlns="http://www.w3.org/2000/svg" focusable="false"><title>Discord</title><path fill="currentcolor" d="M13.545 2.907a13.227 13.227.0 00-3.257-1.011.05.05.0 00-.052.025c-.141.25-.297.577-.406.833a12.19 12.19.0 00-3.658.0 8.258 8.258.0 00-.412-.833.051.051.0 00-.052-.025c-1.125.194-2.22.534-3.257 1.011a.041.041.0 00-.021.018C.356 6.024-.213 9.047.066 12.032c.001.014.01.028.021.037a13.276 13.276.0 003.995 2.02.05.05.0 00.056-.019c.308-.42.582-.863.818-1.329a.05.05.0 00-.01-.059.051.051.0 00-.018-.011 8.875 8.875.0 01-1.248-.595.05.05.0 01-.02-.066.051.051.0 01.015-.019c.084-.063.168-.129.248-.195a.05.05.0 01.051-.007c2.619 1.196 5.454 1.196 8.041.0a.052.052.0 01.053.007c.08.066.164.132.248.195a.051.051.0 01-.004.085 8.254 8.254.0 01-1.249.594.05.05.0 00-.03.03.052.052.0 00.003.041c.24.465.515.909.817 1.329a.05.05.0 00.056.019 13.235 13.235.0 004.001-2.02.049.049.0 00.021-.037c.334-3.451-.559-6.449-2.366-9.106a.034.034.0 00-.02-.019zm-8.198 7.307c-.789.0-1.438-.724-1.438-1.612.0-.889.637-1.613 1.438-1.613.807.0 1.45.73 1.438 1.613.0.888-.637 1.612-1.438 1.612zm5.316.0c-.788.0-1.438-.724-1.438-1.612.0-.889.637-1.613 1.438-1.613.807.0 1.451.73 1.438 1.613.0.888-.631 1.612-1.438 1.612z"/></svg></a></li><li class=nav-item><a class="nav-link p-2" href=https://www.youtube.com/channel/UCslbiyiqgOAPMjCrPWIfQ5Q target=_blank rel=noopener aria-label=Youtube><svg class="navbar-nav-svg" xmlns="http://www.w3.org/2000/svg" focusable="false"><title>Youtube</title><path fill="currentcolor" d="M8.051 1.999h.089c.822.003 4.987.033 6.11.335a2.01 2.01.0 011.415 1.42c.101.38.172.883.22 1.402l.01.104.022.26.008.104c.065.914.073 1.77.074 1.957v.075c-.001.194-.01 1.108-.082 2.06l-.008.105-.009.104c-.05.572-.124 1.14-.235 1.558a2.007 2.007.0 01-1.415 1.42c-1.16.312-5.569.334-6.18.335h-.142c-.309.0-1.587-.006-2.927-.052l-.17-.006-.087-.004-.171-.007-.171-.007c-1.11-.049-2.167-.128-2.654-.26a2.007 2.007.0 01-1.415-1.419c-.111-.417-.185-.986-.235-1.558L.09 9.82.082 9.716A31.4 31.4.0 010 7.68v-.123c.002-.215.01-.958.064-1.778l.007-.103.003-.052.008-.104.022-.26.01-.104c.048-.519.119-1.023.22-1.402a2.007 2.007.0 011.415-1.42c.487-.13 1.544-.21 2.654-.26l.17-.007.172-.006.086-.003.171-.007A99.788 99.788.0 017.858 2h.193zM6.4 5.209v4.818l4.157-2.408L6.4 5.209z"/></svg></a></li></ul><script async src="https://www.googletagmanager.com/gtag/js?id=G-PBD6MS51QL"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-PBD6MS51QL")</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":""},"articleSection":"blog","name":"Zenoh-Flow 0.6.0-rc: Getting Started","headline":"Zenoh-Flow 0.6.0-rc: Getting Started","datePublished":"2024-01-31 00:00:00 \u002b0000 UTC","dateModified":"2024-01-31 00:00:00 \u002b0000 UTC","url":"\/blog\/2024-01-31-zenoh-flow-getting-started\/","inLanguage":"en-US","author":"","creator":"","publisher":"","accountablePerson":"","copyrightHolder":"","copyrightYear":"313131","wordCount":"3108","keywords":[],"description":"31 January 2024 -- Paris."}</script></header><div class="container-fluid ato-blog"><div class="row flex-xl-nowrap"><div class="col-12 col-md-3 col-xl-2 ato-sidebar"><div class="ato-docs-toggle d-md-none p-0 d-flex ml-3 collapsed align-item-center"><h1 class=ato-title>Zenoh-Flow 0.6.0-rc: Getting Started</h1><button class="btn btn-link" type=button data-toggle=collapse data-target=#ato-docs-nav aria-controls=ato-docs-nav aria-expanded=false aria-label="Toggle docs navigation"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 30 30" width="30" height="30" focusable="false"><title>Menu</title><path stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-miterlimit="10" d="M4 7h22M4 15h22M4 23h22"/></svg></button></div><nav class="ato-links collapse" id=ato-docs-nav><div class="ato-toc-item active"><p class=ato-toc-link>Blog Posts</p><ul class="nav ato-sidenav"><li><a href=../../blog/2024-12-12-zenoh-firesong-1.1.0/>Zenoh 1.1.0: Firesong Keeps Rocking 🎸</a></li><li><a href=../../blog/2024-10-21-zenoh-firesong/>Zenoh 1.0.0 "Firesong" is ready to rock!</a></li><li><a href=../../blog/2024-04-30-zenoh-electrode/>Zenoh 0.11.0 "Electrode" release is out!</a></li><li><a href=../../blog/2024-04-17-datadog-zenoh-router-integration/>Streamlining Zenoh router Monitoring with Datadog Integration</a></li><li><a href=../../blog/2024-01-31-zenoh-flow-getting-started/>Zenoh-Flow 0.6.0-rc: Getting Started</a></li><li><a href=../../blog/2023-10-03-zenoh-dragonite/>Zenoh Dragonite Took Off!</a></li><li><a href=../../blog/2023-07-17-s3-backend/>Zenoh Storage Gets a Boost: Empowering Storage with S3 Integration</a></li><li><a href=../../blog/2023-06-05-charmander2/>Zenoh Charmander Grows Stronger</a></li><li><a href=../../blog/2023-04-04-letsencrypt/>Securing Zenoh with LetsEncrypt: A Comprehensive Guide</a></li><li><a href=../../blog/2023-03-21-zenoh-vs-mqtt-kafka-dds/>Comparing the Performance of Zenoh, MQTT, Kafka, and DDS</a></li><li><a href=../../blog/2023-02-10-zenoh-flow/>Data Flow programming with Zenoh-Flow</a></li><li><a href=../../blog/2023-01-17-zenoh-wireshark/>The Blue Dragon meets the Wire’s Shark</a></li><li><a href=../../blog/2023-01-10-zenoh-charmander/>Zenoh Charmander is coming to town</a></li><li><a href=../../blog/2022-11-29-zenoh-alignment/>Keeping storages aligned in Zenoh</a></li><li><a href=../../blog/2022-09-30-zenoh-bahamut/>Zenoh Bahamut takes flight!</a></li><li><a href=../../blog/2022-08-12-zenoh-serial/>There is Land Besides IP: How to Cross It with Zenoh</a></li><li><a href=../../blog/2022-06-09-zenoh-pico-above-and-beyond/>Zenoh-Pico: Above and Beyond</a></li><li><a href=../../blog/2022-04-14-rust-async-eval/>A Performance Evaluation on Rust Asynchronous Frameworks</a></li><li><a href=../../blog/2022-03-30-zenoh-mobility/>Mobility, Latency and Energy saving</a></li><li><a href=../../blog/2022-02-08-dragonbot/>DragonBotOne Egg Hatching with Zenoh and Zenoh-Pico</a></li><li><a href=../../blog/2021-11-09-ros2-zenoh-pico/>ROS 2 and microcontrollers integration via Zenoh-pico</a></li><li><a href=../../blog/2021-10-04-zenoh-pico-guide/>Zenoh goes embedded with zenoh-pico</a></li><li><a href=../../blog/2021-09-28-iac-experiences-from-the-trenches/>Indy Autonomous Challenge (IAC): Experiences from the Trenches</a></li><li><a href=../../blog/2021-07-13-zenoh-performance-async/>Zenoh performance: a stroll in Rust async wonderland</a></li><li><a href=../../blog/2021-07-05-zenoh-overhead/>Zenoh overhead: a story from our community</a></li><li><a href=../../blog/2021-06-14-zenoh-reliability/>Zenoh Reliability, Scalability and Congestion Control</a></li><li><a href=../../blog/2021-04-28-ros2-integration/>Integrating ROS2 with Eclipse zenoh</a></li><li><a href=../../blog/2021-03-23-discovery/>Minimizing Discovery Overhead in ROS2</a></li><li><a href=../../blog/2020-10-08-aithusa/>Zenoh Aithusa Hatched Out!</a></li><li><a href=../../blog/2020-06-29-zenoh-tidings/>Zenoh Tidings</a></li><li><a href=../../blog/2020-01-01-zenohtude/>A Year Full of Zenoh</a></li></ul></div></nav></div><div class="d-none d-xl-block col-xl-2 ato-toc"><div class=section-nav><nav id=TableOfContents><ul><li><a href=#data-flow-descriptor>Data Flow Descriptor</a></li><li><a href=#node-implementation>Node Implementation</a></li><li><a href=#execution-model-data-driven>Execution Model: Data-Driven</a></li><li><a href=#launching-a-data-flow>Launching a Data Flow</a><ul><li><a href=#with-the-standalone-runtime>With the Standalone Runtime</a></li><li><a href=#with-the-standalone-daemon>With the Standalone Daemon</a></li></ul></li><li><a href=#conclusion>Conclusion</a></li></ul></nav></div></div><main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 ato-content ato-docs"><h1 class=ato-title>Zenoh-Flow 0.6.0-rc: Getting Started</h1><p class=ato-date>31 January 2024 -- Paris.</p><p>At ZettaScale, we are developing a next-generation middleware called <a href=https://zenoh.io/docs/getting-started/first-app/>Zenoh</a>. Zenoh gained a lot of traction with very positive feedback from diverse industries, including Robotics, Industrial Automation, Automotive and more. If you haven’t tried it yet and you think it could help you, don’t hesitate, we guarantee it’s easy and worth your time!</p><p>This blog post will focus on another exciting project we are building: Zenoh-Flow. As its name indicates, Zenoh-Flow brings together the control of data flow programming and the power of Zenoh. Think of distributed applications where you don’t have to know the exact location of your computing units, but simply agree on the name (and type) of the resources they are going to exchange, how they are connected and, if needed, the properties of the host(s) on which they are going to run. Add to this list a validation step, uniquely named resources, great performance and you would start to have a good idea of what Zenoh-Flow has to offer!</p><style>#callout{padding:1.5em 1.25em;border-radius:3px;border-color:#0a143c;border:1px transparent;display:flex;max-width:80%;flex-direction:row;margin-bottom:20px;font-size:small;background-color:#fcfcfd}#callout-inner{margin-left:1em;margin-right:1.5em}@media(max-width:767px){#callout{padding:1.5em .75em 1.5em .6em}#callout-inner{margin-left:.5em}}</style><div id=callout><div>💡️</div><div id=callout-inner>If you want an introduction to the core concepts of Zenoh-Flow and motivating use-cases, we have written a <a href=https://zenoh.io/blog/2023-02-10-zenoh-flow/>blog post</a> earlier that we invite you to read — we might skip explaining few concepts that we introduced before.</div></div><p>Let us dive in!</p><figure class=figure-inline><img src=../../img/20240131-Zenoh-Flow-Getting-Started/zf-getting-started.png alt="Data Flow descriptor" width=100% height=auto></figure><h1 id=zenoh-flow-060-rc-getting-started>Zenoh-Flow 0.6.0-rc: Getting Started</h1><style>#callout{padding:1.5em 1.25em;border-radius:3px;border-color:#0a143c;border:1px transparent;display:flex;max-width:80%;flex-direction:row;margin-bottom:20px;font-size:small;background-color:#fcfcfd}#callout-inner{margin-left:1em;margin-right:1.5em}@media(max-width:767px){#callout{padding:1.5em .75em 1.5em .6em}#callout-inner{margin-left:.5em}}</style><div id=callout><div>💡️</div><div id=callout-inner>All the code examples given below work with the tagged version <code>blog-post-31-01-2024</code>. We will update this blog post once we have released Zenoh-Flow 0.6.0-rc. To clone this version you can use the following command:<br><code>git clone https://github.com/eclipse-zenoh/zenoh-flow --branch blog-post-31-01-2024 --depth 1</code></div></div><p>To facilitate the discovery of Zenoh-Flow we have included in the repository an example data flow called “getting started”. Similar to the very first program you write in every programming language, its purpose is to print a sentence akin to “Hello, world!”. However, as we are building a data flow and using Zenoh, we have to introduce slightly more logic and we have to make our flow interact via Zenoh.</p><p>Hence, our getting started will subscribe to the resource <code>zf/getting-started/hello</code> &mdash; a Source &mdash; in the hope of receiving names, then it will forward this name to a node that will generate a greeting &mdash; an Operator &mdash; and finally forward the generated greeting to be both published on Zenoh, on the resource <code>zf/getting-started/greeting</code>, and written to a file &mdash; two Sinks.</p><p>This flow is already written in the file: <code>zenoh-flow/examples/flows/getting-started.yaml</code>.</p><h2 id=data-flow-descriptor>Data Flow Descriptor</h2><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#309;font-weight:700>name</span>:<span style=color:#bbb> </span>getting-started<span style=color:#bbb>
</span></span></span></code></pre></div><p><strong>[Required]</strong> We start with the name of the data flow. It is a human-readable summary of what your data flow will do. Zenoh-Flow will use it when displaying information regarding its status.</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#309;font-weight:700>vars</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#309;font-weight:700>TARGET_DIR</span>:<span style=color:#bbb> </span><span style=color:#c30>&#34;/home/zettascale/zenoh-flow/target&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#309;font-weight:700>BUILD</span>:<span style=color:#bbb> </span><span style=color:#c30>&#34;debug&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#309;font-weight:700>DLL_EXTENSION</span>:<span style=color:#bbb> </span><span style=color:#c30>&#34;so&#34;</span><span style=color:#bbb>
</span></span></span></code></pre></div><p><strong>[Optional]</strong> The “variables” section. They allow performing text replacements inside a descriptor and any of its nested descriptor(s) before your data flow is processed by Zenoh-Flow. This is useful if, for instance, you regularly switch between machines with different paths, operating system and build.</p><p>To indicate that you are using one such variable in your descriptor, you have to escape it between “moustaches” like so: <code>{{ TARGET_DIR }}</code>.</p><p>The standalone Zenoh-Flow runtime and daemon allow to change these variables through a command line argument if you want to manipulate them in scripts.</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#309;font-weight:700>sources</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:#309;font-weight:700>id</span>:<span style=color:#bbb> </span>zenoh-sub<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#309;font-weight:700>description</span>:<span style=color:#bbb> </span>The Source receiving the names<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#309;font-weight:700>zenoh-subscribers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#309;font-weight:700>hello</span>:<span style=color:#bbb> </span><span style=color:#c30>&#34;zf/getting-started/hello&#34;</span><span style=color:#bbb>
</span></span></span></code></pre></div><p><strong>[Required]</strong> The sources section lists all the nodes that feed data to your data flow. Sensors or “events” (e.g. a publication on a Zenoh resource) are good examples. Without sources a data flow can never process data as it will never receive any.</p><p>The <code>id</code> has to be unique within your data flow. The same applies to other nodes.</p><p>This source is a specific built-in Zenoh-Flow provides, it is a Zenoh subscriber. It is ready to be used inside any data flow and simply expects a <code>description</code> and an association list <code>port-id: key-expression</code>.</p><p>The <code>port-id</code> has to be unique within the <code>zenoh-subscribers</code> subsection. More specifically, a <code>port-id</code> has to be unique per node and per port type (i.e. input or output). Which means the same <code>port-id</code> can be repeated between different nodes and within the same node as long as it applies to different port types. Here the zenoh-subscribers map to outputs.</p><p>Regular Zenoh-Flow sources (i.e. where you have to provide an implementation) follow the same structure as operators with the only exception that a source does not have an <code>inputs</code> subsection.</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#309;font-weight:700>operators</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:#309;font-weight:700>id</span>:<span style=color:#bbb> </span>greetings-maker<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#309;font-weight:700>description</span>:<span style=color:#bbb> </span><span style=color:#c30>&#34;This node will create the greeting, transforming for instance &#39;John&#39; to: &#39;Hello, John!&#39;&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#309;font-weight:700>library</span>:<span style=color:#bbb> </span><span style=color:#c30>&#34;file://{{ TARGET_DIR }}/{{ BUILD }}/examples/libgreetings_maker.{{ DLL_EXTENSION }}&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#309;font-weight:700>inputs</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span>- name<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#309;font-weight:700>outputs</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span>- greeting<span style=color:#bbb>
</span></span></span></code></pre></div><p><strong>[Required]</strong> The operators section lists all the nodes that manipulate data. They receive data in their <code>inputs</code>, manipulate them, and send the results in their <code>outputs</code>.</p><p>The <code>library</code> subsection points to the shared library where the implementation resides. For now, only the <code>file://</code> schema is supported which means that the path has to be valid <em>on the machine where the operator will run</em>.</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#309;font-weight:700>sinks</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:#309;font-weight:700>id</span>:<span style=color:#bbb> </span>file-writer<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#309;font-weight:700>configuration</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#309;font-weight:700>file</span>:<span style=color:#bbb> </span><span style=color:#c30>&#34;/tmp/greetings.txt&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#309;font-weight:700>library</span>:<span style=color:#bbb> </span><span style=color:#c30>&#34;file://{{ TARGET_DIR }}/{{ BUILD }}/examples/libfile_writer.{{ DLL_EXTENSION }}&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#309;font-weight:700>description</span>:<span style=color:#bbb> </span><span style=color:#c30>&#34;This Sink will write the greetings in a temporary file.&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#309;font-weight:700>inputs</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span>- in<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:#309;font-weight:700>id</span>:<span style=color:#bbb> </span>zenoh-writer<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#309;font-weight:700>description</span>:<span style=color:#bbb> </span>The Sink publishing the result of the processing<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#309;font-weight:700>zenoh-publishers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#309;font-weight:700>greeting</span>:<span style=color:#bbb> </span><span style=color:#c30>&#34;zf/getting-started/greeting&#34;</span><span style=color:#bbb>
</span></span></span></code></pre></div><p><strong>[Required]</strong> The sinks section lists all the nodes that will send the results of the data flow processing to the outside. In this particular example we have two sinks: the sink <code>file-writer</code> writes the result in the file
<code>/tmp/greetings.txt</code> and the sink zenoh-writer publishes it on Zenoh on the resource <code>zf/getting-started/greeting</code>.</p><p>Note that the sink <code>file-writer</code> has a <code>configuration</code> subsection. This subsection allows passing the values declared there to your node when Zenoh-Flow creates it. This is useful if you want to change the behaviour of your node without having to recompile it or if you want to reuse the same node several times with just a tweak in its parameters.</p><p>Any node can have this subsection (expect builtin Zenoh nodes). It can also appear at the data flow level if all your nodes share a common configuration subset, such that you do not have to repeat it. Similar to the <code>vars</code> sections, a global <code>configuration</code> section is propagated to nested descriptors.</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#309;font-weight:700>links</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:#309;font-weight:700>from</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#309;font-weight:700>node</span>:<span style=color:#bbb> </span>zenoh-sub<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#309;font-weight:700>output</span>:<span style=color:#bbb> </span>hello<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#309;font-weight:700>to</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#309;font-weight:700>node</span>:<span style=color:#bbb> </span>greetings-maker<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#309;font-weight:700>input</span>:<span style=color:#bbb> </span>name<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:#309;font-weight:700>from</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#309;font-weight:700>node</span>:<span style=color:#bbb> </span>greetings-maker<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#309;font-weight:700>output</span>:<span style=color:#bbb> </span>greeting<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#309;font-weight:700>to</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#309;font-weight:700>node</span>:<span style=color:#bbb> </span>file-writer<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#309;font-weight:700>input</span>:<span style=color:#bbb> </span>in<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:#309;font-weight:700>from</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#309;font-weight:700>node</span>:<span style=color:#bbb> </span>greetings-maker<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#309;font-weight:700>output</span>:<span style=color:#bbb> </span>greeting<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#309;font-weight:700>to</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#309;font-weight:700>node</span>:<span style=color:#bbb> </span>zenoh-writer<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#309;font-weight:700>input</span>:<span style=color:#bbb> </span>greeting<span style=color:#bbb>
</span></span></span></code></pre></div><p><strong>[Required]</strong> The links section details how your nodes are connected. Its verbose format is there to ensure that your links are <em>valid</em>.</p><p>Zenoh-Flow will guarantee several crucial properties regarding these links and your data flow:</p><ol><li>An output is connected to an input.</li><li>All outputs and inputs are connected.</li><li>Multiple deployments of the same data flow are automatically isolated. In other terms, there is no data cross-contamination. This property is guaranteed through the use of unique identifiers within each data flow and is automatically added by Zenoh-Flow.</li></ol><p>There is a last optional section, the <code>mapping</code>, that we did not include in this descriptor. We will detail why and its contents when we will explain how to launch this data flow.</p><p>At this point you should have a better grasp of how a data flow in Zenoh-Flow is structured. One point that should be clarified before we can launch it is how to write the logic of a node.</p><h2 id=node-implementation>Node Implementation</h2><p>We are going to detail the code located in the <code>greetings-maker</code> operator as an Operator is the only node that has both inputs and outputs. We will point out the small differences, when compared to a Source or a Sink, throughout the explanation.</p><style>#callout{padding:1.5em 1.25em;border-radius:3px;border-color:#0a143c;border:1px transparent;display:flex;max-width:80%;flex-direction:row;margin-bottom:20px;font-size:small;background-color:#fcfcfd}#callout-inner{margin-left:1em;margin-right:1.5em}@media(max-width:767px){#callout{padding:1.5em .75em 1.5em .6em}#callout-inner{margin-left:.5em}}</style><div id=callout><div>💡️</div><div id=callout-inner>We will detail the Rust implementation in this blog post. A Python API is also available but has not been ported yet.</div></div><p>The code we describe is located in: <code>zenoh-flow/examples/examples/greetings-maker/src/lib.rs</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#069;font-weight:700>use</span><span style=color:#bbb> </span>prost::Message<span style=color:#bbb> </span><span style=color:#069;font-weight:700>as</span><span style=color:#bbb> </span>pMessage;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#069;font-weight:700>use</span><span style=color:#bbb> </span>zenoh_flow_nodes::prelude::<span style=color:#555>*</span>;<span style=color:#bbb>
</span></span></span></code></pre></div><p>The first line imports the <code>Message</code> trait from the Rust implementation of Protobuf. Protobuf is a serialization / deserialization library that works across programming languages. This will allow us to tell Zenoh-Flow how to deserialize / serialize the data we receive / send — if needed!</p><p>On a technical note, we have to rename it as we are also defining a <code>Message</code> structure in Zenoh-Flow.</p><p>The second line imports everything you need to write an Operator from the <code>zenoh-flow-nodes</code> crate.</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#099>#[export_operator]</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#069;font-weight:700>pub</span><span style=color:#bbb> </span><span style=color:#069;font-weight:700>struct</span> <span style=color:#0a8;font-weight:700>GreetingsMaker</span><span style=color:#bbb> </span>{<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>input: <span style=color:#0a8;font-weight:700>Input</span><span style=color:#555>&lt;</span><span style=color:#366>String</span><span style=color:#555>&gt;</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>output: <span style=color:#0a8;font-weight:700>Output</span><span style=color:#555>&lt;</span><span style=color:#366>String</span><span style=color:#555>&gt;</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>}<span style=color:#bbb>
</span></span></span></code></pre></div><p>This snippet creates a structure called <code>GreetingsMaker</code> that has one input and one output, both of type <code>String</code>. Inputs and Outputs in Zenoh-Flow can be typed to facilitate data manipulation: once you tell Zenoh-Flow how to perform the deserialisation / serialisation, it will do it automatically when needed.</p><p>The <code>#[export_operator]</code> procedural macro on top of the structure is to expose the correct symbols such that Zenoh-Flow can dynamically load your shared library. This is a required step and we feel leveraging a macro is the easiest way to get it right for developers.</p><style>#callout{padding:1.5em 1.25em;border-radius:3px;border-color:#0a143c;border:1px transparent;display:flex;max-width:80%;flex-direction:row;margin-bottom:20px;font-size:small;background-color:#fcfcfd}#callout-inner{margin-left:1em;margin-right:1.5em}@media(max-width:767px){#callout{padding:1.5em .75em 1.5em .6em}#callout-inner{margin-left:.5em}}</style><div id=callout><div>💡️</div><div id=callout-inner>A Sink would require the <code>#[export_sink]</code> procedural macro and a Source <code>#[export_source]</code>.</div></div><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#099>#[async_trait::async_trait]</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#069;font-weight:700>impl</span><span style=color:#bbb> </span>Operator<span style=color:#bbb> </span><span style=color:#069;font-weight:700>for</span><span style=color:#bbb> </span>GreetingsMaker<span style=color:#bbb> </span>{<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#069;font-weight:700>async</span><span style=color:#bbb> </span><span style=color:#069;font-weight:700>fn</span> <span style=color:#c0f>new</span>(<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>_context: <span style=color:#0a8;font-weight:700>Context</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>_configuration: <span style=color:#0a8;font-weight:700>Configuration</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#069;font-weight:700>mut</span><span style=color:#bbb> </span>inputs: <span style=color:#0a8;font-weight:700>Inputs</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#069;font-weight:700>mut</span><span style=color:#bbb> </span>outputs: <span style=color:#0a8;font-weight:700>Outputs</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>)<span style=color:#bbb> </span>-&gt; <span style=color:#366>Result</span><span style=color:#555>&lt;</span>Self<span style=color:#555>&gt;</span><span style=color:#bbb> </span>{<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#366>Ok</span>(GreetingsMaker<span style=color:#bbb> </span>{<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>            </span>input: <span style=color:#0a8;font-weight:700>inputs</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>                </span>.take(<span style=color:#c30>&#34;name&#34;</span>)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>                </span>.expect(<span style=color:#c30>&#34;No input &#39;name&#39; found&#34;</span>)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>                </span><span style=color:#09f;font-style:italic>// NOTE: the method `take` returns an `InputBuilder` and the method `typed`
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span><span style=color:#bbb>                </span><span style=color:#09f;font-style:italic>// creates a typed Input.
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span><span style=color:#bbb>                </span>.typed(<span style=color:#555>|</span>bytes<span style=color:#555>|</span><span style=color:#bbb> </span><span style=color:#366>String</span>::from_utf8(bytes.into()).map_err(<span style=color:#555>|</span>e<span style=color:#555>|</span><span style=color:#bbb> </span>anyhow<span style=color:#555>!</span>(e))),<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>            </span>output: <span style=color:#0a8;font-weight:700>outputs</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>                </span>.take(<span style=color:#c30>&#34;greeting&#34;</span>)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>                </span>.expect(<span style=color:#c30>&#34;No output &#39;greeting&#39; found&#34;</span>)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>                </span><span style=color:#09f;font-style:italic>// NOTE: similarly, the method `take` returns an `OutputBuilder` and the
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span><span style=color:#bbb>                </span><span style=color:#09f;font-style:italic>// method `typed` creates a typed Output.
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span><span style=color:#bbb>                </span>.typed(<span style=color:#555>|</span>buffer,<span style=color:#bbb> </span>data: <span style=color:#069>&amp;</span><span style=color:#366>String</span><span style=color:#555>|</span><span style=color:#bbb> </span>data.encode(buffer).map_err(<span style=color:#555>|</span>e<span style=color:#555>|</span><span style=color:#bbb> </span>anyhow<span style=color:#555>!</span>(e))),<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>})<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>}<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>}<span style=color:#bbb>
</span></span></span></code></pre></div><p>This snippet tells how Zenoh-Flow can create an instance of your Operator. We require you to implement the <code>Operator</code> trait that consists of a single asynchronous function: <code>new</code>.</p><style>#callout{padding:1.5em 1.25em;border-radius:3px;border-color:#0a143c;border:1px transparent;display:flex;max-width:80%;flex-direction:row;margin-bottom:20px;font-size:small;background-color:#fcfcfd}#callout-inner{margin-left:1em;margin-right:1.5em}@media(max-width:767px){#callout{padding:1.5em .75em 1.5em .6em}#callout-inner{margin-left:.5em}}</style><div id=callout><div>💡️</div><div id=callout-inner>A Sink would require you to implement the Sink trait and a Source the Source trait. The only difference lies in the arguments of the new method: a Sink only has Inputs while a Source only has Outputs.</div></div><p>It’s arguments are:</p><ul><li><code>_context</code> contains the information regarding the environment in which your node will run. For instance, the name and unique identifier of the Zenoh-Flow runtime that will execute it.</li><li><code>_configuration</code> contains the associative list of <code>key</code>, <code>value</code> that you gave in the descriptor file. It is a reexport of the <code>serde_json::Value</code> structure, which provides a lot of flexibility.</li><li><code>inputs</code> contains the receiving channels Zenoh-Flow created for your operator. As we can see, in order to access an input you must provide an identifier, the same that you declared in the descriptor. This point is important: the identifier in your code must match what is written in the descriptor. The <code>typed</code> method constructs the final structure your code will manipulate and requires for that the function to deserialise bytes into the desired type.</li><li><code>outputs</code> is the sending counterpart of the <code>inputs</code>. It bears the same requirements with the difference that the typed method requires a serialisation function.</li></ul><p>The procedural macro <code>#[async_trait::async_trait]</code> is to allow for the definition and usage of asynchronous method in traits.</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#099>#[async_trait::async_trait]</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#069;font-weight:700>impl</span><span style=color:#bbb> </span>Node<span style=color:#bbb> </span><span style=color:#069;font-weight:700>for</span><span style=color:#bbb> </span>GreetingsMaker<span style=color:#bbb> </span>{<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#069;font-weight:700>async</span><span style=color:#bbb> </span><span style=color:#069;font-weight:700>fn</span> <span style=color:#c0f>iteration</span>(<span style=color:#555>&amp;</span>self)<span style=color:#bbb> </span>-&gt; <span style=color:#366>Result</span><span style=color:#555>&lt;</span>()<span style=color:#555>&gt;</span><span style=color:#bbb> </span>{<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#069;font-weight:700>let</span><span style=color:#bbb> </span>(message,<span style=color:#bbb> </span>_)<span style=color:#bbb> </span><span style=color:#555>=</span><span style=color:#bbb> </span>self.input.recv().<span style=color:#069;font-weight:700>await</span><span style=color:#555>?</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#069;font-weight:700>if</span><span style=color:#bbb> </span><span style=color:#069;font-weight:700>let</span><span style=color:#bbb> </span>Message::Data(characters)<span style=color:#bbb> </span><span style=color:#555>=</span><span style=color:#bbb> </span>message<span style=color:#bbb> </span>{<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>            </span><span style=color:#069;font-weight:700>let</span><span style=color:#bbb> </span>name<span style=color:#bbb> </span><span style=color:#555>=</span><span style=color:#bbb> </span>characters.trim_end();<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>            </span><span style=color:#069;font-weight:700>let</span><span style=color:#bbb> </span>greetings<span style=color:#bbb> </span><span style=color:#555>=</span><span style=color:#bbb> </span><span style=color:#069;font-weight:700>match</span><span style=color:#bbb> </span>name<span style=color:#bbb> </span>{<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>                </span><span style=color:#c30>&#34;Sofia&#34;</span><span style=color:#bbb> </span><span style=color:#555>|</span><span style=color:#bbb> </span><span style=color:#c30>&#34;Leonardo&#34;</span><span style=color:#bbb> </span><span style=color:#555>=&gt;</span><span style=color:#bbb> </span>format!(<span style=color:#c30>&#34;Ciao, {}!\n&#34;</span>,<span style=color:#bbb> </span>name),<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>                </span><span style=color:#c30>&#34;Lucia&#34;</span><span style=color:#bbb> </span><span style=color:#555>|</span><span style=color:#bbb> </span><span style=color:#c30>&#34;Martin&#34;</span><span style=color:#bbb> </span><span style=color:#555>=&gt;</span><span style=color:#bbb> </span>format!(<span style=color:#c30>&#34;¡Hola, {}!\n&#34;</span>,<span style=color:#bbb> </span>name),<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>                </span><span style=color:#c30>&#34;Jade&#34;</span><span style=color:#bbb> </span><span style=color:#555>|</span><span style=color:#bbb> </span><span style=color:#c30>&#34;Gabriel&#34;</span><span style=color:#bbb> </span><span style=color:#555>=&gt;</span><span style=color:#bbb> </span>format!(<span style=color:#c30>&#34;Bonjour, {} !\n&#34;</span>,<span style=color:#bbb> </span>name),<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>                </span>_<span style=color:#bbb> </span><span style=color:#555>=&gt;</span><span style=color:#bbb> </span>format!(<span style=color:#c30>&#34;Hello, {}!\n&#34;</span>,<span style=color:#bbb> </span>name),<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>            </span>};<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>            </span><span style=color:#069;font-weight:700>return</span><span style=color:#bbb> </span>self.output.send(greetings,<span style=color:#bbb> </span><span style=color:#366>None</span>).<span style=color:#069;font-weight:700>await</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>}<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#366>Ok</span>(())<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>}<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>}<span style=color:#bbb>
</span></span></span></code></pre></div><p>The last part of the implementation of our Operator is the <code>Node</code> trait and its method <code>iteration</code>. This method is what Zenoh-Flow will call, in a loop, until you decide to stop your data flow (or if an unfortunate event happens).</p><p>As the signature of the method indicates, this method takes an immutable reference to your operator’s instance. If you want to persist state, then you need to leverage the <a href=https://doc.rust-lang.org/reference/interior-mutability.html>interior mutability pattern</a>. This is a design choice of Zenoh-Flow: providing a mutable reference would hinder the performance of all nodes, even those that do not need to mutate it.</p><p>If an iteration returns an error, Zenoh-Flow will log it and resume the execution of your operator. Speaking of execution, let us briefly explain how Zenoh-Flow drives the execution of a data flow.</p><h2 id=execution-model-data-driven>Execution Model: Data-Driven</h2><p>In version <code>0.6.0-rc</code> and the previous ones, Zenoh-Flow supports a single execution model: data-driven. This model is relatively simple: each node runs in its own task and is driven by its I/O operations. If there is no available input then the node will be parked by the executor, only to be woken up when data has been received.</p><p>The following line from the Operator implementation is a perfect example:</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#069;font-weight:700>let</span><span style=color:#bbb> </span>(message,<span style=color:#bbb> </span>_)<span style=color:#bbb> </span><span style=color:#555>=</span><span style=color:#bbb> </span>self.input.recv().<span style=color:#069;font-weight:700>await</span><span style=color:#555>?</span>;<span style=color:#bbb>
</span></span></span></code></pre></div><p>The <code>await</code> keyword in Rust indicates asynchronous events where the executor can park the node.</p><p>We already have implemented another execution model and are working on a second one that we keep for the following minor release of Zenoh-Flow, stay tuned! As a form of teaser, these other execution models offer more control than the data-driven one which in turn leads to (much) better performance.</p><p>Now that we have seen how to define a data flow, how to implement an Operator and how Zenoh-Flow drives the execution of the nodes, the next step is to launch your first flow!</p><h2 id=launching-a-data-flow>Launching a Data Flow</h2><p>Zenoh-Flow provides two ways of starting a data flow: via a standalone runtime or via a daemon (and its associated command line tool <code>zfctl</code>).</p><p>The standalone runtime will only run a single data flow and will only deploy nodes on the machine on which it is started. We believe it is beneficial for prototyping or realising benchmarks.</p><p>We offer two flavours of the daemon: a standalone daemon and a plugin for Zenoh. Both offer the exact same functionalities with the difference that the standalone daemon does not require you to start and configure a Zenoh router. We recommend using the daemon when you need to deploy a data flow on several Zenoh-Flow runtimes. Our daemon and command line tool have been designed to help you in this specific scenario, automating the deployment as much as possible.</p><p>Running the example requires first to compile the example we want to run:</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#09f;font-style:italic># We are assuming that you are at the root of the Zenoh-Flow directory.</span>
</span></span><span style=display:flex><span>cargo build --examples
</span></span></code></pre></div><h3 id=with-the-standalone-runtime>With the Standalone Runtime</h3><p>Compile the executable (if you want a release profile, add <code>--release</code>) to the command below:</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>cargo build -p zenoh-flow-standalone-runtime
</span></span></code></pre></div><p>Simply launch the following command and you are set:</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>./target/debug/zenoh-flow-standalone-runtime ./examples/flows/getting-started.yaml
</span></span></code></pre></div><p>If you want to modify some of the variables in the vars section of the data flow you can execute instead:</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>./target/debug/zenoh-flow-standalone-runtime <span style=color:#c30;font-weight:700>\
</span></span></span><span style=display:flex><span><span style=color:#c30;font-weight:700></span>    <span style=color:#09f;font-style:italic># macOS</span>
</span></span><span style=display:flex><span>    --vars <span style=color:#033>DLL</span><span style=color:#555>=</span>dylib <span style=color:#c30;font-weight:700>\
</span></span></span><span style=display:flex><span><span style=color:#c30;font-weight:700></span>    <span style=color:#09f;font-style:italic># release build instead of debug</span>
</span></span><span style=display:flex><span>    --vars <span style=color:#033>BUILD</span><span style=color:#555>=</span>release <span style=color:#c30;font-weight:700>\
</span></span></span><span style=display:flex><span><span style=color:#c30;font-weight:700></span>    ./examples/flows/getting-started.yaml
</span></span></code></pre></div><p>Fire up a Zenoh subscriber and / or launch <code>tail</code> on the file /tmp/greetings.txt to see the results:</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#09f;font-style:italic># In a first shell</span>
</span></span><span style=display:flex><span>z_sub -k <span style=color:#c30>&#34;zf/getting-started/greeting&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#09f;font-style:italic># (optional) In a second shell</span>
</span></span><span style=display:flex><span>tail -f /tmp/greetings.txt
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#09f;font-style:italic># In another shell</span>
</span></span><span style=display:flex><span>z_put -k <span style=color:#c30>&#34;zf/getting-started/hello&#34;</span> -v <span style=color:#c30>&#34;Alice&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#09f;font-style:italic># You should see &#34;Hello, Alice!&#34;.</span>
</span></span></code></pre></div><h3 id=with-the-standalone-daemon>With the Standalone Daemon</h3><p>Running a data flow on a daemon requires slightly more preparatory work.</p><p>First we need to compile the executable we need:</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>cargo build -p zenoh-flow-standalone-daemon -p zfctl
</span></span></code></pre></div><p>We then need to start the standalone daemon:</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>./target/debug/zenoh-flow-standalone-daemon my-first-daemon
</span></span></code></pre></div><p>You should see something along the lines of:</p><p>The id is the unique identifier of the Zenoh-Flow runtime contained within your daemon called “my-first-daemon”. This id is important if you want to control where the different nodes composing your data flow will run. As we mentioned earlier when we described the different sections of a data flow descriptor, there is an optional section <code>mapping</code>.</p><p>The section <code>mapping</code> allows defining on which Zenoh-Flow runtime a node should run. For instance, the snippet below tells Zenoh-Flow to launch all nodes on the runtime of our daemon “my-first-daemon”.</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#309;font-weight:700>mapping</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#309;font-weight:700>92af6ef5bdab227a95993f3f73cb9f6e</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- zenoh-sub<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- greetings-maker<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- zenoh-writer<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- file-writer<span style=color:#bbb>
</span></span></span></code></pre></div><p>If a node is omitted, Zenoh-Flow will default to launching it on the runtime that was contacted. How to choose which Zenoh-Flow runtime to contact? Our command line tool <code>zfctl</code> lets you specify the unique identifier of a runtime or selects one randomly for you if you don’t specify one.</p><p>If you want to list all the available Zenoh-Flow daemon on your network you can use zfctl <code>like</code> so:</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>./target/debug/zfctl runtime list
</span></span></code></pre></div><p>Hence, assuming there is only one Zenoh-Flow daemon running on your network, the two commands below are equivalent and both create an instance of the data flow “getting-started”:</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>./target/debug/zfctl instance create ./examples/flows/getting-started.yaml
</span></span><span style=display:flex><span><span style=color:#09f;font-style:italic># is equivalent to:</span>
</span></span><span style=display:flex><span>./target/debug/zfctl instance  --runtime 92af6ef5bdab227a95993f3f73cb9f6e create ./examples/flows/getting-started.yaml
</span></span></code></pre></div><p>You should then see the <em>unique identifier</em> of the instance of this data flow echoed in the logs. Note it down, as if the creation is successful, this is through this identifier that you can manage it.</p><p>We have to make two comments regarding this last sentence:</p><ol><li>First, “successful creation”. There could be scenario where the creation failed. If, for instance, you requested part of the data flow to run on a Zenoh-Flow runtime that is not reachable via Zenoh then Zenoh-Flow would abandon the creation (and ask the Zenoh-Flow runtime(s) that were, successfully, contacted to rollback).</li><li>Second, “creation”. When managing a data flow via a daemon, we separate the creation from the running phase, meaning that no Zenoh-Flow runtime will automatically start it.</li></ol><p>If we assume that the data flow was successfully created and its unique identifier is <code>d392a6b5-b284-4d26-96c4-35372d860978</code> then to start it, on all runtimes, one should enter:</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>./target/debug/zfctl instance start d392a6b5-b284-4d26-96c4-35372d860978
</span></span></code></pre></div><p>Just like with the standalone runtime, enter the following commands on different shells to confirm that the data flow is executed correctly:</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#09f;font-style:italic># In a first shell</span>
</span></span><span style=display:flex><span>z_sub -k <span style=color:#c30>&#34;zf/getting-started/greeting&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#09f;font-style:italic># (optional) In a second shell</span>
</span></span><span style=display:flex><span>tail -f /tmp/greetings.txt
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#09f;font-style:italic># In another shell</span>
</span></span><span style=display:flex><span>z_put -k <span style=color:#c30>&#34;zf/getting-started/hello&#34;</span> -v <span style=color:#c30>&#34;Bob&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#09f;font-style:italic># You should see &#34;Hello, Bob!&#34;.</span>
</span></span></code></pre></div><h2 id=conclusion>Conclusion</h2><p>This blog gave you an overview of how to write your first data flow using the Zenoh-Flow framework. We have seen the different sections that compose a data flow descriptor, we have seen what is required to write an Operator, how Zenoh-Flow is (for now!) a data-driven framework and, lastly, how to start your data flow with either the standalone runtime or via a daemon.</p><p>As we have indicated at few occasions, we are still in the process of polishing minor aspects and will update the blog post as soon as the <code>0.6.0-rc</code> version is released. We are also working (among other exciting features!) on other execution models that we will progressively unroll with other minor releases of Zenoh-Flow. The first one, <em>guided execution</em>, will come with version <code>0.6.1-rc</code> and will be the object of a dedicated blog!</p><p>Until then, happy coding!</p><p><a href=https://github.com/orgs/eclipse-zenoh/people><strong>&ndash; Julien Loudet for the Zenoh team</strong></a></p><div class=ato-next><b>Next up</b>: <a href=../../blog/2023-10-03-zenoh-dragonite/>Zenoh Dragonite Took Off!</a></div></main></div></div><footer class="ato-footer text-muted"><div class="container-fluid p-6 p-md-5"><div class=row><div class=col-md-2><h5>Eclipse Incubation</h5><p><img src=../../img/eclipse-incubation.png style=width:100px></p><p>Eclipse zenoh &trade; is an incubating project under the Eclipse Foundation.</p></div><div class=col-md-2><h5>More Information</h5><p><a href=https://www.eclipse.org/legal target=_blank>Legal</a></p><p><a href=https://www.eclipse.org/legal/privacy.php target=_blank>Privacy policy</a></p><p><a href=https://www.eclipse.org/legal/termsofuse.php target=_blank>Terms of use</a></p><p><a href=https://www.eclipse.org/legal/copyright.php target=_blank>Copyright</a></p><p><a href=https://www.eclipse.org/security/ target=_blank>Report a security issue</a></p><p><a href=https://www.eclipse.org/legal/epl-2.0/ target=_blank>Eclipse Public License 2.0</a></p><p><a href=https://www.apache.org/licenses/LICENSE-2.0 target=_blank>Apache License 2.0</a></p><p><a href=https://www.eclipse.org/ target=_blank>Eclipse Foundation</a></p></div><div class=col-md-2><h5>Sponsored by:</h5><p><a href=https://www.eclipse.org target=_blank><img src=../../img/eclipse-foundation.svg style=width:120px></a></p><p><a href=https://zettascale.tech target=_blank><img src=../../img/zettascale-dark.svg style=width:120px></a></p></div><div class=col-md-2><h5>Follow us</h5><p><a href=https://github.com/eclipse-zenoh/zenoh><i class="fa fa-github" aria-hidden=true></i>
GitHub</a></p><p><a href=https://discord.gg/vSDSpqnbkm><i class="fa fa fa-comments-o" aria-hidden=true></i>
Discord</a></p><p><a href=https://www.youtube.com/channel/UCslbiyiqgOAPMjCrPWIfQ5Q><i class="fa fa-youtube-play" aria-hidden=true></i> Youtube</a></p><p><a href=../../docs/overview/what-is-zenoh><i class="fa fa-info-circle" aria-hidden=true></i> About</a></p></div><div class=col-md-2><p><img src=../../img/zenoh-dragon-150x163.png style=width:45px></p><p>Eclipse zenoh &trade; is free, open source and always will be.</p><p>Copyright &copy 2022 Eclipse Foundation</p><p>Built with <a href=https://gohugo.io/ target=_blank>HUGO</a></p></div></div></div></footer><script src=https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js integrity=sha384-3ceskX3iaEnIogmQchP8opvBy3Mi7Ce34nWjpBIwVTHfGYWQS9jwHDVRnpKKHJg7 crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/tether/1.3.7/js/tether.min.js integrity=sha384-XTs3FgkjiBgo8qjEjBk0tGmf3wPrWtA6coPfQDfFEY8AnYJwjalXCiosYRBIBZX8 crossorigin=anonymous></script>
<script src=../../js/bootstrap.min.js></script>
<script src=../../js/highlight.min.js></script>
<script>$(function(){$("pre code").each(function(e,t){if(t.className.indexOf("language-rust")>=0){for(var s="",n=t.textContent.split(`
`),e=0;e<n.length;e++){if(n[e].indexOf("# ")==0||n[e]=="#")continue;s+=n[e].trimRight()+`
`}t.textContent=s.replace(/\n\n\n/g,`

`).trimRight()}hljs.highlightBlock(t)})})</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-PBD6MS51QL"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-PBD6MS51QL",{anonymize_ip:!1})}</script></body></html>