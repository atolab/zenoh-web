<!doctype html><html lang=en><head><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.png color=#7da7d8><meta name=msapplication-TileColor content="#7da7d8"><meta name=theme-color content="#7da7d8"><meta charset=utf-8><meta name=description content="Eclipse Zenoh, unify data in motion, data at rest and computations."><meta name=keywords content="pub/sub,query,geo distributed storage,Rust,protocol,DDS,MQTT,Edge,IoT,MEC"><meta name=author content="The Zenoh Team"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta http-equiv=x-ua-compatible content="ie=edge"><link rel=stylesheet href=../../css/bootstrap-reboot.css><link rel=stylesheet href=../../css/bootstrap.css><link rel=stylesheet href=../../css/font-awesome.min.css><link rel=stylesheet href=../../css/ato.css><link rel=stylesheet href=../../css/syntax.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css><link rel=alternate type=application/rss+xml href=../../blog/index.xml><title>Zenoh Reliability, Scalability and Congestion Control · zenoh - pub/sub, geo distributed storage, query</title></head><body><header class="navbar navbar-expand navbar-dark flex-column flex-md-row ato-navbar"><a class=navbar-brand href=../../><img src=../../img/zenoh-dragon-bg.png class=align-middle alt></a><div class="collapse navbar-collapse"><ul class=navbar-nav><li class=nav-item><a class=nav-link href=../../>Home</a></li><li class=nav-item><a class=nav-link href=../../docs/getting-started/key-concepts/>Documentation</a></li><li class=nav-item><a class=nav-link href=../../community/>Community</a></li><li class=nav-item><a class="nav-link active" href=../../blog/2021-06-14-zenoh-reliability/>Blog</a></li></ul></div><ul class="navbar-nav flex-row ml-md-auto d-none d-md-flex"><li class=nav-item><a class="nav-link p-2" href=https://github.com/eclipse-zenoh/zenoh target=_blank rel=noopener aria-label=GitHub><svg class="navbar-nav-svg" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 512 499.36" focusable="false"><title>GitHub</title><path d="M256 0C114.64.0.0 114.61.0 256c0 113.09 73.34 209 175.08 242.9 12.8 2.35 17.47-5.56 17.47-12.34.0-6.08-.22-22.18-.35-43.54-71.2 15.49-86.2-34.34-86.2-34.34-11.64-29.57-28.42-37.45-28.42-37.45-23.27-15.84 1.73-15.55 1.73-15.55 25.69 1.81 39.21 26.38 39.21 26.38 22.84 39.12 59.92 27.82 74.5 21.27 2.33-16.54 8.94-27.82 16.25-34.22-56.84-6.43-116.6-28.43-116.6-126.49.0-27.95 10-50.8 26.35-68.69-2.63-6.48-11.42-32.5 2.51-67.75.0.0 21.49-6.88 70.4 26.24a242.65 242.65.0 01128.18.0c48.87-33.13 70.33-26.24 70.33-26.24 14 35.25 5.18 61.27 2.55 67.75 16.41 17.9 26.31 40.75 26.31 68.69.0 98.35-59.85 120-116.88 126.32 9.19 7.9 17.38 23.53 17.38 47.41.0 34.22-.31 61.83-.31 70.23.0 6.85 4.61 14.81 17.6 12.31C438.72 464.97 512 369.08 512 256.02 512 114.62 397.37.0 256 0z" fill="currentcolor" fill-rule="evenodd"/></svg></a></li><li class=nav-item><a class="nav-link p-2" href=https://twitter.com/atolab_ target=_blank rel=noopener aria-label=Twitter><svg class="navbar-nav-svg" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 512 416.32" focusable="false"><title>Twitter</title><path d="M160.83 416.32c193.2.0 298.92-160.22 298.92-298.92.0-4.51.0-9-.2-13.52A214 214 0 00512 49.38a212.93 212.93.0 01-60.44 16.6 105.7 105.7.0 0046.3-58.19 209 209 0 01-66.79 25.37 105.09 105.09.0 00-181.73 71.91 116.12 116.12.0 002.66 24c-87.28-4.3-164.73-46.3-216.56-109.82A105.48 105.48.0 0068 159.6a106.27 106.27.0 01-47.53-13.11v1.43a105.28 105.28.0 0084.21 103.06 105.67 105.67.0 01-47.33 1.84 105.06 105.06.0 0098.14 72.94A210.72 210.72.0 0125 370.84a202.17 202.17.0 01-25-1.43 298.85 298.85.0 00160.83 46.92" fill="currentcolor"/></svg></a></li><li class=nav-item><a class="nav-link p-2" href=https://gitter.im/atolab/zenoh target=_blank rel=noopener aria-label=Gitter><svg class="navbar-nav-svg" xmlns="http://www.w3.org/2000/svg" focusable="false"><title>Gitter</title><path fill="currentcolor" d="M8.501 4.001H10.5V24H8.501V4.001zm6.999.0V24h-2V4.001h2zM3.5.0h2.001v15H3.5V0zm15 4.001h2V15h-2V4.001z"/></svg></a></li></ul><script async src="https://www.googletagmanager.com/gtag/js?id=UA-120904581-1"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-41082619-2');</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":""},"articleSection":"blog","name":"Zenoh Reliability, Scalability and Congestion Control","headline":"Zenoh Reliability, Scalability and Congestion Control","datePublished":"2021-06-14 00:00:00 \x2b0000 UTC","dateModified":"2021-06-14 00:00:00 \x2b0000 UTC","url":"\/blog\/2021-06-14-zenoh-reliability\/","inLanguage":"en-US","author":"","creator":"","publisher":"","accountablePerson":"","copyrightHolder":"","copyrightYear":"14146","wordCount":"982","keywords":[],"description":"14 June 2021 -- Paris."}</script></header><div class="container-fluid ato-blog"><div class="row flex-xl-nowrap"><div class="col-12 col-md-3 col-xl-2 ato-sidebar"><div class="ato-docs-toggle d-md-none p-0 d-flex ml-3 collapsed align-item-center"><h1 class=ato-title>Zenoh Reliability, Scalability and Congestion Control</h1><button class="btn btn-link" type=button data-toggle=collapse data-target=#ato-docs-nav aria-controls=ato-docs-nav aria-expanded=false aria-label="Toggle docs navigation"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 30 30" width="30" height="30" focusable="false"><title>Menu</title><path stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-miterlimit="10" d="M4 7h22M4 15h22M4 23h22"/></svg></button></div><nav class="ato-links collapse" id=ato-docs-nav><div class="ato-toc-item active"><p class=ato-toc-link>Blog Posts</p><ul class="nav ato-sidenav"><li><a href=../../blog/2021-06-14-zenoh-reliability/ class=active>Zenoh Reliability, Scalability and Congestion Control</a></li><li><a href=../../blog/2021-04-28-ros2-integration/>Integrating ROS2 with Eclipse zenoh</a></li><li><a href=../../blog/2021-03-23-discovery/>Minimizing Discovery Overhead in ROS2</a></li><li><a href=../../blog/2020-10-08-aithusa/>Zenoh Aithusa Hatched Out!</a></li><li><a href=../../blog/2020-06-29-zenoh-tidings/>Zenoh Tidings</a></li><li><a href=../../blog/2020-01-01-zenohtude/>A Year Full of Zenoh</a></li></ul></div></nav></div><div class="d-none d-xl-block col-xl-2 ato-toc"><div class=section-nav><nav id=TableOfContents><ul><li><a href=#reliability-and-scalability>Reliability and Scalability</a><ul><li><a href=#hop-to-hop-reliability>Hop to hop reliability</a></li></ul></li><li><a href=#a-stronger-reliability>A Stronger Reliability</a><ul><li><a href=#end-to-end-reliability>End to End Reliability</a></li><li><a href=#first-router-to-last-router-reliability>First Router to Last Router Reliability</a></li></ul></li><li><a href=#reliability-and-flow-control>Reliability and Flow Control</a></li><li><a href=#show-me-some-code>Show me Some Code</a><ul><li><a href=#configuring-reliability>Configuring Reliability</a></li><li><a href=#configuring-congestion-control>Configuring Congestion Control</a></li></ul></li><li><a href=#conclusion>Conclusion</a></li></ul></nav></div></div><main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 ato-content ato-docs"><h1 class=ato-title>Zenoh Reliability, Scalability and Congestion Control</h1><p class=ato-date>14 June 2021 -- Paris.</p><p>Providing many to many reliable communications over a wide area network is challenging. This may even be an understatement, as theoretically, even simple point to point reliable communication over asynchronous channels requires either infinite amount of memory or giving up progress… but guess what, many real systems can’t afford neither of those restrictions. Thus, trade-offs need to be made regarding reliability for the system to work, scale smoothly and have sufficiently strong guarantees. System&rsquo;s heterogeneity, with respect to network capabilities and nodes resources, has important consequences and requires proper strategies to avoid the a slow node to impact the entire system.</p><p><em>zenoh</em> provides different mechanisms to deal with these challenges. It allows users to clearly define the reliability semantics they need without bringing extra complexity.</p><hr><h2 id=reliability-and-scalability>Reliability and Scalability</h2><h3 id=hop-to-hop-reliability>Hop to hop reliability</h3><p>The <em>zenoh</em> protocol is composed of two layers:</p><ul><li><em>The session protocol</em> establishes a bidirectional 1 to 1 session between two <em>zenoh</em> runtimes (<a href=../../docs/getting-started/key-concepts/#client>client</a>, <a href=../../docs/getting-started/key-concepts/#peer>peer</a> or <a href=../../docs/getting-started/key-concepts/#router>router</a>). Each session comes by default with a best-effort channel and a reliable channel. The session protocol among other things, takes care of performing automatic batching for maximising network usage and fragmentation to give the illusion of an unlimited MTU.</li><li><em>The routing protocol</em> leverages the session protocol to propagate interests and route data from many producers to many consumers.</li></ul><p>Consequently the reliability state maintained by each application is independent of the number of data producers and data subscribers hosted by the application.</p><p>As <em>zenoh</em> offers routed communication, a single data producer connected to a <em>zenoh</em> router can reliably send data to as many data consumers as needed while maintaining a single reliability state.</p><p><img src=../../img/blog-zenoh-reliability/zenoh-reliability-and-scalability.png alt=msg-sec></p><p>This strategy is highly scalable and offers a good level of reliability. No data samples are lost while the infrastructure is stable. If a <em>zenoh</em> router fails, the <em>zenoh</em> infrastructure will automatically adapt to the new topology (details will be provided in a future post). During the failover, data samples may be lost. As soon as the infrastructure re-stabilized, data is distributed reliably again.</p><hr><h2 id=a-stronger-reliability>A Stronger Reliability</h2><p>With the default hop to hop reliability strategy data samples can be lost during topology changes. This is the price to pay for a good scalability but can be problematic for some systems. <em>zenoh</em> is designed to offer two stronger reliability strategies which are very briefly described here.</p><h3 id=end-to-end-reliability>End to End Reliability</h3><p>A reliability channel is established between each data producer/data consumer pair. This avoids sample loss even during topology changes but is less scalable and induces higher resource consumption on producers and consumers.</p><h3 id=first-router-to-last-router-reliability>First Router to Last Router Reliability</h3><p>A reliability channel is established between the first <em>zenoh</em> router and the last <em>zenoh</em> router of each data route. This allows to relax pressure on producers and consumers by deporting this pressure to nearest infrastructure components.</p><p><img src=../../img/blog-zenoh-reliability/zenoh-strong-reliability.png alt=msg-sec></p><hr><h2 id=reliability-and-flow-control>Reliability and Flow Control</h2><p>In a reliable system, there is a constant trade-off between reliability, progress and memory consumption. Indeed a slow or non-responsive data consumer will force matching data producers to either:</p><ul><li>Store more and more messages thus consuming more and more memory.</li><li>Drop messages thus losing reliability.</li><li>Block new writes thus losing progress.</li></ul><p>It’s often the receiving application that can decide if messages losses are acceptable or not. When only parts of the subscribers need reliable communications it is more efficient to only propagate data reliably to those subscribers than to all of them. So it seems appropriate to let the receiving application decide if communication should be reliable or not. On the other hand, giving full control to subscribers has downsides. Receiving applications can force data producers to maintain a reliability state while those producers may be resource constrained and not willing to do so. And a single misbehaving receiver application may block or slow down the whole system.</p><p>A lot of technologies made opinionated choices to address this problem and applied predefined semantics on which users have very limited control. Those semantics may be good for some use cases and bad for others and you would often need a mix of different behaviors in the same system.</p><p>Part of the issue is a confusion between <em>reliability</em> and <em>congestion control</em>. <em>zenoh</em> clearly separates control over <em>message resending</em>, <em>memory usage</em> (buffering) and <em>message dropping</em>.</p><ul><li>Receivers control <em>reliability</em> by selecting a <em>resending strategy</em>. They declare if they need missing messages to be resent or not.</li><li>Senders and intermediate infrastructure components (<em>zenoh</em> routers) individually decide how much <em>memory</em> they are willing to dedicate to reliability. This allows constrained devices to dedicate few resources to reliability while resourceful intermediate routers can dedicate more memory lowering the probabilities of congestion situations.</li><li>Senders control <em>congestion</em> by selecting a <em>message dropping</em> strategy. For each sample they decide what should be done in case of congestion (the reliability queue is full) &ndash; drop the sample or block the publication. The <em>congestion control</em> strategy is propagated from the sender to all involved infrastructure components and applied along the entire routing path.</li></ul><p><img src=../../img/blog-zenoh-reliability/zenoh-reliability-and-flow-control.png alt=msg-sec></p><hr><h2 id=show-me-some-code>Show me Some Code</h2><p>Here are examples of how reliability and congestion control can be configured using the <em>zenoh</em> Python API.</p><h3 id=configuring-reliability>Configuring Reliability</h3><p>zenoh reliability is configured on the subscriber side as shown below:</p><div class=highlight><pre style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>session <span style=color:#555>=</span> zenoh<span style=color:#555>.</span>net<span style=color:#555>.</span>open({})

sub_info <span style=color:#555>=</span> SubInfo(
zenoh<span style=color:#555>.</span>net<span style=color:#555>.</span>Reliability<span style=color:#555>.</span>Reliable, 
zenoh<span style=color:#555>.</span>net<span style=color:#555>.</span>SubMode<span style=color:#555>.</span>Push)

sub <span style=color:#555>=</span> session<span style=color:#555>.</span>declare_subscriber(selector, sub_info, <span style=color:#069;font-weight:700>lambda</span> sample: 
		<span style=color:#069;font-weight:700>print</span>(<span style=color:#c30>&#39;received {}&#39;</span><span style=color:#555>.</span>format(sample)))
</code></pre></div><h3 id=configuring-congestion-control>Configuring Congestion Control</h3><p>zenoh congestion control is configured per sample as shown below:</p><div class=highlight><pre style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>session <span style=color:#555>=</span> zenoh<span style=color:#555>.</span>net<span style=color:#555>.</span>open({})

zenoh<span style=color:#555>.</span>write(<span style=color:#c30>&#39;/demo/hello&#39;</span>, <span style=color:#366>bytes</span>(<span style=color:#c30>&#39;Hello world&#39;</span>, encoding<span style=color:#555>=</span><span style=color:#c30>&#39;utf8&#39;</span>),
	congestion_control<span style=color:#555>=</span>zenoh<span style=color:#555>.</span>net<span style=color:#555>.</span>CongestionControl<span style=color:#555>.</span>Drop())
</code></pre></div><hr><h2 id=conclusion>Conclusion</h2><p><em>zenoh</em> provides different flavors of reliability and congestion control. It provides the level of control required
to balance between application needs and system constraints, thus allowing the user to operate under the right trade-off between reliability, scalability, resource consumption and progress. Finally, each zenoh application and infrastructural node, i.e. zenoh routers, participates to the system with its own capacity and is well protected from structural or temporary asymmetries.</p><p>These are some of the key ingredients that make <em>zenoh</em> work well at scale, in dynamic and heterogeneous networks, while maintaining strong guarantees.</p><p><a href=https://github.com/OlivierHecart><strong>&ndash;OH</strong></a></p><div class=ato-next><b>Next up</b>: <a href=/blog/2021-04-28-ros2-integration/>Integrating ROS2 with Eclipse zenoh</a></div></main></div></div><footer class="ato-footer text-muted"><div class="container-fluid p-6 p-md-5"><div class=row><div class=col-md-2><h5>Eclipse Incubation</h5><p><img src=../../img/eclipse-incubation.png style=width:100px></p><p>Eclipse zenoh &trade; is an incubating project under the Eclipse Foundation.</p></div><div class=col-md-2><h5>More Information</h5><p><a href=https://www.eclipse.org/legal target=_blank>Legal</a></p><p><a href=https://www.eclipse.org/legal/privacy.php target=_blank>Privacy policy</a></p><p><a href=https://www.eclipse.org/legal/termsofuse.php target=_blank>Terms of use</a></p><p><a href=https://www.eclipse.org/legal/copyright.php target=_blank>Copyright</a></p><p><a href=https://www.eclipse.org/security/ target=_blank>Report a security issue</a></p><p><a href=https://www.eclipse.org/legal/epl-2.0/ target=_blank>Eclipse Public License 2.0</a></p><p><a href=https://www.apache.org/licenses/LICENSE-2.0 target=_blank>Apache License 2.0</a></p><p><a href=https://www.eclipse.org/ target=_blank>Eclipse Foundation</a></p></div><div class=col-md-2><h5>Sponsored by:</h5><p><a href=https://www.eclipse.org target=_blank><img src=../../img/eclipse-foundation.svg style=width:120px></a></p><p><a href=https://www.adlinktech.com target=_blank><img src=https://cdn.adlinktech.com/webupd/en/Upload/logo.png style=width:120px></a></p><p><a href=https://www.futurewei.com target=_blank><img src=../../img/futurewei-logo.png style=width:120px></a></p></div><div class=col-md-2><h5>Follow us</h5><p><a href=https://github.com/eclipse-zenoh/zenoh><i class="fa fa-github" aria-hidden=true></i>GitHub</a></p><p><a href=https://gitter.im/atolab/zenoh><i class="fa fa fa-comments-o" aria-hidden=true></i>Gitter</a></p><p><a href=../../docs/overview/><i class="fa fa-info-circle" aria-hidden=true></i>About</a></p></div><div class=col-md-2><p><img src=../../img/zenoh-dragon.png style=width:45px></p><p>Eclipse zenoh &trade; is free, open source and always will be.</p><p>Copyright &copy 2021 Eclipse Foundation</p><p>Build with <a href=https://gohugo.io/ target=_blank>HUGO</a></p><p>Theme inspired from: <a href=https://tokio.rs/ target=_blank>Tokio website theme</a></p></div></div></div></footer><script src=https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js integrity=sha384-3ceskX3iaEnIogmQchP8opvBy3Mi7Ce34nWjpBIwVTHfGYWQS9jwHDVRnpKKHJg7 crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/tether/1.3.7/js/tether.min.js integrity=sha384-XTs3FgkjiBgo8qjEjBk0tGmf3wPrWtA6coPfQDfFEY8AnYJwjalXCiosYRBIBZX8 crossorigin=anonymous></script><script src=../../js/bootstrap.min.js></script><script src=../../js/highlight.js></script><script>$(function(){$("pre code").each(function(i,block){if(block.className.indexOf('language-rust')>=0){var new_content='';var lines=block.textContent.split('\n');for(var i=0;i<lines.length;i++){if(lines[i].indexOf('# ')==0||lines[i]=='#'){continue}
new_content+=lines[i].trimRight()+'\n';}
block.textContent=new_content.replace(/\n\n\n/g,"\n\n").trimRight();}
hljs.highlightBlock(block);});});</script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js></script><script type=text/javascript>docsearch({apiKey:'d7b5b785798fe748621bcaa8301a2201',indexName:'zenoh',inputSelector:'#search-input',debug:false});</script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-41082619-2','auto');ga('send','pageview');}</script></body></html>