<!doctype html><html lang=en><head><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.png><meta name=msapplication-TileImage content="/safari-pinned-tab.png"><meta name=msapplication-TileColor content="#7da7d8"><meta name=theme-color content="#7da7d8"><meta charset=utf-8><meta name=description content="Eclipse Zenoh, unify data in motion, data at rest and computations."><meta name=keywords content="pub/sub,query,geo distributed storage,Rust,protocol,DDS,MQTT,Edge,IoT,MEC"><meta name=author content="The Zenoh Team"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta http-equiv=x-ua-compatible content="ie=edge"><link rel=stylesheet href=../../css/bootstrap-reboot.css><link rel=stylesheet href=../../css/bootstrap.css><link rel=stylesheet href=../../css/font-awesome.min.css><link rel=stylesheet href=../../css/ato.css><link rel=stylesheet href=../../css/syntax.css><link rel=alternate type=application/rss+xml href=../../blog/index.xml><title>Zenoh 1.0.0 "Firesong" is ready to rock! · Zenoh - pub/sub, geo distributed storage, query</title></head><body><header class="navbar-expand navbar-dark d-flex flex-column flex-md-row align-items-md-center ato-navbar"><div class="d-flex flex-row justify-content-between pl-2 pr-2"><a class=navbar-brand href=../../><img src=../../img/zenoh-dragon-bg-150x163.png class=align-middle alt></a>
<button class="btn btn-link d-md-none p-0" type=button data-toggle=collapse data-target=#ato-nav aria-controls=ato-nav aria-expanded=false aria-label="Toggle navigation"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 30 30" width="30" height="30" focusable="false"><title>Menu</title><path stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-miterlimit="10" d="M4 7h22M4 15h22M4 23h22"/></svg></button></div><div class="ato-links collapse pl-4 pl-md-0" id=ato-nav><ul class="navbar-nav flex-column flex-md-row"><li class=nav-item><a class=nav-link href=../../>Home</a></li><li class=nav-item><a class=nav-link href=../../docs/getting-started/first-app/>Documentation</a></li><li class=nav-item><a class=nav-link href=../../usecases/>Use Cases</a></li><li class=nav-item><a class=nav-link href=../../community/>Community</a></li><li class=nav-item><a class=nav-link href=../../adopters/>Adopters</a></li><li class=nav-item><a class=nav-link href=../../media/>Media</a></li><li class=nav-item><a class="nav-link active" href=../../blog/2024-10-21-zenoh-firesong/>Blog</a></li></ul></div><ul class="navbar-nav flex-row ml-md-auto d-none d-md-flex"><li class=nav-item><a class="nav-link p-2" href=https://github.com/eclipse-zenoh/zenoh target=_blank rel=noopener aria-label=GitHub><svg class="navbar-nav-svg" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 512 499.36" focusable="false"><title>GitHub</title><path d="M256 0C114.64.0.0 114.61.0 256c0 113.09 73.34 209 175.08 242.9 12.8 2.35 17.47-5.56 17.47-12.34.0-6.08-.22-22.18-.35-43.54-71.2 15.49-86.2-34.34-86.2-34.34-11.64-29.57-28.42-37.45-28.42-37.45-23.27-15.84 1.73-15.55 1.73-15.55 25.69 1.81 39.21 26.38 39.21 26.38 22.84 39.12 59.92 27.82 74.5 21.27 2.33-16.54 8.94-27.82 16.25-34.22-56.84-6.43-116.6-28.43-116.6-126.49.0-27.95 10-50.8 26.35-68.69-2.63-6.48-11.42-32.5 2.51-67.75.0.0 21.49-6.88 70.4 26.24a242.65 242.65.0 01128.18.0c48.87-33.13 70.33-26.24 70.33-26.24 14 35.25 5.18 61.27 2.55 67.75 16.41 17.9 26.31 40.75 26.31 68.69.0 98.35-59.85 120-116.88 126.32 9.19 7.9 17.38 23.53 17.38 47.41.0 34.22-.31 61.83-.31 70.23.0 6.85 4.61 14.81 17.6 12.31C438.72 464.97 512 369.08 512 256.02 512 114.62 397.37.0 256 0z" fill="currentcolor" fill-rule="evenodd"/></svg></a></li><li class=nav-item><a class="nav-link p-2" href=https://twitter.com/zettascaletech target=_blank rel=noopener aria-label=Twitter><svg class="navbar-nav-svg" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 512 416.32" focusable="false"><title>Twitter</title><path d="M160.83 416.32c193.2.0 298.92-160.22 298.92-298.92.0-4.51.0-9-.2-13.52A214 214 0 00512 49.38a212.93 212.93.0 01-60.44 16.6 105.7 105.7.0 0046.3-58.19 209 209 0 01-66.79 25.37 105.09 105.09.0 00-181.73 71.91 116.12 116.12.0 002.66 24c-87.28-4.3-164.73-46.3-216.56-109.82A105.48 105.48.0 0068 159.6a106.27 106.27.0 01-47.53-13.11v1.43a105.28 105.28.0 0084.21 103.06 105.67 105.67.0 01-47.33 1.84 105.06 105.06.0 0098.14 72.94A210.72 210.72.0 0125 370.84a202.17 202.17.0 01-25-1.43 298.85 298.85.0 00160.83 46.92" fill="currentcolor"/></svg></a></li><li class=nav-item><a class="nav-link p-2" href=https://discord.gg/2GJ958VuHs target=_blank rel=noopener aria-label=Discord><svg class="navbar-nav-svg" xmlns="http://www.w3.org/2000/svg" focusable="false"><title>Discord</title><path fill="currentcolor" d="M13.545 2.907a13.227 13.227.0 00-3.257-1.011.05.05.0 00-.052.025c-.141.25-.297.577-.406.833a12.19 12.19.0 00-3.658.0 8.258 8.258.0 00-.412-.833.051.051.0 00-.052-.025c-1.125.194-2.22.534-3.257 1.011a.041.041.0 00-.021.018C.356 6.024-.213 9.047.066 12.032c.001.014.01.028.021.037a13.276 13.276.0 003.995 2.02.05.05.0 00.056-.019c.308-.42.582-.863.818-1.329a.05.05.0 00-.01-.059.051.051.0 00-.018-.011 8.875 8.875.0 01-1.248-.595.05.05.0 01-.02-.066.051.051.0 01.015-.019c.084-.063.168-.129.248-.195a.05.05.0 01.051-.007c2.619 1.196 5.454 1.196 8.041.0a.052.052.0 01.053.007c.08.066.164.132.248.195a.051.051.0 01-.004.085 8.254 8.254.0 01-1.249.594.05.05.0 00-.03.03.052.052.0 00.003.041c.24.465.515.909.817 1.329a.05.05.0 00.056.019 13.235 13.235.0 004.001-2.02.049.049.0 00.021-.037c.334-3.451-.559-6.449-2.366-9.106a.034.034.0 00-.02-.019zm-8.198 7.307c-.789.0-1.438-.724-1.438-1.612.0-.889.637-1.613 1.438-1.613.807.0 1.45.73 1.438 1.613.0.888-.637 1.612-1.438 1.612zm5.316.0c-.788.0-1.438-.724-1.438-1.612.0-.889.637-1.613 1.438-1.613.807.0 1.451.73 1.438 1.613.0.888-.631 1.612-1.438 1.612z"/></svg></a></li><li class=nav-item><a class="nav-link p-2" href=https://www.youtube.com/channel/UCslbiyiqgOAPMjCrPWIfQ5Q target=_blank rel=noopener aria-label=Youtube><svg class="navbar-nav-svg" xmlns="http://www.w3.org/2000/svg" focusable="false"><title>Youtube</title><path fill="currentcolor" d="M8.051 1.999h.089c.822.003 4.987.033 6.11.335a2.01 2.01.0 011.415 1.42c.101.38.172.883.22 1.402l.01.104.022.26.008.104c.065.914.073 1.77.074 1.957v.075c-.001.194-.01 1.108-.082 2.06l-.008.105-.009.104c-.05.572-.124 1.14-.235 1.558a2.007 2.007.0 01-1.415 1.42c-1.16.312-5.569.334-6.18.335h-.142c-.309.0-1.587-.006-2.927-.052l-.17-.006-.087-.004-.171-.007-.171-.007c-1.11-.049-2.167-.128-2.654-.26a2.007 2.007.0 01-1.415-1.419c-.111-.417-.185-.986-.235-1.558L.09 9.82.082 9.716A31.4 31.4.0 010 7.68v-.123c.002-.215.01-.958.064-1.778l.007-.103.003-.052.008-.104.022-.26.01-.104c.048-.519.119-1.023.22-1.402a2.007 2.007.0 011.415-1.42c.487-.13 1.544-.21 2.654-.26l.17-.007.172-.006.086-.003.171-.007A99.788 99.788.0 017.858 2h.193zM6.4 5.209v4.818l4.157-2.408L6.4 5.209z"/></svg></a></li></ul><script async src="https://www.googletagmanager.com/gtag/js?id=G-PBD6MS51QL"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-PBD6MS51QL")</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":""},"articleSection":"blog","name":"Zenoh 1.0.0 \u0022Firesong\u0022 is ready to rock!","headline":"Zenoh 1.0.0 \u0022Firesong\u0022 is ready to rock!","datePublished":"2024-10-01 00:00:00 \u002b0000 UTC","dateModified":"2024-10-01 00:00:00 \u002b0000 UTC","url":"\/blog\/2024-10-21-zenoh-firesong\/","inLanguage":"en-US","author":"","creator":"","publisher":"","accountablePerson":"","copyrightHolder":"","copyrightYear":"1011","wordCount":"5168","keywords":[],"description":"21st October 2024"}</script></header><div class="container-fluid ato-blog"><div class="row flex-xl-nowrap"><div class="col-12 col-md-3 col-xl-2 ato-sidebar"><div class="ato-docs-toggle d-md-none p-0 d-flex ml-3 collapsed align-item-center"><h1 class=ato-title>Zenoh 1.0.0 "Firesong" is ready to rock!</h1><button class="btn btn-link" type=button data-toggle=collapse data-target=#ato-docs-nav aria-controls=ato-docs-nav aria-expanded=false aria-label="Toggle docs navigation"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 30 30" width="30" height="30" focusable="false"><title>Menu</title><path stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-miterlimit="10" d="M4 7h22M4 15h22M4 23h22"/></svg></button></div><nav class="ato-links collapse" id=ato-docs-nav><div class="ato-toc-item active"><p class=ato-toc-link>Blog Posts</p><ul class="nav ato-sidenav"><li><a href=../../blog/2024-10-21-zenoh-firesong/>Zenoh 1.0.0 "Firesong" is ready to rock!</a></li><li><a href=../../blog/2024-04-30-zenoh-electrode/>Zenoh 0.11.0 "Electrode" release is out!</a></li><li><a href=../../blog/2024-04-17-datadog-zenoh-router-integration/>Streamlining Zenoh router Monitoring with Datadog Integration</a></li><li><a href=../../blog/2024-01-31-zenoh-flow-getting-started/>Zenoh-Flow 0.6.0-rc: Getting Started</a></li><li><a href=../../blog/2023-10-03-zenoh-dragonite/>Zenoh Dragonite Took Off!</a></li><li><a href=../../blog/2023-07-17-s3-backend/>Zenoh Storage Gets a Boost: Empowering Storage with S3 Integration</a></li><li><a href=../../blog/2023-06-05-charmander2/>Zenoh Charmander Grows Stronger</a></li><li><a href=../../blog/2023-04-04-letsencrypt/>Securing Zenoh with LetsEncrypt: A Comprehensive Guide</a></li><li><a href=../../blog/2023-03-21-zenoh-vs-mqtt-kafka-dds/>Comparing the Performance of Zenoh, MQTT, Kafka, and DDS</a></li><li><a href=../../blog/2023-02-10-zenoh-flow/>Data Flow programming with Zenoh-Flow</a></li><li><a href=../../blog/2023-01-17-zenoh-wireshark/>The Blue Dragon meets the Wire’s Shark</a></li><li><a href=../../blog/2023-01-10-zenoh-charmander/>Zenoh Charmander is coming to town</a></li><li><a href=../../blog/2022-11-29-zenoh-alignment/>Keeping storages aligned in Zenoh</a></li><li><a href=../../blog/2022-09-30-zenoh-bahamut/>Zenoh Bahamut takes flight!</a></li><li><a href=../../blog/2022-08-12-zenoh-serial/>There is Land Besides IP: How to Cross It with Zenoh</a></li><li><a href=../../blog/2022-06-09-zenoh-pico-above-and-beyond/>Zenoh-Pico: Above and Beyond</a></li><li><a href=../../blog/2022-04-14-rust-async-eval/>A Performance Evaluation on Rust Asynchronous Frameworks</a></li><li><a href=../../blog/2022-03-30-zenoh-mobility/>Mobility, Latency and Energy saving</a></li><li><a href=../../blog/2022-02-08-dragonbot/>DragonBotOne Egg Hatching with Zenoh and Zenoh-Pico</a></li><li><a href=../../blog/2021-11-09-ros2-zenoh-pico/>ROS 2 and microcontrollers integration via Zenoh-pico</a></li><li><a href=../../blog/2021-10-04-zenoh-pico-guide/>Zenoh goes embedded with zenoh-pico</a></li><li><a href=../../blog/2021-09-28-iac-experiences-from-the-trenches/>Indy Autonomous Challenge (IAC): Experiences from the Trenches</a></li><li><a href=../../blog/2021-07-13-zenoh-performance-async/>Zenoh performance: a stroll in Rust async wonderland</a></li><li><a href=../../blog/2021-07-05-zenoh-overhead/>Zenoh overhead: a story from our community</a></li><li><a href=../../blog/2021-06-14-zenoh-reliability/>Zenoh Reliability, Scalability and Congestion Control</a></li><li><a href=../../blog/2021-04-28-ros2-integration/>Integrating ROS2 with Eclipse zenoh</a></li><li><a href=../../blog/2021-03-23-discovery/>Minimizing Discovery Overhead in ROS2</a></li><li><a href=../../blog/2020-10-08-aithusa/>Zenoh Aithusa Hatched Out!</a></li><li><a href=../../blog/2020-06-29-zenoh-tidings/>Zenoh Tidings</a></li><li><a href=../../blog/2020-01-01-zenohtude/>A Year Full of Zenoh</a></li></ul></div></nav></div><div class="d-none d-xl-block col-xl-2 ato-toc"><div class=section-nav><nav id=TableOfContents><ul><li><a href=#improved-api-approach>Improved API approach</a><ul><li><a href=#accessors>Accessors</a></li><li><a href=#zbytes>ZBytes</a></li><li><a href=#encoding>Encoding</a></li><li><a href=#query--queryable>Query & Queryable</a></li><li><a href=#timestamps>Timestamps</a></li><li><a href=#ring-channel>Ring channel</a></li></ul></li><li><a href=#c-api>C API</a><ul><li></li></ul></li><li><a href=#c-api-1>C++ API</a><ul><li></li></ul></li><li><a href=#python-api>Python API</a></li><li><a href=#kotlin-api>Kotlin API</a></li><li><a href=#java-api>Java API</a></li><li><a href=#typescript-api>TypeScript API</a></li><li><a href=#shared-memory>Shared Memory</a></li><li><a href=#plugins>Plugins</a></li><li><a href=#interest-protocol>Interest protocol</a></li><li><a href=#access-control>Access Control</a></li><li><a href=#batching-and-jitter>Batching and jitter</a></li><li><a href=#link-selection>Link selection</a></li><li><a href=#storage-alignment-protocol>Storage Alignment Protocol</a></li><li><a href=#tlsmtlsquic-configuration>TLS/mTLS/QUIC Configuration</a></li><li><a href=#zenoh-pico>Zenoh-Pico</a></li><li><a href=#changelog>Changelog</a></li><li><a href=#whats-next>What’s next?</a></li></ul></nav></div></div><main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 ato-content ato-docs"><h1 class=ato-title>Zenoh 1.0.0 "Firesong" is ready to rock!</h1><p class=ato-date>21st October 2024</p><p>As a result of an incredible effort from the whole Zenoh team and Zenoh community, we can finally announce that Zenoh 1.0.0 <em>Firesong</em> is out!</p><figure class="responsive-figure figure-inline"><img src=../../img/20241021-blog-zenoh-firesong/comic-october-2024.png alt="Zenoh comic October 2024" width=100% height=auto></figure><style>.responsive-figure{display:flex;justify-content:center}.responsive-figure img{max-width:720px;height:auto}</style><p>This release marks an incredible milestone for Zenoh and comes with a lot of features and improvements:</p><ul><li>API stabilization. Great attention has been given to the API, its revision and rework to provide the necessary level of stability and future extensibility.</li><li>The very first alpha version of the new TypeScript API.</li><li>A full rework of the Shared Memory subsystem in Zenoh, with a new API and more supported topologies.</li><li>Improved batching and jitter performance for high frequency publications.</li><li>Improved protocol for write-side filtering.</li></ul><p>Let us take a closer look at what Zenoh 1.0.0 brings to the table.</p><hr><h2 id=improved-api-approach>Improved API approach</h2><p>Zenoh&rsquo;s API has been improved in terms of ergonomics, clarity, and composability for future extensibility!
The following sections highlight the main changes of the API in the various language bindings.
The full migration guide of each language is available <a href=https://zenoh.io/docs/migration_1.0/concepts/>here</a>.</p><h3 id=accessors>Accessors</h3><p>To better separate the public API from the internal implementation, we have introduced the accessor pattern in the Zenoh API across all language bindings.
See an example in Rust below.
Please note that the same approach would apply to all Zenoh APIs.</p><p>Zenoh 0.11.0:</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#069;font-weight:700>while</span><span style=color:#bbb> </span><span style=color:#069;font-weight:700>let</span><span style=color:#bbb> </span><span style=color:#366>Ok</span>(sample)<span style=color:#bbb> </span><span style=color:#555>=</span><span style=color:#bbb> </span>subscriber.recv_async().<span style=color:#069;font-weight:700>await</span><span style=color:#bbb> </span>{<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>println!(<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#c30>&#34;&gt;&gt; [Subscriber] Received {} (&#39;{}&#39;: &#39;{}&#39;)&#34;</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>sample.kind,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>sample.key_expr.as_str(),<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>}<span style=color:#bbb>
</span></span></span></code></pre></div><p>Zenoh 1.0.0:</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#069;font-weight:700>while</span><span style=color:#bbb> </span><span style=color:#069;font-weight:700>let</span><span style=color:#bbb> </span><span style=color:#366>Ok</span>(sample)<span style=color:#bbb> </span><span style=color:#555>=</span><span style=color:#bbb> </span>subscriber.recv_async().<span style=color:#069;font-weight:700>await</span><span style=color:#bbb> </span>{<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>println!(<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#c30>&#34;&gt;&gt; [Subscriber] Received {} (&#39;{}&#39;: &#39;{}&#39;)&#34;</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>sample.kind(),<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>sample.key_expr().as_str(),<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>}<span style=color:#bbb>
</span></span></span></code></pre></div><h3 id=zbytes>ZBytes</h3><p><code>Value</code> was a type that contained a payload (<code>ZBuf</code>) and some metadata about the <code>Encoding</code>. It was generally accepted in functions like <code>put()</code> and <code>reply()</code>.
Zenoh 1.0.0 deprecates <code>Value</code> in favour of explicitly separating <code>ZBytes</code> and <code>Encoding</code> in the API. This has the benefit of improving API and network overhead.</p><p><code>ZBytes</code> is the core type for raw data representation in Zenoh.
All API has been reworked to accept <code>ZBytes</code> or a type that can be transparantely converted into a <code>ZBytes</code>, such as a string.
Sample’s payloads are now <code>ZBytes</code>. <code>Publisher</code>, <code>Queryable</code> and <code>Subscriber</code> now expect <code>ZBytes</code> for all their interfaces.
The Attachment API also now accepts <code>ZBytes</code>.</p><p>Zenoh 0.11.0:</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#09f;font-style:italic>// Publisher
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>// “My Value” is converted in bytes and the “string” encoding was automatically set
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span>session.put(<span style=color:#a00;background-color:#faa>“</span>test<span style=color:#555>/</span>foo<span style=color:#a00;background-color:#faa>”</span>,<span style=color:#bbb> </span><span style=color:#a00;background-color:#faa>“</span>My<span style=color:#bbb> </span>Value<span style=color:#a00;background-color:#faa>”</span>).res().<span style=color:#069;font-weight:700>await</span>.unwrap();<span style=color:#bbb> 
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#09f;font-style:italic>// Subscriber
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>// Data can be accessed directly and encoding metadata is not required to be checked
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>// Some bandwidth was wasted for nothing
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span><span style=color:#069;font-weight:700>let</span><span style=color:#bbb> </span>string<span style=color:#bbb> </span><span style=color:#555>=</span><span style=color:#bbb> </span><span style=color:#366>String</span>::from_utf8_lossy(sample.value.contiguous());<span style=color:#bbb>
</span></span></span></code></pre></div><p>Zenoh 1.0.0:</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#09f;font-style:italic>// Publisher
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>// “My Value” is a string that can be diretly converted in bytes, no encoding is automatically set
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span>session.put(<span style=color:#a00;background-color:#faa>“</span>test<span style=color:#555>/</span>foo<span style=color:#a00;background-color:#faa>”</span>,<span style=color:#bbb> </span><span style=color:#a00;background-color:#faa>“</span>My<span style=color:#bbb> </span>Value<span style=color:#a00;background-color:#faa>”</span>).attachment(<span style=color:#a00;background-color:#faa>“</span>My<span style=color:#bbb> </span>attachment<span style=color:#a00;background-color:#faa>”</span>).<span style=color:#069;font-weight:700>await</span>.unwrap();<span style=color:#bbb> 
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#09f;font-style:italic>// Subscriber
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>// Convert data type using
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span><span style=color:#069;font-weight:700>let</span><span style=color:#bbb> </span>string<span style=color:#bbb> </span><span style=color:#555>=</span><span style=color:#bbb> </span><span style=color:#366>String</span>::from_utf8_lossy(<span style=color:#555>&amp;</span>sample.payload().to_bytes());<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#069;font-weight:700>let</span><span style=color:#bbb> </span>value<span style=color:#bbb> </span><span style=color:#555>=</span><span style=color:#bbb> </span>sample.payload().try_to_string().unwrap();<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#069;font-weight:700>let</span><span style=color:#bbb> </span>attach<span style=color:#bbb> </span><span style=color:#555>=</span><span style=color:#bbb> </span>sample.attachment().try_to_string().unwrap();<span style=color:#bbb>
</span></span></span></code></pre></div><p>It is worth highlighting that Zenoh semantics and protocol take care of sending and receiving bytes without restricting the actual data types.
Nonetheless, in the spirit of always improving user&rsquo;s life with a simple out-of-the-box experience, we have added a number of optional serializer/deserializer to deal with language primitive types (e.g., integeres, floats, tuples, etc.).
This serializer/deserializer is NOT by any means the only serializer/deserializer users can use nor a limitation to the types supported by Zenoh.
Users are free and encouraged to use any serializer/deserializer of their choice like JSON, protobuf, bincode, flatbuffers, etc.</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#069;font-weight:700>use</span><span style=color:#bbb> </span>zenoh_ext::{z_deserialize,<span style=color:#bbb> </span>z_serialize};<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#09f;font-style:italic>// Numeric types: u8, u16, u32, u128, i8, i16, i32, i128, f32, f64
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span><span style=color:#069;font-weight:700>let</span><span style=color:#bbb> </span>input<span style=color:#bbb> </span><span style=color:#555>=</span><span style=color:#bbb> </span><span style=color:#f60>1234_</span><span style=color:#069;font-weight:700>u32</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#069;font-weight:700>let</span><span style=color:#bbb> </span>payload<span style=color:#bbb> </span><span style=color:#555>=</span><span style=color:#bbb> </span>z_serialize(<span style=color:#555>&amp;</span>input);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#069;font-weight:700>let</span><span style=color:#bbb> </span>output: <span style=color:#078;font-weight:700>u32</span> <span style=color:#555>=</span><span style=color:#bbb> </span>z_deserialize(<span style=color:#555>&amp;</span>payload).unwrap();<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>assert_eq!(input,<span style=color:#bbb> </span>output);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#09f;font-style:italic>// Vec
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span><span style=color:#069;font-weight:700>let</span><span style=color:#bbb> </span>input<span style=color:#bbb> </span><span style=color:#555>=</span><span style=color:#bbb> </span>vec![<span style=color:#f60>0.0</span><span style=color:#069;font-weight:700>f32</span>,<span style=color:#bbb> </span><span style=color:#f60>1.5</span>,<span style=color:#bbb> </span><span style=color:#f60>42.0</span>];<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#069;font-weight:700>let</span><span style=color:#bbb> </span>payload<span style=color:#bbb> </span><span style=color:#555>=</span><span style=color:#bbb> </span>z_serialize(<span style=color:#555>&amp;</span>input);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#069;font-weight:700>let</span><span style=color:#bbb> </span>output: <span style=color:#366>Vec</span><span style=color:#555>&lt;</span><span style=color:#078;font-weight:700>f32</span><span style=color:#555>&gt;</span><span style=color:#bbb> </span><span style=color:#555>=</span><span style=color:#bbb> </span>z_deserialize(<span style=color:#555>&amp;</span>payload).unwrap();<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>assert_eq!(input,<span style=color:#bbb> </span>output);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#09f;font-style:italic>// HashMap
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span><span style=color:#069;font-weight:700>let</span><span style=color:#bbb> </span><span style=color:#069;font-weight:700>mut</span><span style=color:#bbb> </span>input: <span style=color:#0a8;font-weight:700>HashMap</span><span style=color:#555>&lt;</span><span style=color:#078;font-weight:700>u32</span>,<span style=color:#bbb> </span><span style=color:#366>String</span><span style=color:#555>&gt;</span><span style=color:#bbb> </span><span style=color:#555>=</span><span style=color:#bbb> </span>HashMap::new();<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>input.insert(<span style=color:#f60>0</span>,<span style=color:#bbb> </span><span style=color:#366>String</span>::from(<span style=color:#c30>&#34;abc&#34;</span>));<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>input.insert(<span style=color:#f60>1</span>,<span style=color:#bbb> </span><span style=color:#366>String</span>::from(<span style=color:#c30>&#34;def&#34;</span>));<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#069;font-weight:700>let</span><span style=color:#bbb> </span>payload<span style=color:#bbb> </span><span style=color:#555>=</span><span style=color:#bbb> </span>z_serialize(<span style=color:#555>&amp;</span>input);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#069;font-weight:700>let</span><span style=color:#bbb> </span>output: <span style=color:#0a8;font-weight:700>HashMap</span><span style=color:#555>&lt;</span><span style=color:#078;font-weight:700>u32</span>,<span style=color:#bbb> </span><span style=color:#366>String</span><span style=color:#555>&gt;</span><span style=color:#bbb> </span><span style=color:#555>=</span><span style=color:#bbb> </span>z_deserialize(<span style=color:#555>&amp;</span>payload).unwrap();<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>assert_eq!(input,<span style=color:#bbb> </span>output);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#09f;font-style:italic>// Tuple
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span><span style=color:#069;font-weight:700>let</span><span style=color:#bbb> </span>input<span style=color:#bbb> </span><span style=color:#555>=</span><span style=color:#bbb> </span>(<span style=color:#f60>0.42</span><span style=color:#069;font-weight:700>f64</span>,<span style=color:#bbb> </span><span style=color:#c30>&#34;string&#34;</span>.to_string());<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#069;font-weight:700>let</span><span style=color:#bbb> </span>payload<span style=color:#bbb> </span><span style=color:#555>=</span><span style=color:#bbb> </span>z_serialize(<span style=color:#555>&amp;</span>input);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#069;font-weight:700>let</span><span style=color:#bbb> </span>output: (<span style=color:#078;font-weight:700>f64</span>,<span style=color:#bbb> </span><span style=color:#366>String</span>)<span style=color:#bbb> </span><span style=color:#555>=</span><span style=color:#bbb> </span>z_deserialize(<span style=color:#555>&amp;</span>payload).unwrap();<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>assert_eq!(input,<span style=color:#bbb> </span>output);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#09f;font-style:italic>// Array (handled as variable-length sequence, not as tuple)
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span><span style=color:#069;font-weight:700>let</span><span style=color:#bbb> </span>input<span style=color:#bbb> </span><span style=color:#555>=</span><span style=color:#bbb> </span>[<span style=color:#f60>0.0</span><span style=color:#069;font-weight:700>f32</span>,<span style=color:#bbb> </span><span style=color:#f60>1.5</span>,<span style=color:#bbb> </span><span style=color:#f60>42.0</span>];<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#069;font-weight:700>let</span><span style=color:#bbb> </span>payload<span style=color:#bbb> </span><span style=color:#555>=</span><span style=color:#bbb> </span>z_serialize(<span style=color:#555>&amp;</span>input);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#069;font-weight:700>let</span><span style=color:#bbb> </span>output: [<span style=color:#078;font-weight:700>f32</span>;<span style=color:#bbb> </span><span style=color:#f60>3</span>]<span style=color:#bbb> </span><span style=color:#555>=</span><span style=color:#bbb> </span>z_deserialize(<span style=color:#555>&amp;</span>payload).unwrap();<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>assert_eq!(input,<span style=color:#bbb> </span>output);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#09f;font-style:italic>// can also be deserialized as a vec
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span><span style=color:#069;font-weight:700>let</span><span style=color:#bbb> </span>output: <span style=color:#366>Vec</span><span style=color:#555>&lt;</span><span style=color:#078;font-weight:700>f32</span><span style=color:#555>&gt;</span><span style=color:#bbb> </span><span style=color:#555>=</span><span style=color:#bbb> </span>z_deserialize(<span style=color:#555>&amp;</span>payload).unwrap();<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>assert_eq!(input.as_slice(),<span style=color:#bbb> </span>output);<span style=color:#bbb>
</span></span></span></code></pre></div><p>You can have a look at the <a href=https://github.com/eclipse-zenoh/zenoh/blob/main/examples/examples/z_bytes.rs>z_bytes example</a> for additional examples.</p><h3 id=encoding>Encoding</h3><p><code>Encoding</code> has been reworked, moving away from enumerables to now accepting strings.
While Zenoh does not impose any <code>Encoding</code> requirement on the user, providing an <code>Encoding</code> can offer automatic wire-level optimization for known types.<br>For the user defined <code>Encoding</code>, it can be thought of as optional metadata, carried over by Zenoh in such a way that the end user’s application may perform different operations based on <code>Encoding</code>.<br>We have expanded our list of predefined encoding types from Zenoh 0.11.0 to include variants for numerous IANA standard encodings, including but not limited to <code>video/x</code> , <code>application/x</code>, <code>text/x</code>, <code>image/x</code> and <code>audio/x</code> encoding families, as well as an encoding family specific to Zenoh defined by the prefix <code>zenoh/x</code> .<br>Users can also define their own encoding scheme that does not need to be based on the predefined IANA variants.</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#09f;font-style:italic>// Publisher
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>// Encoding::TEXT_PLAIN is a convenience constant equivalent to “text/plain”
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span>session.put(<span style=color:#a00;background-color:#faa>“</span>test<span style=color:#555>/</span>foo<span style=color:#a00;background-color:#faa>”</span>,<span style=color:#bbb> </span><span style=color:#a00;background-color:#faa>“</span>My<span style=color:#bbb> </span>Value<span style=color:#a00;background-color:#faa>”</span>).encoding(Encoding::TEXT_PLAIN).<span style=color:#069;font-weight:700>await</span>.unwrap();<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#09f;font-style:italic>// Subscriber
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span><span style=color:#069;font-weight:700>if</span><span style=color:#bbb> </span>sample.encoding()<span style=color:#bbb> </span><span style=color:#555>==</span><span style=color:#bbb> </span>Encoding::TEXT_PLAIN<span style=color:#bbb> </span>{<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#069;font-weight:700>let</span><span style=color:#bbb> </span>s<span style=color:#bbb> </span><span style=color:#555>=</span><span style=color:#bbb> </span>sample.payload().try_to_string().unwrap()<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>}<span style=color:#bbb>
</span></span></span></code></pre></div><p>Example of using custom encoding:</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#09f;font-style:italic>// Publisher
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>// Encoding::TEXT_PLAIN is a convenience constant equivalent to “text/plain”
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span>session.put(<span style=color:#a00;background-color:#faa>“</span>test<span style=color:#555>/</span>foo<span style=color:#a00;background-color:#faa>”</span>,<span style=color:#bbb> </span>vec![<span style=color:#f60>0</span><span style=color:#069;font-weight:700>u8</span>;<span style=color:#bbb> </span><span style=color:#f60>64</span>]).encoding(<span style=color:#a00;background-color:#faa>“</span>my_encoding<span style=color:#a00;background-color:#faa>”</span>).<span style=color:#069;font-weight:700>await</span>.unwrap();<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#09f;font-style:italic>// Subscriber
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span><span style=color:#069;font-weight:700>if</span><span style=color:#bbb> </span><span style=color:#555>&amp;</span>sample.encoding().to_string()<span style=color:#bbb> </span><span style=color:#555>==</span><span style=color:#bbb> </span><span style=color:#a00;background-color:#faa>“</span>my_encoding<span style=color:#a00;background-color:#faa>”</span><span style=color:#bbb> </span>{<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#069;font-weight:700>let</span><span style=color:#bbb> </span>reader<span style=color:#bbb> </span><span style=color:#555>=</span><span style=color:#bbb> </span>sample.payload().reader();<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#09f;font-style:italic>// Deserialize the type according to the encoding
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span>}<span style=color:#bbb>
</span></span></span></code></pre></div><h3 id=query--queryable>Query & Queryable</h3><p>The <code>reply</code> method of a <code>Queryable</code> has gained two variants:</p><ul><li><code>reply_del</code> to indicate that a deletion should be performed.</li><li><code>reply_err</code> to indicate that an error occurred.</li></ul><p>Additionally, these variants behave similarly to <code>put</code> and <code>del</code>, providing improved ergonomics.</p><p>We have added the ability to get the underlying <code>Handler</code> of a Queryable as well.</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#09f;font-style:italic>// Queryable
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span><span style=color:#069;font-weight:700>while</span><span style=color:#bbb> </span><span style=color:#069;font-weight:700>let</span><span style=color:#bbb> </span><span style=color:#366>Ok</span>(query)<span style=color:#bbb> </span><span style=color:#555>=</span><span style=color:#bbb> </span>queryable.recv_async().<span style=color:#069;font-weight:700>await</span><span style=color:#bbb> </span>{<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>query<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>.reply(key_expr.clone(),<span style=color:#bbb> </span>payload.clone())<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>         </span><span style=color:#09f;font-style:italic>// Or reply with a delete
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span><span style=color:#bbb>         </span><span style=color:#09f;font-style:italic>// .reply_del(key_expr.clone())
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span><span style=color:#bbb>         </span><span style=color:#09f;font-style:italic>// Or reply with an error
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span><span style=color:#bbb>         </span><span style=color:#09f;font-style:italic>// .reply_err(“My error”)
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span><span style=color:#bbb>        </span>.<span style=color:#069;font-weight:700>await</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>.unwrap();<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>}<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#09f;font-style:italic>// Querier
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span><span style=color:#069;font-weight:700>let</span><span style=color:#bbb> </span>replies<span style=color:#bbb> </span><span style=color:#555>=</span><span style=color:#bbb> </span>session.get(<span style=color:#a00;background-color:#faa>“</span>test<span style=color:#555>/</span>foo<span style=color:#a00;background-color:#faa>”</span>).<span style=color:#069;font-weight:700>await</span>.unwrap();<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#069;font-weight:700>while</span><span style=color:#bbb> </span><span style=color:#069;font-weight:700>let</span><span style=color:#bbb> </span><span style=color:#366>Ok</span>(reply)<span style=color:#bbb> </span><span style=color:#555>=</span><span style=color:#bbb> </span>replies.recv_async().<span style=color:#069;font-weight:700>await</span><span style=color:#bbb> </span>{<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#069;font-weight:700>match</span><span style=color:#bbb> </span>reply.result()<span style=color:#bbb> </span>{<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#366>Ok</span>(sample)<span style=color:#bbb> </span><span style=color:#555>=&gt;</span><span style=color:#bbb> </span><span style=color:#069;font-weight:700>match</span><span style=color:#bbb> </span>sample.kind()<span style=color:#bbb> </span>{<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>            </span>SampleKind::Put<span style=color:#bbb> </span><span style=color:#555>=&gt;</span><span style=color:#bbb> </span>{<span style=color:#bbb> </span><span style=color:#09f;font-style:italic>/* Handle .reply() */</span><span style=color:#bbb> </span>},<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>            </span>SampleKind::Del<span style=color:#bbb> </span><span style=color:#555>=&gt;</span><span style=color:#bbb> </span>{<span style=color:#bbb> </span><span style=color:#09f;font-style:italic>/* Handle .reply_del() */</span><span style=color:#bbb> </span>},<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>},<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#366>Err</span>(err)<span style=color:#bbb> </span><span style=color:#555>=&gt;</span><span style=color:#bbb> </span>{<span style=color:#bbb> </span><span style=color:#09f;font-style:italic>/* Handle .reply_err() and any infrastructure error */</span><span style=color:#bbb>  </span>}<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>}<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>}<span style=color:#bbb>
</span></span></span></code></pre></div><h3 id=timestamps>Timestamps</h3><p>Zenoh timestamps are based on an <a href=https://github.com/atolab/uhlc-rs>Unique Hybrid Logical Clock</a>, which is largely used in the Zenoh Storage Alignment protocol. One of the requirements for the alignment protocol is to be able to uniquely identify who published the data and consequently who generated the timestamp. Zenoh 0.11.0 exposed a function to generate timestamps outside of a session, which could be used in a Zenoh system. Due to our efforts to improve the storage replication logic, now timestamps are generated from a session, with the timestamp inheriting the <code>ZenohID</code> of the session. Users are not expected to generate timestamps by themselves but rather to rely on the <a href=https://github.com/eclipse-zenoh/zenoh/blob/6b7ec55911ce85a243c6eae857cbddd7ab1d0021/DEFAULT_CONFIG.json5#L133>timestamping functionality</a> of Zenoh.</p><h3 id=ring-channel>Ring channel</h3><p>A pull subscriber was mainly used to pull the latest data available for a given subscriber.
In Zenoh 1.0.0, we have removed the pull subscriber as part of some rework to streamline the API and the protocol.
This leads to the fact that only one type of subscriber exists.
However, to keep the functionality of being able to pull the last data, we have added a <code>RingChannel</code> for the subscriber (as well as for the queryable and get) that can be used to get a similar behaviour.
Once full, the <code>RingChannel</code> will replace older data with most recent ones. This contrasts with the <code>FIFOChannel</code>, the default channel type used by Subscribers, which blocks once its buffer is full.</p><p>Publisher example:</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#099>#[tokio::main]</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#069;font-weight:700>async</span><span style=color:#bbb> </span><span style=color:#069;font-weight:700>fn</span> <span style=color:#c0f>main</span>()<span style=color:#bbb> </span>{<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#069;font-weight:700>let</span><span style=color:#bbb> </span>session<span style=color:#bbb> </span><span style=color:#555>=</span><span style=color:#bbb> </span>zenoh::open(Config::default()).<span style=color:#069;font-weight:700>await</span>.unwrap();<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#069;font-weight:700>let</span><span style=color:#bbb> </span>publisher<span style=color:#bbb> </span><span style=color:#555>=</span><span style=color:#bbb> </span>session.declare_publisher(<span style=color:#a00;background-color:#faa>“</span>test<span style=color:#555>/</span>foo<span style=color:#a00;background-color:#faa>”</span>).<span style=color:#069;font-weight:700>await</span>.unwrap();<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#09f;font-style:italic>// Publish a message every second
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span><span style=color:#bbb>    </span><span style=color:#069;font-weight:700>for</span><span style=color:#bbb> </span>idx<span style=color:#bbb> </span><span style=color:#069;font-weight:700>in</span><span style=color:#bbb> </span><span style=color:#f60>0</span><span style=color:#555>..</span><span style=color:#f60>10</span><span style=color:#bbb> </span>{<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>tokio::time::sleep(Duration::from_secs(<span style=color:#f60>1</span>)).<span style=color:#069;font-weight:700>await</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#069;font-weight:700>let</span><span style=color:#bbb> </span>buf<span style=color:#bbb> </span><span style=color:#555>=</span><span style=color:#bbb> </span>format!(<span style=color:#c30>&#34;[{idx:4}] Pub from Rust!&#34;</span>);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>println!(<span style=color:#c30>&#34;{}&#34;</span>,<span style=color:#bbb> </span>buf);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>publisher<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>            </span>.put(buf)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>            </span>.<span style=color:#069;font-weight:700>await</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>            </span>.unwrap();<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>}<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>}<span style=color:#bbb>
</span></span></span></code></pre></div><p>Subscriber example with FifoChannel (default):</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#099>#[tokio::main]</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#069;font-weight:700>async</span><span style=color:#bbb> </span><span style=color:#069;font-weight:700>fn</span> <span style=color:#c0f>main</span>()<span style=color:#bbb> </span>{<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#069;font-weight:700>let</span><span style=color:#bbb> </span>session<span style=color:#bbb> </span><span style=color:#555>=</span><span style=color:#bbb> </span>zenoh::open(Config::default()).<span style=color:#069;font-weight:700>await</span>.unwrap();<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#069;font-weight:700>let</span><span style=color:#bbb> </span>subscriber<span style=color:#bbb> </span><span style=color:#555>=</span><span style=color:#bbb> </span>session.declare_subscriber(<span style=color:#a00;background-color:#faa>“</span>test<span style=color:#555>/</span>foo<span style=color:#a00;background-color:#faa>”</span>).<span style=color:#069;font-weight:700>await</span>.unwrap();<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#069;font-weight:700>while</span><span style=color:#bbb> </span><span style=color:#069;font-weight:700>let</span><span style=color:#bbb> </span><span style=color:#366>Ok</span>(sample)<span style=color:#bbb> </span><span style=color:#555>=</span><span style=color:#bbb> </span>subscriber.recv_async().<span style=color:#069;font-weight:700>await</span><span style=color:#bbb> </span>{<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#069;font-weight:700>let</span><span style=color:#bbb> </span>payload<span style=color:#bbb> </span><span style=color:#555>=</span><span style=color:#bbb> </span>sample<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>            </span>.payload()<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>            </span>.try_to_string()<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>            </span>.unwrap_or_else(<span style=color:#555>|</span>e<span style=color:#555>|</span><span style=color:#bbb> </span>format!(<span style=color:#c30>&#34;{}&#34;</span>,<span style=color:#bbb> </span>e));<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>println!(<span style=color:#a00;background-color:#faa>“</span>{}<span style=color:#a00;background-color:#faa>”</span>,<span style=color:#bbb> </span>payload);<span style=color:#bbb> </span><span style=color:#09f;font-style:italic>// No long computation
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span><span style=color:#bbb>    </span>}<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>}<span style=color:#bbb>
</span></span></span></code></pre></div><p>Subscriber example with RingChannel:</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#099>#[tokio::main]</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#069;font-weight:700>async</span><span style=color:#bbb> </span><span style=color:#069;font-weight:700>fn</span> <span style=color:#c0f>main</span>()<span style=color:#bbb> </span>{<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#069;font-weight:700>let</span><span style=color:#bbb> </span>session<span style=color:#bbb> </span><span style=color:#555>=</span><span style=color:#bbb> </span>zenoh::open(Config::default()).<span style=color:#069;font-weight:700>await</span>.unwrap();<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#069;font-weight:700>let</span><span style=color:#bbb> </span>subscriber<span style=color:#bbb> </span><span style=color:#555>=</span><span style=color:#bbb> </span>session<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>             </span>.declare_subscriber(<span style=color:#a00;background-color:#faa>“</span>test<span style=color:#555>/</span>foo<span style=color:#a00;background-color:#faa>”</span>)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>             </span>.with(RingChannel::new(<span style=color:#f60>5</span>))<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>             </span>.<span style=color:#069;font-weight:700>await</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>             </span>.unwrap();<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#069;font-weight:700>while</span><span style=color:#bbb> </span><span style=color:#069;font-weight:700>let</span><span style=color:#bbb> </span><span style=color:#366>Ok</span>(sample)<span style=color:#bbb> </span><span style=color:#555>=</span><span style=color:#bbb> </span>subscriber.recv_async().<span style=color:#069;font-weight:700>await</span><span style=color:#bbb> </span>{<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#069;font-weight:700>let</span><span style=color:#bbb> </span>payload<span style=color:#bbb> </span><span style=color:#555>=</span><span style=color:#bbb> </span>sample<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>            </span>.payload()<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>            </span>.try_to_string()<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>            </span>.unwrap_or_else(<span style=color:#555>|</span>e<span style=color:#555>|</span><span style=color:#bbb> </span>format!(<span style=color:#c30>&#34;{}&#34;</span>,<span style=color:#bbb> </span>e));<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>println!(<span style=color:#a00;background-color:#faa>“</span>{}<span style=color:#bbb> </span>Sleeping<span style=color:#bbb> </span><span style=color:#069;font-weight:700>for</span><span style=color:#bbb> </span><span style=color:#f60>5</span>s.<span style=color:#a00;background-color:#faa>”</span>,<span style=color:#bbb> </span>payload);<span style=color:#bbb> 
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>tokio::time::sleep(Duration::from_secs(<span style=color:#f60>5</span>)).<span style=color:#069;font-weight:700>await</span>;<span style=color:#bbb> </span><span style=color:#09f;font-style:italic>// Long computation
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span><span style=color:#bbb>    </span>}<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>}<span style=color:#bbb>
</span></span></span></code></pre></div><p>You can take a look at examples of usage in any language’s <em>examples/z_pull.x</em>.
The output of the publisher will look like this with a publication made every second.</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ ./z_pub
</span></span><span style=display:flex><span><span style=color:#555>[</span>   0<span style=color:#555>]</span> Pub from Rust!
</span></span><span style=display:flex><span><span style=color:#555>[</span>   1<span style=color:#555>]</span> Pub from Rust!
</span></span><span style=display:flex><span><span style=color:#555>[</span>   2<span style=color:#555>]</span> Pub from Rust!
</span></span><span style=display:flex><span><span style=color:#555>[</span>   3<span style=color:#555>]</span> Pub from Rust!
</span></span><span style=display:flex><span><span style=color:#555>[</span>   4<span style=color:#555>]</span> Pub from Rust!
</span></span><span style=display:flex><span><span style=color:#555>[</span>   5<span style=color:#555>]</span> Pub from Rust!
</span></span><span style=display:flex><span><span style=color:#555>[</span>   6<span style=color:#555>]</span> Pub from Rust!
</span></span><span style=display:flex><span><span style=color:#555>[</span>   7<span style=color:#555>]</span> Pub from Rust!
</span></span><span style=display:flex><span><span style=color:#555>[</span>   8<span style=color:#555>]</span> Pub from Rust!
</span></span><span style=display:flex><span><span style=color:#555>[</span>   9<span style=color:#555>]</span> Pub from Rust!
</span></span><span style=display:flex><span><span style=color:#555>[</span>  10<span style=color:#555>]</span> Pub from Rust!
</span></span></code></pre></div><p>Since <em>z_sub</em> uses a <code>FifoChannel</code> then it will receive all samples. Please note that in the case of having a slow subscriber, back pressure could reach back the publisher.</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ ./z_sub
</span></span><span style=display:flex><span><span style=color:#555>[</span>   0<span style=color:#555>]</span> Pub from Rust!
</span></span><span style=display:flex><span><span style=color:#555>[</span>   1<span style=color:#555>]</span> Pub from Rust!
</span></span><span style=display:flex><span><span style=color:#555>[</span>   2<span style=color:#555>]</span> Pub from Rust!
</span></span><span style=display:flex><span><span style=color:#555>[</span>   3<span style=color:#555>]</span> Pub from Rust!
</span></span><span style=display:flex><span><span style=color:#555>[</span>   4<span style=color:#555>]</span> Pub from Rust!
</span></span><span style=display:flex><span><span style=color:#555>[</span>   5<span style=color:#555>]</span> Pub from Rust!
</span></span><span style=display:flex><span><span style=color:#555>[</span>   6<span style=color:#555>]</span> Pub from Rust!
</span></span><span style=display:flex><span><span style=color:#555>[</span>   7<span style=color:#555>]</span> Pub from Rust!
</span></span><span style=display:flex><span><span style=color:#555>[</span>   8<span style=color:#555>]</span> Pub from Rust!
</span></span><span style=display:flex><span><span style=color:#555>[</span>   9<span style=color:#555>]</span> Pub from Rust!
</span></span><span style=display:flex><span><span style=color:#555>[</span>  10<span style=color:#555>]</span> Pub from Rust!
</span></span></code></pre></div><p>If you want the subscriber to receive and process the most recent samples, use the <code>RingChannel</code>. In this case, the subscriber will take 5 seconds to process a sample, not being able to keep up with the publication rate. Using the <code>RingChannel</code> will then allow you to drop old samples and get a more recent one.
E.g. if you want to always process the most recent sample, you can set the size of the <code>RingChannel</code> to 1.</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ ./z_pull
</span></span><span style=display:flex><span><span style=color:#555>[</span>   0<span style=color:#555>]</span> Pub from Rust! Sleeping <span style=color:#069;font-weight:700>for</span> 5s.
</span></span><span style=display:flex><span><span style=color:#555>[</span>   2<span style=color:#555>]</span> Pub from Rust! Sleeping <span style=color:#069;font-weight:700>for</span> 5s. <span style=color:#09f;font-style:italic># Missed sample 1</span>
</span></span><span style=display:flex><span><span style=color:#555>[</span>   7<span style=color:#555>]</span> Pub from Rust! Sleeping <span style=color:#069;font-weight:700>for</span> 5s. <span style=color:#09f;font-style:italic># Missed sample 3, 4, 5, 6</span>
</span></span><span style=display:flex><span><span style=color:#555>[</span>  12<span style=color:#555>]</span> Pub from Rust! Sleeping <span style=color:#069;font-weight:700>for</span> 5s. <span style=color:#09f;font-style:italic># Missed sample 8, 9, 10, 11</span>
</span></span></code></pre></div><hr><h2 id=c-api>C API</h2><p>Zenoh 1.0.0 underwent a major rework of the C API with the goal of better clarifying data ownership via a well-defined naming semantics of types.</p><h4 id=owned-types>Owned types</h4><p>Owned types are types that are allocated by the user and it is their responsibility to drop them using <code>z_drop</code> (or <code>z_close</code> for sessions).</p><p>Previously, we were returning Zenoh structures by value.
In Zenoh 1.0.0, a reference to memory must be provided. This allows initializing user allocated structures and frees return value for error codes.</p><h4 id=moved-types>Moved types</h4><p>Moved types are obtained when using <code>z_move</code> on an owned type object. They are consumed on use when passed to relevant functions. Any non-constructor function accepting a moved object (i.e. an object passed by owned pointer) becomes responsible for calling drop on it. The object is guaranteed to be in the null state upon such function return, even if it fails.</p><h4 id=loaned-types>Loaned types</h4><p>Each owned type now has a corresponding <code>z_loaned_xxx_t</code> type, which is obtained by calling <code>z_loan</code> or <code>z_loan_mut</code> on it, or eventually received from Zenoh functions / callbacks. It is no longer possible to directly access the fields of an owned object, the accessor functions on the loaned objects should instead be used.</p><h4 id=view-types>View types</h4><p>View types are only wrappers to user allocated data, like <code>z_view_keyexpr_t.</code> These types can be loaned in the same way as owned types but they don’t need to be dropped explicitly (user is fully responsible for deallocation of wrapped data).</p><p>Here is a quick example of all the above changes:</p><p>Zenoh 0.11.0:</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#078;font-weight:700>int</span> <span style=color:#c0f>main</span>(<span style=color:#078;font-weight:700>int</span> argc, <span style=color:#078;font-weight:700>char</span><span style=color:#555>**</span> argv) {
</span></span><span style=display:flex><span>    z_owned_config_t config <span style=color:#555>=</span> z_config_default();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    z_owned_session_t s <span style=color:#555>=</span> z_open(z_move(config));
</span></span><span style=display:flex><span>    <span style=color:#069;font-weight:700>if</span> (<span style=color:#555>!</span>z_check(s)) {
</span></span><span style=display:flex><span>        exit(<span style=color:#555>-</span><span style=color:#f60>1</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    z_put_options_t options <span style=color:#555>=</span> z_put_options_default();
</span></span><span style=display:flex><span>    options.encoding <span style=color:#555>=</span> z_encoding(Z_ENCODING_PREFIX_TEXT_PLAIN, <span style=color:#366>NULL</span>);
</span></span><span style=display:flex><span>    <span style=color:#069;font-weight:700>const</span> <span style=color:#078;font-weight:700>char</span> <span style=color:#555>*</span>payload <span style=color:#555>=</span> <span style=color:#c30>&#34;My payload&#34;</span>;
</span></span><span style=display:flex><span>    <span style=color:#078;font-weight:700>int</span> res <span style=color:#555>=</span> z_put(z_loan(s), z_keyexpr(args.keyexpr), (<span style=color:#069;font-weight:700>const</span> <span style=color:#078;font-weight:700>uint8_t</span><span style=color:#555>*</span>)payload, strlen(payload), <span style=color:#555>&amp;</span>options);
</span></span><span style=display:flex><span>    <span style=color:#069;font-weight:700>if</span> (res <span style=color:#555>&lt;</span> <span style=color:#f60>0</span>) {
</span></span><span style=display:flex><span>        printf(<span style=color:#c30>&#34;Put failed...</span><span style=color:#c30;font-weight:700>\n</span><span style=color:#c30>&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    z_close(z_move(s));
</span></span><span style=display:flex><span>    z_drop(z_move(attachment));
</span></span><span style=display:flex><span>    <span style=color:#069;font-weight:700>return</span> <span style=color:#f60>0</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Zenoh 1.0.0:</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#078;font-weight:700>int</span> <span style=color:#c0f>main</span>(<span style=color:#078;font-weight:700>int</span> argc, <span style=color:#078;font-weight:700>char</span><span style=color:#555>**</span> argv) {
</span></span><span style=display:flex><span>    z_owned_config_t config;
</span></span><span style=display:flex><span>    z_config_default(<span style=color:#555>&amp;</span>config);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    z_owned_session_t s;
</span></span><span style=display:flex><span>    <span style=color:#069;font-weight:700>if</span> (z_open(<span style=color:#555>&amp;</span>s, z_move(config)) <span style=color:#555>&lt;</span> <span style=color:#f60>0</span>) {
</span></span><span style=display:flex><span>        exit(<span style=color:#555>-</span><span style=color:#f60>1</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    z_view_keyexpr_t ke;
</span></span><span style=display:flex><span>    z_view_keyexpr_from_str(<span style=color:#555>&amp;</span>ke, args.keyexpr);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    z_owned_bytes_t payload;
</span></span><span style=display:flex><span>    z_bytes_from_static_str(<span style=color:#555>&amp;</span>payload, <span style=color:#c30>&#34;My payload&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    z_put_options_t options;
</span></span><span style=display:flex><span>    z_put_options_default(<span style=color:#555>&amp;</span>options);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#078;font-weight:700>int</span> res <span style=color:#555>=</span> z_put(z_loan(s), z_loan(ke), z_move(payload), <span style=color:#555>&amp;</span>options);
</span></span><span style=display:flex><span>    <span style=color:#069;font-weight:700>if</span> (res <span style=color:#555>&lt;</span> <span style=color:#f60>0</span>) {
</span></span><span style=display:flex><span>        printf(<span style=color:#c30>&#34;Put failed...</span><span style=color:#c30;font-weight:700>\n</span><span style=color:#c30>&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    z_close(z_move(s));
</span></span><span style=display:flex><span>    <span style=color:#069;font-weight:700>return</span> <span style=color:#f60>0</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>For more information on the C API, please see the <a href=https://zenoh.io/docs/migration_1.0/c_pico/>migration guide</a>.</p><hr><h2 id=c-api-1>C++ API</h2><p>Zenoh 1.0.0 brings a number of changes to the API, with a concentrated effort to make the C++ API usage close to the Rust API.</p><p>The improvements include:</p><ul><li>A simpler organization of the Zenoh classes, removing the notion of <em>View</em> and <em>Closure</em>;</li><li>Improved and more flexible Error Handling through error codes and exceptions;</li><li>Improved stream handlers and callback support;</li><li>Simpler attachment API.</li></ul><h4 id=error-handling>Error Handling</h4><p>In Zenoh 0.11.0, all Zenoh call failures were handled by either returning a bool value indicating success or failure (and probably returning an error code) or returning an <code>std::variant&lt;ReturnType, ErrorMessage></code>. For instance:</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span>std<span style=color:#555>::</span>variant<span style=color:#555>&lt;</span>z<span style=color:#555>::</span>Config, ErrorMessage<span style=color:#555>&gt;</span> config_client(<span style=color:#069;font-weight:700>const</span> z<span style=color:#555>::</span>StrArrayView<span style=color:#555>&amp;</span> peers);
</span></span><span style=display:flex><span><span style=color:#078;font-weight:700>bool</span> <span style=color:#c0f>put</span>(<span style=color:#069;font-weight:700>const</span> z<span style=color:#555>::</span>BytesView<span style=color:#555>&amp;</span> payload, <span style=color:#069;font-weight:700>const</span> z<span style=color:#555>::</span>PublisherPutOptions<span style=color:#555>&amp;</span> options, ErrNo<span style=color:#555>&amp;</span> error);
</span></span></code></pre></div><p>In Zenoh 1.0.0, all functions that can fail on the Zenoh side now offer 2 options for error handling:</p><ul><li>Exceptions</li><li>Error Codes</li></ul><p>Any function that can fail now accepts an optional parameter ZError* err pointer to the error code. If it is not provided (or set to nullptr), an instance of ZException will be thrown, otherwise the error code will be written into the err pointer.</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#069;font-weight:700>static</span> Config <span style=color:#c0f>client</span>(<span style=color:#069;font-weight:700>const</span> std<span style=color:#555>::</span>vector<span style=color:#555>&lt;</span>std<span style=color:#555>::</span>string<span style=color:#555>&gt;&amp;</span> peers, ZError<span style=color:#555>*</span> err <span style=color:#555>=</span> <span style=color:#069;font-weight:700>nullptr</span>);
</span></span></code></pre></div><p>This also applies to constructors: if a failure occurs, either an exception is thrown or the error code is written to the provided pointer.
In the latter case, the returned object will be in an <em>empty</em> state (i.e. converting it to a boolean returns false).</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span>Config config <span style=color:#555>=</span> Config<span style=color:#555>::</span>create_default();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>// Receiving an error code
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span>Zerror err <span style=color:#555>=</span> Z_OK;
</span></span><span style=display:flex><span><span style=color:#069;font-weight:700>auto</span> session <span style=color:#555>=</span> Session<span style=color:#555>::</span>open(std<span style=color:#555>::</span>move(config), <span style=color:#555>&amp;</span>err);
</span></span><span style=display:flex><span><span style=color:#069;font-weight:700>if</span> (err <span style=color:#555>!=</span> Z_OK) { <span style=color:#09f;font-style:italic>// or alternatively if (!session)
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span>  <span style=color:#09f;font-style:italic>// handle failure
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>// Catching exception
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span>Zenoh<span style=color:#555>::</span>session s(<span style=color:#069;font-weight:700>nullptr</span>); <span style=color:#09f;font-style:italic>// Empty session object
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span><span style=color:#069;font-weight:700>try</span> {
</span></span><span style=display:flex><span>  s <span style=color:#555>=</span> Session<span style=color:#555>::</span>open(std<span style=color:#555>::</span>move(config), <span style=color:#555>&amp;</span>err);
</span></span><span style=display:flex><span>} <span style=color:#069;font-weight:700>catch</span> (<span style=color:#069;font-weight:700>const</span> ZException<span style=color:#555>&amp;</span> e) {
</span></span><span style=display:flex><span>  <span style=color:#09f;font-style:italic>// handle failure
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span>}
</span></span></code></pre></div><p>All returned and <code>std::move</code>&rsquo;d-in objects are guaranteed to be left in an <em>empty</em> state in case of function call failure.</p><h4 id=stream-handlers-and-callbacks>Stream Handlers and Callbacks</h4><p>In Zenoh 1.0.0, Subscriber, Queryable and get can now use either a callable object or a stream handler.
Currently, Zenoh provides 2 types of handlers:</p><ul><li>FifoHandler - serving messages in Fifo order, <em>blocking</em> on new messages once full.</li><li>RingHandler - serving messages in Fifo order, dropping older messages once full to make room for new ones.</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#09f;font-style:italic>// callback
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span>session.get(
</span></span><span style=display:flex><span>  keyexpr, <span style=color:#c30>&#34;&#34;</span>, on_reply, on_done,
</span></span><span style=display:flex><span>  {.target <span style=color:#555>=</span> Z_QUERY_TARGET_ALL}
</span></span><span style=display:flex><span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>// stream handlers interface
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span><span style=color:#069;font-weight:700>auto</span> replies <span style=color:#555>=</span> session.get(
</span></span><span style=display:flex><span>  keyexpr, <span style=color:#c30>&#34;&#34;</span>, channels<span style=color:#555>::</span>FifoChannel(<span style=color:#f60>16</span>), <span style=color:#09f;font-style:italic>// Or channels::RingChannel(16),
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span>  {.target <span style=color:#555>=</span> QueryTarget<span style=color:#555>::</span>Z_QUERY_TARGET_ALL}
</span></span><span style=display:flex><span>);
</span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>// blocking
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span><span style=color:#069;font-weight:700>for</span> (<span style=color:#069;font-weight:700>auto</span> res <span style=color:#555>=</span> replies.recv(); std<span style=color:#555>::</span>has_alternative<span style=color:#555>&lt;</span>Reply<span style=color:#555>&gt;</span>(res); res <span style=color:#555>=</span> replies.recv()) {
</span></span><span style=display:flex><span>  <span style=color:#069;font-weight:700>const</span> <span style=color:#069;font-weight:700>auto</span><span style=color:#555>&amp;</span> sample <span style=color:#555>=</span> std<span style=color:#555>::</span>get<span style=color:#555>&lt;</span>Reply<span style=color:#555>&gt;</span>(res).get_ok();
</span></span><span style=display:flex><span>  std<span style=color:#555>::</span>cout <span style=color:#555>&lt;&lt;</span> <span style=color:#c30>&#34;Received (&#39;&#34;</span> <span style=color:#555>&lt;&lt;</span> sample.get_keyexpr().as_string_view() <span style=color:#555>&lt;&lt;</span> <span style=color:#c30>&#34;&#39; : &#39;&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#555>&lt;&lt;</span> sample.get_payload().as_string() <span style=color:#555>&lt;&lt;</span> <span style=color:#c30>&#34;&#39;)</span><span style=color:#c30;font-weight:700>\n</span><span style=color:#c30>&#34;</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>For more information on the C++ API, please see the <a href=https://zenoh.io/docs/migration_1.0/c++/>migration guide</a>.</p><hr><h2 id=python-api>Python API</h2><p>In Zenoh 1.0.0, Python API introduces context managers for the Zenoh session and the various entities like subscriber, queryable and publisher.
Using the context manager ensures the proper cleanup is called.</p><p>For example, to close the Zenoh session after use with context manager:</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#069;font-weight:700>import</span> <span style=color:#0cf;font-weight:700>Zenoh</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#069;font-weight:700>with</span> zenoh<span style=color:#555>.</span>open(zenoh<span style=color:#555>.</span>Config()) <span style=color:#069;font-weight:700>as</span> session:
</span></span><span style=display:flex><span>    <span style=color:#09f;font-style:italic># `session.close()` will be called at the end of the block</span>
</span></span></code></pre></div><p>Session-managed objects like subscribers or queryables can also be managed using context managers:</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#069;font-weight:700>with</span> session<span style=color:#555>.</span>declare_subscriber(<span style=color:#c30>&#34;my/keyexpr&#34;</span>) <span style=color:#069;font-weight:700>as</span> subscriber:
</span></span><span style=display:flex><span>    <span style=color:#09f;font-style:italic># `subscriber.undeclare()` will be called at the end of the block`</span>
</span></span></code></pre></div><p>However, these objects can also be used without a context manager, and without calling undeclare. In that case, they will run in “background” mode, meaning that their lifetime will end when the session closes.</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#069;font-weight:700>import</span> <span style=color:#0cf;font-weight:700>Zenoh</span>
</span></span><span style=display:flex><span><span style=color:#069;font-weight:700>with</span> zenoh<span style=color:#555>.</span>open(zenoh<span style=color:#555>.</span>Config()) <span style=color:#069;font-weight:700>as</span> session:
</span></span><span style=display:flex><span>    subscriber <span style=color:#555>=</span> session<span style=color:#555>.</span>declare_subscriber(<span style=color:#c30>&#34;my/keyepxr&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#069;font-weight:700>for</span> sample <span style=color:#000;font-weight:700>in</span> subscriber:
</span></span><span style=display:flex><span>        <span style=color:#555>...</span>
</span></span><span style=display:flex><span>    <span style=color:#09f;font-style:italic># `session.close()` will be called at the end of the block, and it will undeclare the subscriber</span>
</span></span></code></pre></div><p>In Zenoh 0.11.0, it was necessary to keep a variable in the scope for declared <em>subscribers/queryables/etc</em>.
This restriction no longer exists, as objects not bound to a variable will still run in <em>background</em> mode, until the session is closed.</p><p>Please refer to the <a href=https://zenoh.io/docs/migration_1.0/python/>migration guide</a> for the complete list of changes on the Python API.</p><hr><h2 id=kotlin-api>Kotlin API</h2><p>Finally, after many ‘alpha’ releases, the time has come to provide a first stable release on the Kotlin API, bringing the possibility of using Zenoh on JVM and Android targets!
The Kotlin API comes with an extensive rework on the API, along with bug fixes, and new implementations.
The changes come with the following goals in mind:</p><ul><li>meeting the new requirements of the Zenoh API rework done across all the Zenoh ecosystem;</li><li>providing an API that fits better with the Kotlin style;</li><li>enhance the API</li></ul><p>New features and improvements:</p><ul><li>Scouting: the API now provides scouting support to discover other sessions on the network</li><li>Session context: the session keeps track of the declarations internally, avoiding them to be dropped when losing a reference to them</li><li>KeyExpr rework: key expressions can be safely dropped</li><li>Config rework and support for string configs with format Json, Json5 and Yaml.</li><li>Replacement of all builder patterns with default arguments.</li><li>Reply rework</li><li>API alignment</li></ul><p>For more information on the Kotlin API, please see the <a href=https://zenoh.io/docs/migration_1.0/kotlin/>migration guide</a>.</p><hr><h2 id=java-api>Java API</h2><p>The Java API is still a work in progress, and future extensive rework on the API is to be expected. The beta releases of the Java API are fully compatible with Zenoh 1.0.0. Feel free to use it, but keep in mind that changes are coming to fully align the API with all the other bindings.
When that will happen, we will provide a corresponding migration guide.</p><hr><h2 id=typescript-api>TypeScript API</h2><p>The TypeScript API is in its alpha stage with the focus being put towards browser support, as majority of the requests from users have been to use Zenoh for UI and visualisation applications, and due to the numerous languages already supported for backend development.
The Typescript API comes with the requirement of using a remote API plugin attached to a Zenoh router running on the backend.
The remote API plugin works by starting a native Zenoh session inside the plugin and communicating over websockets with the browser instance, passing control and data messages between the browser instance and the plugin backend. All state exists inside the plugin and the Typescript API just keeps references to the state stored in the plugin.
It is advised for users to account for the general performance characteristics of a JavaScript runtime environment when designing their applications.</p><p>Below is an example of a <em>subscriber</em> taking a callback:</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#069;font-weight:700>const</span> session <span style=color:#555>=</span> <span style=color:#069;font-weight:700>await</span> Session.open(Config.<span style=color:#069;font-weight:700>new</span>(<span style=color:#c30>&#34;ws/127.0.0.1:10000&#34;</span>));
</span></span><span style=display:flex><span>  <span style=color:#069;font-weight:700>const</span> callback <span style=color:#555>=</span> <span style=color:#069;font-weight:700>async</span> <span style=color:#069;font-weight:700>function</span> (sample: <span style=color:#078;font-weight:700>Sample</span>)<span style=color:#555>:</span> Promise&lt;<span style=color:#309;font-weight:700>void</span>&gt; {
</span></span><span style=display:flex><span>    console.log<span style=color:#555>!</span>(
</span></span><span style=display:flex><span>      <span style=color:#c30>&#34;&gt;&gt; [Subscriber] Received &#34;</span> <span style=color:#555>+</span>
</span></span><span style=display:flex><span>      sample.kind() <span style=color:#555>+</span> <span style=color:#c30>&#34; (&#39;&#34;</span> <span style=color:#555>+</span>
</span></span><span style=display:flex><span>      sample.keyexpr() <span style=color:#555>+</span> <span style=color:#c30>&#34;&#39;: &#39;&#34;</span> <span style=color:#555>+</span>
</span></span><span style=display:flex><span>      sample.payload().deserialize(deserialize_string) <span style=color:#555>+</span> <span style=color:#c30>&#34;&#39;)&#34;</span>,
</span></span><span style=display:flex><span>    );
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#069;font-weight:700>let</span> callback_subscriber: <span style=color:#078;font-weight:700>Subscriber</span> <span style=color:#555>=</span> <span style=color:#069;font-weight:700>await</span> session.declare_subscriber(
</span></span><span style=display:flex><span>    <span style=color:#c30>&#34;demo/pub&#34;</span>,
</span></span><span style=display:flex><span>    callback,
</span></span><span style=display:flex><span>  );
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#069;font-weight:700>await</span> sleep(<span style=color:#f60>1000</span> <span style=color:#555>*</span> <span style=color:#f60>3</span>);
</span></span><span style=display:flex><span>  callback_subscriber.undeclare();
</span></span></code></pre></div><p>Below is an example of a <em>publisher</em>:</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span>  <span style=color:#069;font-weight:700>const</span> session <span style=color:#555>=</span> <span style=color:#069;font-weight:700>await</span> Session.open(Config.<span style=color:#069;font-weight:700>new</span>(<span style=color:#c30>&#34;ws/127.0.0.1:10000&#34;</span>));
</span></span><span style=display:flex><span>  <span style=color:#069;font-weight:700>let</span> key_expr <span style=color:#555>=</span> KeyExpr.<span style=color:#069;font-weight:700>new</span>(<span style=color:#c30>&#34;demo/example/zenoh-ts-pub&#34;</span>);
</span></span><span style=display:flex><span>  <span style=color:#069;font-weight:700>let</span> publisher: <span style=color:#078;font-weight:700>Publisher</span> <span style=color:#555>=</span> session.declare_publisher(
</span></span><span style=display:flex><span>	key_expr,
</span></span><span style=display:flex><span>	Encoding.<span style=color:#069;font-weight:700>default</span>(),
</span></span><span style=display:flex><span>	CongestionControl.BLOCK,
</span></span><span style=display:flex><span>	Priority.DATA,
</span></span><span style=display:flex><span>	<span style=color:#069;font-weight:700>true</span>,
</span></span><span style=display:flex><span>	Reliability.RELIABLE
</span></span><span style=display:flex><span>  );
</span></span><span style=display:flex><span>  <span style=color:#069;font-weight:700>const</span> payload <span style=color:#555>=</span> [<span style=color:#f60>122</span>, <span style=color:#f60>101</span>, <span style=color:#f60>110</span>, <span style=color:#f60>111</span>, <span style=color:#f60>104</span>];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#069;font-weight:700>for</span> (<span style=color:#069;font-weight:700>let</span> idx <span style=color:#555>=</span> <span style=color:#f60>0</span>; idx <span style=color:#555>&lt;</span> <span style=color:#366>Number</span>.MAX_VALUE; idx<span style=color:#555>++</span>) {
</span></span><span style=display:flex><span>	<span style=color:#069;font-weight:700>let</span> buf <span style=color:#555>=</span> <span style=color:#c30>`[</span><span style=color:#a00>${</span>idx<span style=color:#a00>}</span><span style=color:#c30>] </span><span style=color:#a00>${</span>payload<span style=color:#a00>}</span><span style=color:#c30>`</span>;
</span></span><span style=display:flex><span>	console.log(<span style=color:#c30>&#34;Block statement execution no : &#34;</span> <span style=color:#555>+</span> idx);
</span></span><span style=display:flex><span>	console.log(<span style=color:#c30>`Putting Data (&#39;</span><span style=color:#a00>${</span>key_expr<span style=color:#a00>}</span><span style=color:#c30>&#39;: &#39;</span><span style=color:#a00>${</span>buf<span style=color:#a00>}</span><span style=color:#c30>&#39;)...`</span>);
</span></span><span style=display:flex><span>	publisher.put(buf, Encoding.TEXT_PLAIN, <span style=color:#c30>&#34;attachment&#34;</span>);
</span></span><span style=display:flex><span>	<span style=color:#069;font-weight:700>await</span> sleep(<span style=color:#f60>1000</span>);
</span></span><span style=display:flex><span>  }
</span></span></code></pre></div><hr><h2 id=shared-memory>Shared Memory</h2><p>Zenoh 1.0.0 adds comprehensive shared memory support with a rich yet unstable API to perform specific SHM actions.
The SHM subsystem is heavily reworked both on the API and implementation side.
Shared memory API is currently available in Rust, C and C++ API.</p><p>Some key featuers that have been introduced are:</p><ul><li>Decentralised architecture: this provides process isolation to meet safety requirements.</li><li>No topological constraints: now SHM can be used in any topology (included multi-hop routing networks) as long as data reside in the same shared memory domain;</li><li>SHM routing with seamless SHM to non-SHM conversion: in case data need to leave the SHM domain, Zenoh will automatically convert it to non-SHM;</li><li>Improved robustness: every SHM buffer is now reference-counted and tracked in the whole SHM domain. This allows to automatically reclaim SHM buffers in case of a process crash or unresponsive application. It also allow to safely gain write access to SHM buffers while avoiding concurrent writes, facilitating building SHM-based processing pipelines.</li><li>Forced SHM buffer deallocation feature; SHM buffer can be explicitly deallocated while in-use.</li><li>User-defined SHM backends: custom allocation strategies using specific shared memory system API can be now be implemented by the user as shown below.</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#09f;font-style:italic>// create an SHM backend…
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span><span style=color:#069;font-weight:700>let</span><span style=color:#bbb> </span>backend<span style=color:#bbb> </span><span style=color:#555>=</span><span style=color:#bbb> </span>PosixShmProviderBackend::builder()<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>.with_size(<span style=color:#f60>65536</span>)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>.unwrap()<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>.wait()<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>.unwrap();<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#09f;font-style:italic>// ...and an SHM provider
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span><span style=color:#069;font-weight:700>let</span><span style=color:#bbb> </span>provider<span style=color:#bbb> </span><span style=color:#555>=</span><span style=color:#bbb> </span>ShmProviderBuilder::builder()<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>.protocol_id::<span style=color:#555>&lt;</span>POSIX_PROTOCOL_ID<span style=color:#555>&gt;</span>()<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>.backend(backend)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>     </span>.wait();<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#09f;font-style:italic>// There are two API-defined ways of making shm buffer allocations: direct and through the layout...
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#09f;font-style:italic>// Direct allocation
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>// The direct allocation calculates all layouting checks on each allocation. It is good for
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>// uniquely-layouted allocations. For making series of similar allocations, please refer to
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>// layout allocation API which is shown later in this example...
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span><span style=color:#069;font-weight:700>let</span><span style=color:#bbb> </span>_direct_allocation<span style=color:#bbb> </span><span style=color:#555>=</span><span style=color:#bbb> </span>{<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#09f;font-style:italic>// OPTION: Simple allocation
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span><span style=color:#bbb>    </span><span style=color:#069;font-weight:700>let</span><span style=color:#bbb> </span>simple<span style=color:#bbb> </span><span style=color:#555>=</span><span style=color:#bbb> </span>provider.alloc(<span style=color:#f60>512</span>).wait().unwrap();<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#09f;font-style:italic>// OPTION: Allocation with custom alignment and alloc policy customization
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span><span style=color:#bbb>    </span><span style=color:#069;font-weight:700>let</span><span style=color:#bbb> </span>_comprehensive<span style=color:#bbb> </span><span style=color:#555>=</span><span style=color:#bbb> </span>provider<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>.alloc(<span style=color:#f60>512</span>)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>.with_alignment(AllocAlignment::new(<span style=color:#f60>2</span>).unwrap())<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>.with_policy::<span style=color:#555>&lt;</span>GarbageCollect<span style=color:#555>&gt;</span>()<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>.wait()<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>.unwrap();<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#09f;font-style:italic>// OPTION: Allocation with custom alignment and async alloc policy
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span><span style=color:#bbb>    </span><span style=color:#069;font-weight:700>let</span><span style=color:#bbb> </span>_async<span style=color:#bbb> </span><span style=color:#555>=</span><span style=color:#bbb> </span>provider<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>.alloc(<span style=color:#f60>512</span>)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>.with_alignment(AllocAlignment::new(<span style=color:#f60>2</span>).unwrap())<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>.with_policy::<span style=color:#555>&lt;</span>BlockOn<span style=color:#555>&lt;</span>Defragment<span style=color:#555>&lt;</span>GarbageCollect<span style=color:#555>&gt;&gt;&gt;</span>()<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>.<span style=color:#069;font-weight:700>await</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>.unwrap();<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>simple<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>};<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#09f;font-style:italic>// Create a layout for particular allocation arguments and particular SHM provider
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>// The layout is validated for argument correctness and also is checked
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>// against particular SHM provider&#39;s layouting capabilities.
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>// This layout is reusable and can handle series of similar allocations
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span><span style=color:#069;font-weight:700>let</span><span style=color:#bbb> </span>buffer_layout<span style=color:#bbb> </span><span style=color:#555>=</span><span style=color:#bbb> </span>{<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#09f;font-style:italic>// OPTION: Simple configuration:
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span><span style=color:#bbb>    </span><span style=color:#069;font-weight:700>let</span><span style=color:#bbb> </span>simple_layout<span style=color:#bbb> </span><span style=color:#555>=</span><span style=color:#bbb> </span>provider.alloc(<span style=color:#f60>512</span>).into_layout().unwrap();<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#09f;font-style:italic>// OPTION: Comprehensive configuration:
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span><span style=color:#bbb>    </span><span style=color:#069;font-weight:700>let</span><span style=color:#bbb> </span>_comprehensive_layout<span style=color:#bbb> </span><span style=color:#555>=</span><span style=color:#bbb> </span>provider<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>.alloc(<span style=color:#f60>512</span>)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>.with_alignment(AllocAlignment::new(<span style=color:#f60>2</span>).unwrap())<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>.into_layout()<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>.unwrap();<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>simple_layout<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>};<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#09f;font-style:italic>// Allocate ShmBufInner
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>// Policy is a generics-based API to describe necessary allocation behaviour
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>// that will be highly optimized at compile-time.
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>// Policy resolvable can be sync and async.
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>// The basic policies are:
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>// -JustAlloc (sync)
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>// -GarbageCollect (sync)
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>// -Deallocate (sync)
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>// --contains own set of dealloc policy generics:
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>// ---DeallocateYoungest
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>// ---DeallocateEldest
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>// ---DeallocateOptimal
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>// -BlockOn (sync and async)
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span><span style=color:#069;font-weight:700>let</span><span style=color:#bbb> </span><span style=color:#069;font-weight:700>mut</span><span style=color:#bbb> </span>sbuf<span style=color:#bbb> </span><span style=color:#555>=</span><span style=color:#bbb> </span><span style=color:#069;font-weight:700>async</span><span style=color:#bbb> </span>{<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#09f;font-style:italic>// Some examples on how to use layout interface:
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#09f;font-style:italic>// OPTION: The default allocation with default JustAlloc policy
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span><span style=color:#bbb>    </span><span style=color:#069;font-weight:700>let</span><span style=color:#bbb> </span>default_alloc<span style=color:#bbb> </span><span style=color:#555>=</span><span style=color:#bbb> </span>buffer_layout.alloc().wait().unwrap();<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#09f;font-style:italic>// OPTION: The async allocation
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span><span style=color:#bbb>    </span><span style=color:#069;font-weight:700>let</span><span style=color:#bbb> </span>_async_alloc<span style=color:#bbb> </span><span style=color:#555>=</span><span style=color:#bbb> </span>buffer_layout<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>.alloc()<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>.with_policy::<span style=color:#555>&lt;</span>BlockOn<span style=color:#555>&gt;</span>()<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>.<span style=color:#069;font-weight:700>await</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>.unwrap();<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#09f;font-style:italic>// OPTION: The comprehensive allocation policy that blocks if provider is not able to allocate
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span><span style=color:#bbb>    </span><span style=color:#069;font-weight:700>let</span><span style=color:#bbb> </span>_comprehensive_alloc<span style=color:#bbb> </span><span style=color:#555>=</span><span style=color:#bbb> </span>buffer_layout<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>.alloc()<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>.with_policy::<span style=color:#555>&lt;</span>BlockOn<span style=color:#555>&lt;</span>Defragment<span style=color:#555>&lt;</span>GarbageCollect<span style=color:#555>&gt;&gt;&gt;</span>()<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>.wait()<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>.unwrap();<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#09f;font-style:italic>// OPTION: The comprehensive allocation policy that deallocates up to 1000 buffers if provider is not able to allocate
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span><span style=color:#bbb>    </span><span style=color:#069;font-weight:700>let</span><span style=color:#bbb> </span>_comprehensive_alloc<span style=color:#bbb> </span><span style=color:#555>=</span><span style=color:#bbb> </span>buffer_layout<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>.alloc()<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>.with_policy::<span style=color:#555>&lt;</span>Deallocate<span style=color:#555>&lt;</span><span style=color:#f60>1000</span>,<span style=color:#bbb> </span>Defragment<span style=color:#555>&lt;</span>GarbageCollect<span style=color:#555>&gt;&gt;&gt;</span>()<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>.wait()<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>.unwrap();<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>default_alloc<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>}<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>.<span style=color:#069;font-weight:700>await</span>;<span style=color:#bbb>
</span></span></span></code></pre></div><p>For more information, please see the <a href=https://zenoh.io/docs/migration_1.0/rust/#shared-memory>migration guide</a>.</p><hr><h2 id=plugins>Plugins</h2><p>In Zenoh 1.0.0 we finished porting the Zenoh ecosystem from async-std to Tokio. All plugins and storage backends now use Tokio.</p><p>As a reminder, Zenoh 0.11.0 added the ability for user-applications to load compiled plugins written in Rust, regardless of which language bindings you are using. See the configuration example on how to load the plugins.</p><p>When loading a plugin, it must have been built with the same version of the Rust compiler as the bindings loading it, and the <code>Cargo.lock</code> of the plugin must be synced with the same commit of Zenoh.</p><p>This means that if the language bindings are using <code>rustc</code> version <code>1.75</code>:</p><ul><li>The plugin must be built with the same toolchain version <code>1.75</code>.</li><li>The plugin must be built with the same Zenoh Commit.</li><li>The plugin <code>Cargo.lock</code> had its packages synced with the Zenoh <code>Cargo.lock</code>.</li></ul><p>The reason behind this strict set of requirements is due to Rust making no guarantees regarding data layout in memory. This means between compiler versions, the representation may change based on optimizations. More on this topic here: <a href=https://doc.rust-lang.org/reference/type-layout.html#representations>Rust:Type-Layout</a></p><hr><h2 id=interest-protocol>Interest protocol</h2><p>Zenoh 1.0.0 introduces a major change in the routing protocol that brings a great scalability improvement and a major discovery traffic consumption reduction.</p><p>Up to version 0.11.0, all subscribers, queryables and liveliness tokens declarations were propagated to all nodes of the system.
In a large system, this could be problematic for small devices. In version 1.0.0, subscribers, queryables and liveliness tokens declarations are not propagated any more to clients and peers subsystems.
This implies that writer side filtering cannot be performed any more in clients and peers subsystems.
All publications, queries and liveliness queries are sent to the nearest router.
Writer side filtering can be reactivated for publications on some key expressions by simply declaring a <em>publisher</em>.</p><hr><h2 id=access-control>Access Control</h2><p>For Zenoh 1.0.0, we are happy to share that we have added support for TLS and user/password authentication methods as means to identify access control subjects, as relying solely on interface names to identify subjects quickly reaches its limits.
This addition introduced the need for a way to describe subjects as combinations of multiple attributes of different types (interface, certificate common name, and/or username).
We have addressed this need by reworking the ACL configuration format, making it modular by isolating the <code>rules</code> from the <code>subjects</code>.
This allows the combination of subject attributes, while also avoiding the need to duplicate subject or rule configurations by adding the <code>policies</code> list.</p><p>On another note, we have shifted the focus of ACL from <code>actions</code> to <code>messages</code> to make it easier for users to associate the ACL rules to their respective operations exposed via the Zenoh API.
The <code>get</code> action has been replaced by the <code>Query</code> message, and we completed the array of supported message types in ACL with the addition of publisher <code>Delete</code> and queryable <code>Reply</code> messages.</p><p>Following this release, a guide on how to configure ACL is available on the <a href=https://zenoh.io/docs/manual/access-control/>Zenoh reference manual</a>, and the <a href=https://github.com/eclipse-zenoh/roadmap/blob/main/rfcs/ALL/Access%20Control%20Rules.md>Access Control Rules RFC</a> has been updated.</p><hr><h2 id=batching-and-jitter>Batching and jitter</h2><p>The porting of Zenoh to Tokio in 0.11.0 had as a side effect a change in the batching behaviour as reported by some users.
The issue has been thoroughly investigated resulting in a rework of the batching mechanism in Zenoh 1.0.0.
This rework accounts for Tokio peculiarities in timing management and improves the overall jitter performance when publishing at high frequency.</p><hr><h2 id=link-selection>Link selection</h2><p>Link selection refers to the process of choosing a network Link when transmitting messages.
This is done in the Zenoh Transport layer when two Zenoh nodes are operating in multilink mode (i.e. more than one Link has been established).</p><p>In Zenoh 0.11.x, the Link selection implementation picks any Link that matches the Reliability of the transmitted message.
In Zenoh 1.0.0, Links can be tagged with Reliability and Priority range information through Endpoint metadata:</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{ <span style=color:#a00;background-color:#faa>listen:</span> <span style=color:#a00;background-color:#faa>{</span> <span style=color:#a00;background-color:#faa>endpoints:</span> <span style=color:#a00;background-color:#faa>[</span><span style=color:#309;font-weight:700>&#34;tcp/localhost:7447?prio=0-3;rel=1&#34;</span><span style=color:#a00;background-color:#faa>]</span> } <span style=color:#a00;background-color:#faa>}</span>
</span></span></code></pre></div><p>Thus Link selection takes in account both Reliability and Priority of the transmitted message by picking the Link that best matches the given Reliability-Priority pair.</p><p>E.g., let&rsquo;s consider the following configuration:</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{ <span style=color:#a00;background-color:#faa>listen:</span> <span style=color:#a00;background-color:#faa>{</span> <span style=color:#a00;background-color:#faa>endpoints:</span> <span style=color:#a00;background-color:#faa>[</span><span style=color:#309;font-weight:700>&#34;tcp/localhost:7447?rel=0&#34;</span>, <span style=color:#309;font-weight:700>&#34;tcp/localhost:7448?rel=1&#34;</span><span style=color:#a00;background-color:#faa>]</span> } <span style=color:#a00;background-color:#faa>}</span>
</span></span></code></pre></div><p>Will result in listening on two different TCP ports: <em>7447</em> that will be used for <em>best effort</em> traffic and <em>7448</em> that will be used for <em>reliable traffic</em>.</p><hr><h2 id=storage-alignment-protocol>Storage Alignment Protocol</h2><p>In Zenoh 1.0.0 we have completely rewritten the <em>storage replication</em> feature to provide a more robust and configurable implementation.
Users leveraging this functionality will have to update their configuration as this release includes non-backward compatible changes.
The following configuration illustrates the changes:</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#c30>&#34;plugins&#34;</span><span style=color:#a00;background-color:#faa>:</span> {
</span></span><span style=display:flex><span>    <span style=color:#309;font-weight:700>&#34;storage_manager&#34;</span>: {
</span></span><span style=display:flex><span>        <span style=color:#309;font-weight:700>&#34;storages&#34;</span>: {
</span></span><span style=display:flex><span>            <span style=color:#309;font-weight:700>&#34;replication-test&#34;</span>: {
</span></span><span style=display:flex><span>                <span style=color:#309;font-weight:700>&#34;key_expr&#34;</span>: <span style=color:#c30>&#34;test/replication/*&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#309;font-weight:700>&#34;strip_prefix&#34;</span>: <span style=color:#c30>&#34;test/replication&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#309;font-weight:700>&#34;volume&#34;</span>: <span style=color:#c30>&#34;memory&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#09f;font-style:italic>// This field was named replica_config.
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span>                <span style=color:#309;font-weight:700>&#34;replication&#34;</span>: {
</span></span><span style=display:flex><span>                <span style=color:#09f;font-style:italic>// This field was named publication_interval.
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span>                <span style=color:#309;font-weight:700>&#34;interval&#34;</span>: <span style=color:#f60>10</span>,
</span></span><span style=display:flex><span>                <span style=color:#09f;font-style:italic>// This field was named delta.
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span>                <span style=color:#309;font-weight:700>&#34;sub_intervals&#34;</span>: <span style=color:#f60>5</span>,
</span></span><span style=display:flex><span>                <span style=color:#309;font-weight:700>&#34;propagation_delay&#34;</span>: <span style=color:#f60>250</span>,
</span></span><span style=display:flex><span>                <span style=color:#09f;font-style:italic>// These fields did not exist before.
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span>                <span style=color:#309;font-weight:700>&#34;hot&#34;</span>: <span style=color:#f60>6</span>,
</span></span><span style=display:flex><span>                <span style=color:#309;font-weight:700>&#34;warm&#34;</span>: <span style=color:#f60>30</span>,
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>As shown above, in addition to renaming some fields, we expose two new ones: hot and warm.
They expose to some extent the algorithm we use in order to keep <em>storage</em> aligned and have a direct impact on the quantity of information sent over the network.</p><p>As with most things in computer science, tweaking these values comes down to making a trade-off: the higher they are, the more information will be regularly sent but, in turn, the alignment process will be faster, requiring less exchanges.
Conversely, the lower they are, the less information will be regularly sent but the alignment process could take longer, requiring more message exchanges.
Choosing appropriate values depends on your system: if it is unstable only exceptionally and you do not expect your <em>storage</em> to diverge a lot, you can keep these values at their default.</p><p>Another important remark, and a difference compared to the previous implementation, is that <em>storage</em> will align only if their configurations are identical. This includes: (i) all the fields of the replication section, (ii) the key_expr field of the <em>storage</em> and (iii) the strip_prefix field of the <em>storage</em>.
The rationale is to avoid comparing information that, in fact, cannot be compared eventually leading to a significant overload: the full alignment algorithm would be triggered at every alignment interval, maybe to no avail if the <em>storage</em> are actually aligned.</p><hr><h2 id=tlsmtlsquic-configuration>TLS/mTLS/QUIC Configuration</h2><p>In Zenoh 1.0.0 we have changed the configuration parameters for TLS/mTLS/QUIC to faciliate the configuration.</p><p>The following configuration illustrates the changes:</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#c30>&#34;transport&#34;</span><span style=color:#a00;background-color:#faa>:</span> {
</span></span><span style=display:flex><span>    <span style=color:#309;font-weight:700>&#34;link&#34;</span>: {
</span></span><span style=display:flex><span>      <span style=color:#309;font-weight:700>&#34;tls&#34;</span>: {
</span></span><span style=display:flex><span>        <span style=color:#309;font-weight:700>&#34;root_ca_certificate&#34;</span>: <span style=color:#c30>&#34;/home/user/tls/minica.pem&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#309;font-weight:700>&#34;enable_mtls&#34;</span>: <span style=color:#069;font-weight:700>true</span>,
</span></span><span style=display:flex><span>        <span style=color:#309;font-weight:700>&#34;listen_private_key&#34;</span>: <span style=color:#c30>&#34;/home/user/tls/localhost/key.pem&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#309;font-weight:700>&#34;listen_certificate&#34;</span>: <span style=color:#c30>&#34;/home/user/tls/localhost/cert.pem&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#309;font-weight:700>&#34;connect_private_key&#34;</span>: <span style=color:#c30>&#34;/home/user/client/localhost/key.pem&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#309;font-weight:700>&#34;connect_certificate&#34;</span>: <span style=color:#c30>&#34;/home/user/client/localhost/cert.pem&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#309;font-weight:700>&#34;verify_name_on_connect&#34;</span>:<span style=color:#069;font-weight:700>false</span>,
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span></code></pre></div><p>For users already using a TLS configuration, it is sufficient to change the configuration parametes accoring to the following table:</p><table><thead><tr><th>Old</th><th>New</th></tr></thead><tbody><tr><td>client_auth</td><td>enable_mtls</td></tr><tr><td>server_name_verification</td><td>verify_name_on_connect</td></tr><tr><td>server_private_key</td><td>listen_private_key</td></tr><tr><td>server_certificate</td><td>listen_certificate</td></tr><tr><td>client_private_key</td><td>connect_private_key</td></tr><tr><td>client_certificate</td><td>connect_certificate</td></tr></tbody></table><hr><h2 id=zenoh-pico>Zenoh-Pico</h2><p>Zenoh-Pico implementes now the new <a href=#c-api>C API</a> as well the new <a href=#interest-protocol>interest protocol</a> when operating in client mode.
Therefore, Zenoh-Pico publishers will now start sending messages on the network only once at least one subscriber is detected, saving energy and bandwidth in case of nodody is interested in the actual data.
The interest feature will be implemented also for peer mode in the future.</p><hr><h2 id=changelog>Changelog</h2><p>The effort behind Zenoh 1.0.0 resulted in a large number of bugfixes and improvements.
The full changelog for every Zenoh repository is available at the following links: <a href=https://github.com/eclipse-zenoh/zenoh/releases>Rust</a>, <a href=https://github.com/eclipse-zenoh/zenoh-c/releases>C</a>, <a href=https://github.com/eclipse-zenoh/zenoh-cpp/releases>C++</a>, <a href=https://github.com/eclipse-zenoh/zenoh-python/releases>Python</a>, <a href=https://github.com/eclipse-zenoh/zenoh-kotlin/releases>Kotlin</a>, <a href=https://github.com/eclipse-zenoh/zenoh-pico/releases>Pico</a>, <a href=https://github.com/eclipse-zenoh/zenoh-plugin-dds/releases>DDS plugin</a>, <a href=https://github.com/eclipse-zenoh/zenoh-plugin-ros2/releases>ROS2 plugin</a>, <a href=https://github.com/eclipse-zenoh/zenoh-plugin-mqtt/releases>MQTT plugin</a>, <a href=https://github.com/eclipse-zenoh/zenoh-plugin-mqtt/releases>WebServer plugin</a>, <a href=https://github.com/eclipse-zenoh/zenoh-backend-filesystem/releases>Filesystem backend</a>, <a href=https://github.com/eclipse-zenoh/zenoh-backend-rocksdb/releases>RocksDB backend</a>, <a href=https://github.com/eclipse-zenoh/zenoh-backend-s3/releases>S3 backend</a>, <a href=https://github.com/eclipse-zenoh/zenoh-backend-influxdb/releases>InfluxDB backend</a>.</p><hr><h2 id=whats-next>What’s next?</h2><p>This has been quite a long blog post but the amount of new features introduced in Zenoh 1.0.0 deserved some space! And now what could you expect from Zenoh in the future?</p><ul><li>We will keep working on the API to stabilize those functions that today are marked as unstable: they work as expected but some changes may still land.</li><li>We are planning to extend more API functionalities to all the bindings, e.g. today some API is available only in Rust and we want to make it available as well in Python, C, and C++.</li><li>Liveliness support is planned to be added in Zenoh-Pico.</li><li>We will keep working on performance and scalability of all the zenoh ecosystem.</li><li>And many other cool things…</li></ul><p>Happy Hacking,</p><p>– The Zenoh Team</p><p>P.S. You can reach us out on Zenoh’s <a href=https://discord.com/invite/vSDSpqnbkm>Discord server</a>!</p><p><img src=../../img/20231003-blog-zenoh-dragonite/zenoh-on-fire.gif alt=Guitar></p><div class=ato-next><b>Next up</b>: <a href=../../blog/2024-04-30-zenoh-electrode/>Zenoh 0.11.0 "Electrode" release is out!</a></div></main></div></div><footer class="ato-footer text-muted"><div class="container-fluid p-6 p-md-5"><div class=row><div class=col-md-2><h5>Eclipse Incubation</h5><p><img src=../../img/eclipse-incubation.png style=width:100px></p><p>Eclipse zenoh &trade; is an incubating project under the Eclipse Foundation.</p></div><div class=col-md-2><h5>More Information</h5><p><a href=https://www.eclipse.org/legal target=_blank>Legal</a></p><p><a href=https://www.eclipse.org/legal/privacy.php target=_blank>Privacy policy</a></p><p><a href=https://www.eclipse.org/legal/termsofuse.php target=_blank>Terms of use</a></p><p><a href=https://www.eclipse.org/legal/copyright.php target=_blank>Copyright</a></p><p><a href=https://www.eclipse.org/security/ target=_blank>Report a security issue</a></p><p><a href=https://www.eclipse.org/legal/epl-2.0/ target=_blank>Eclipse Public License 2.0</a></p><p><a href=https://www.apache.org/licenses/LICENSE-2.0 target=_blank>Apache License 2.0</a></p><p><a href=https://www.eclipse.org/ target=_blank>Eclipse Foundation</a></p></div><div class=col-md-2><h5>Sponsored by:</h5><p><a href=https://www.eclipse.org target=_blank><img src=../../img/eclipse-foundation.svg style=width:120px></a></p><p><a href=https://zettascale.tech target=_blank><img src=../../img/zettascale-dark.svg style=width:120px></a></p></div><div class=col-md-2><h5>Follow us</h5><p><a href=https://github.com/eclipse-zenoh/zenoh><i class="fa fa-github" aria-hidden=true></i>
GitHub</a></p><p><a href=https://discord.gg/vSDSpqnbkm><i class="fa fa fa-comments-o" aria-hidden=true></i>
Discord</a></p><p><a href=https://www.youtube.com/channel/UCslbiyiqgOAPMjCrPWIfQ5Q><i class="fa fa-youtube-play" aria-hidden=true></i> Youtube</a></p><p><a href=../../docs/overview/what-is-zenoh><i class="fa fa-info-circle" aria-hidden=true></i> About</a></p></div><div class=col-md-2><p><img src=../../img/zenoh-dragon-150x163.png style=width:45px></p><p>Eclipse zenoh &trade; is free, open source and always will be.</p><p>Copyright &copy 2022 Eclipse Foundation</p><p>Built with <a href=https://gohugo.io/ target=_blank>HUGO</a></p></div></div></div></footer><script src=https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js integrity=sha384-3ceskX3iaEnIogmQchP8opvBy3Mi7Ce34nWjpBIwVTHfGYWQS9jwHDVRnpKKHJg7 crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/tether/1.3.7/js/tether.min.js integrity=sha384-XTs3FgkjiBgo8qjEjBk0tGmf3wPrWtA6coPfQDfFEY8AnYJwjalXCiosYRBIBZX8 crossorigin=anonymous></script>
<script src=../../js/bootstrap.min.js></script>
<script src=../../js/highlight.min.js></script>
<script>$(function(){$("pre code").each(function(e,t){if(t.className.indexOf("language-rust")>=0){for(var s="",n=t.textContent.split(`
`),e=0;e<n.length;e++){if(n[e].indexOf("# ")==0||n[e]=="#")continue;s+=n[e].trimRight()+`
`}t.textContent=s.replace(/\n\n\n/g,`

`).trimRight()}hljs.highlightBlock(t)})})</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-PBD6MS51QL"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-PBD6MS51QL",{anonymize_ip:!1})}</script></body></html>