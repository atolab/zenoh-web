<!doctype html><html lang=en><head><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.png><meta name=msapplication-TileImage content="/safari-pinned-tab.png"><meta name=msapplication-TileColor content="#7da7d8"><meta name=theme-color content="#7da7d8"><meta charset=utf-8><meta name=description content="Eclipse Zenoh, unify data in motion, data at rest and computations."><meta name=keywords content="pub/sub,query,geo distributed storage,Rust,protocol,DDS,MQTT,Edge,IoT,MEC"><meta name=author content="The Zenoh Team"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta http-equiv=x-ua-compatible content="ie=edge"><link rel=stylesheet href=../../css/bootstrap-reboot.css><link rel=stylesheet href=../../css/bootstrap.css><link rel=stylesheet href=../../css/font-awesome.min.css><link rel=stylesheet href=../../css/ato.css><link rel=stylesheet href=../../css/syntax.css><link rel=alternate type=application/rss+xml href=../../blog/index.xml><title>Minimizing Discovery Overhead in ROS2 · Zenoh - pub/sub, geo distributed storage, query</title></head><body><header class="navbar-expand navbar-dark d-flex flex-column flex-md-row align-items-md-center ato-navbar"><div class="d-flex flex-row justify-content-between pl-2 pr-2"><a class=navbar-brand href=../../><img src=../../img/zenoh-dragon-bg-150x163.png class=align-middle alt></a>
<button class="btn btn-link d-md-none p-0" type=button data-toggle=collapse data-target=#ato-nav aria-controls=ato-nav aria-expanded=false aria-label="Toggle navigation"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 30 30" width="30" height="30" focusable="false"><title>Menu</title><path stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-miterlimit="10" d="M4 7h22M4 15h22M4 23h22"/></svg></button></div><div class="ato-links collapse pl-4 pl-md-0" id=ato-nav><ul class="navbar-nav flex-column flex-md-row"><li class=nav-item><a class=nav-link href=../../>Home</a></li><li class=nav-item><a class=nav-link href=../../docs/getting-started/first-app/>Documentation</a></li><li class=nav-item><a class=nav-link href=../../usecases/>Use Cases</a></li><li class=nav-item><a class=nav-link href=../../community/>Community</a></li><li class=nav-item><a class=nav-link href=../../adopters/>Adopters</a></li><li class=nav-item><a class=nav-link href=../../media/>Media</a></li><li class=nav-item><a class="nav-link active" href=../../blog/2024-04-17-datadog-zenoh-router-integration/>Blog</a></li></ul></div><ul class="navbar-nav flex-row ml-md-auto d-none d-md-flex"><li class=nav-item><a class="nav-link p-2" href=https://github.com/eclipse-zenoh/zenoh target=_blank rel=noopener aria-label=GitHub><svg class="navbar-nav-svg" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 512 499.36" focusable="false"><title>GitHub</title><path d="M256 0C114.64.0.0 114.61.0 256c0 113.09 73.34 209 175.08 242.9 12.8 2.35 17.47-5.56 17.47-12.34.0-6.08-.22-22.18-.35-43.54-71.2 15.49-86.2-34.34-86.2-34.34-11.64-29.57-28.42-37.45-28.42-37.45-23.27-15.84 1.73-15.55 1.73-15.55 25.69 1.81 39.21 26.38 39.21 26.38 22.84 39.12 59.92 27.82 74.5 21.27 2.33-16.54 8.94-27.82 16.25-34.22-56.84-6.43-116.6-28.43-116.6-126.49.0-27.95 10-50.8 26.35-68.69-2.63-6.48-11.42-32.5 2.51-67.75.0.0 21.49-6.88 70.4 26.24a242.65 242.65.0 01128.18.0c48.87-33.13 70.33-26.24 70.33-26.24 14 35.25 5.18 61.27 2.55 67.75 16.41 17.9 26.31 40.75 26.31 68.69.0 98.35-59.85 120-116.88 126.32 9.19 7.9 17.38 23.53 17.38 47.41.0 34.22-.31 61.83-.31 70.23.0 6.85 4.61 14.81 17.6 12.31C438.72 464.97 512 369.08 512 256.02 512 114.62 397.37.0 256 0z" fill="currentcolor" fill-rule="evenodd"/></svg></a></li><li class=nav-item><a class="nav-link p-2" href=https://twitter.com/zettascaletech target=_blank rel=noopener aria-label=Twitter><svg class="navbar-nav-svg" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 512 416.32" focusable="false"><title>Twitter</title><path d="M160.83 416.32c193.2.0 298.92-160.22 298.92-298.92.0-4.51.0-9-.2-13.52A214 214 0 00512 49.38a212.93 212.93.0 01-60.44 16.6 105.7 105.7.0 0046.3-58.19 209 209 0 01-66.79 25.37 105.09 105.09.0 00-181.73 71.91 116.12 116.12.0 002.66 24c-87.28-4.3-164.73-46.3-216.56-109.82A105.48 105.48.0 0068 159.6a106.27 106.27.0 01-47.53-13.11v1.43a105.28 105.28.0 0084.21 103.06 105.67 105.67.0 01-47.33 1.84 105.06 105.06.0 0098.14 72.94A210.72 210.72.0 0125 370.84a202.17 202.17.0 01-25-1.43 298.85 298.85.0 00160.83 46.92" fill="currentcolor"/></svg></a></li><li class=nav-item><a class="nav-link p-2" href=https://discord.gg/2GJ958VuHs target=_blank rel=noopener aria-label=Discord><svg class="navbar-nav-svg" xmlns="http://www.w3.org/2000/svg" focusable="false"><title>Discord</title><path fill="currentcolor" d="M13.545 2.907a13.227 13.227.0 00-3.257-1.011.05.05.0 00-.052.025c-.141.25-.297.577-.406.833a12.19 12.19.0 00-3.658.0 8.258 8.258.0 00-.412-.833.051.051.0 00-.052-.025c-1.125.194-2.22.534-3.257 1.011a.041.041.0 00-.021.018C.356 6.024-.213 9.047.066 12.032c.001.014.01.028.021.037a13.276 13.276.0 003.995 2.02.05.05.0 00.056-.019c.308-.42.582-.863.818-1.329a.05.05.0 00-.01-.059.051.051.0 00-.018-.011 8.875 8.875.0 01-1.248-.595.05.05.0 01-.02-.066.051.051.0 01.015-.019c.084-.063.168-.129.248-.195a.05.05.0 01.051-.007c2.619 1.196 5.454 1.196 8.041.0a.052.052.0 01.053.007c.08.066.164.132.248.195a.051.051.0 01-.004.085 8.254 8.254.0 01-1.249.594.05.05.0 00-.03.03.052.052.0 00.003.041c.24.465.515.909.817 1.329a.05.05.0 00.056.019 13.235 13.235.0 004.001-2.02.049.049.0 00.021-.037c.334-3.451-.559-6.449-2.366-9.106a.034.034.0 00-.02-.019zm-8.198 7.307c-.789.0-1.438-.724-1.438-1.612.0-.889.637-1.613 1.438-1.613.807.0 1.45.73 1.438 1.613.0.888-.637 1.612-1.438 1.612zm5.316.0c-.788.0-1.438-.724-1.438-1.612.0-.889.637-1.613 1.438-1.613.807.0 1.451.73 1.438 1.613.0.888-.631 1.612-1.438 1.612z"/></svg></a></li><li class=nav-item><a class="nav-link p-2" href=https://www.youtube.com/channel/UCslbiyiqgOAPMjCrPWIfQ5Q target=_blank rel=noopener aria-label=Youtube><svg class="navbar-nav-svg" xmlns="http://www.w3.org/2000/svg" focusable="false"><title>Youtube</title><path fill="currentcolor" d="M8.051 1.999h.089c.822.003 4.987.033 6.11.335a2.01 2.01.0 011.415 1.42c.101.38.172.883.22 1.402l.01.104.022.26.008.104c.065.914.073 1.77.074 1.957v.075c-.001.194-.01 1.108-.082 2.06l-.008.105-.009.104c-.05.572-.124 1.14-.235 1.558a2.007 2.007.0 01-1.415 1.42c-1.16.312-5.569.334-6.18.335h-.142c-.309.0-1.587-.006-2.927-.052l-.17-.006-.087-.004-.171-.007-.171-.007c-1.11-.049-2.167-.128-2.654-.26a2.007 2.007.0 01-1.415-1.419c-.111-.417-.185-.986-.235-1.558L.09 9.82.082 9.716A31.4 31.4.0 010 7.68v-.123c.002-.215.01-.958.064-1.778l.007-.103.003-.052.008-.104.022-.26.01-.104c.048-.519.119-1.023.22-1.402a2.007 2.007.0 011.415-1.42c.487-.13 1.544-.21 2.654-.26l.17-.007.172-.006.086-.003.171-.007A99.788 99.788.0 017.858 2h.193zM6.4 5.209v4.818l4.157-2.408L6.4 5.209z"/></svg></a></li></ul><script async src="https://www.googletagmanager.com/gtag/js?id=G-PBD6MS51QL"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-PBD6MS51QL")</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":""},"articleSection":"blog","name":"Minimizing Discovery Overhead in ROS2","headline":"Minimizing Discovery Overhead in ROS2","datePublished":"2021-03-23 00:00:00 \u002b0000 UTC","dateModified":"2021-03-23 00:00:00 \u002b0000 UTC","url":"\/blog\/2021-03-23-discovery\/","inLanguage":"en-US","author":"","creator":"","publisher":"","accountablePerson":"","copyrightHolder":"","copyrightYear":"232323","wordCount":"2604","keywords":[],"description":"23 March 2021 -- Paris."}</script></header><div class="container-fluid ato-blog"><div class="row flex-xl-nowrap"><div class="col-12 col-md-3 col-xl-2 ato-sidebar"><div class="ato-docs-toggle d-md-none p-0 d-flex ml-3 collapsed align-item-center"><h1 class=ato-title>Minimizing Discovery Overhead in ROS2</h1><button class="btn btn-link" type=button data-toggle=collapse data-target=#ato-docs-nav aria-controls=ato-docs-nav aria-expanded=false aria-label="Toggle docs navigation"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 30 30" width="30" height="30" focusable="false"><title>Menu</title><path stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-miterlimit="10" d="M4 7h22M4 15h22M4 23h22"/></svg></button></div><nav class="ato-links collapse" id=ato-docs-nav><div class="ato-toc-item active"><p class=ato-toc-link>Blog Posts</p><ul class="nav ato-sidenav"><li><a href=../../blog/2024-04-17-datadog-zenoh-router-integration/>Streamlining Zenoh router Monitoring with Datadog Integration</a></li><li><a href=../../blog/2024-01-31-zenoh-flow-getting-started/>Zenoh-Flow 0.6.0-rc: Getting Started</a></li><li><a href=../../blog/2023-10-03-zenoh-dragonite/>Zenoh Dragonite Took Off!</a></li><li><a href=../../blog/2023-07-17-s3-backend/>Zenoh Storage Gets a Boost: Empowering Storage with S3 Integration</a></li><li><a href=../../blog/2023-06-05-charmander2/>Zenoh Charmander Grows Stronger</a></li><li><a href=../../blog/2023-04-04-letsencrypt/>Securing Zenoh with LetsEncrypt: A Comprehensive Guide</a></li><li><a href=../../blog/2023-03-21-zenoh-vs-mqtt-kafka-dds/>Comparing the Performance of Zenoh, MQTT, Kafka, and DDS</a></li><li><a href=../../blog/2023-02-10-zenoh-flow/>Data Flow programming with Zenoh-Flow</a></li><li><a href=../../blog/2023-01-17-zenoh-wireshark/>The Blue Dragon meets the Wire’s Shark</a></li><li><a href=../../blog/2023-01-10-zenoh-charmander/>Zenoh Charmander is coming to town</a></li><li><a href=../../blog/2022-11-29-zenoh-alignment/>Keeping storages aligned in Zenoh</a></li><li><a href=../../blog/2022-09-30-zenoh-bahamut/>Zenoh Bahamut takes flight!</a></li><li><a href=../../blog/2022-08-12-zenoh-serial/>There is Land Besides IP: How to Cross It with Zenoh</a></li><li><a href=../../blog/2022-06-09-zenoh-pico-above-and-beyond/>Zenoh-Pico: Above and Beyond</a></li><li><a href=../../blog/2022-04-14-rust-async-eval/>A Performance Evaluation on Rust Asynchronous Frameworks</a></li><li><a href=../../blog/2022-03-30-zenoh-mobility/>Mobility, Latency and Energy saving</a></li><li><a href=../../blog/2022-02-08-dragonbot/>DragonBotOne Egg Hatching with Zenoh and Zenoh-Pico</a></li><li><a href=../../blog/2021-11-09-ros2-zenoh-pico/>ROS 2 and microcontrollers integration via Zenoh-pico</a></li><li><a href=../../blog/2021-10-04-zenoh-pico-guide/>Zenoh goes embedded with zenoh-pico</a></li><li><a href=../../blog/2021-09-28-iac-experiences-from-the-trenches/>Indy Autonomous Challenge (IAC): Experiences from the Trenches</a></li><li><a href=../../blog/2021-07-13-zenoh-performance-async/>Zenoh performance: a stroll in Rust async wonderland</a></li><li><a href=../../blog/2021-07-05-zenoh-overhead/>Zenoh overhead: a story from our community</a></li><li><a href=../../blog/2021-06-14-zenoh-reliability/>Zenoh Reliability, Scalability and Congestion Control</a></li><li><a href=../../blog/2021-04-28-ros2-integration/>Integrating ROS2 with Eclipse zenoh</a></li><li><a href=../../blog/2021-03-23-discovery/>Minimizing Discovery Overhead in ROS2</a></li><li><a href=../../blog/2020-10-08-aithusa/>Zenoh Aithusa Hatched Out!</a></li><li><a href=../../blog/2020-06-29-zenoh-tidings/>Zenoh Tidings</a></li><li><a href=../../blog/2020-01-01-zenohtude/>A Year Full of Zenoh</a></li></ul></div></nav></div><div class="d-none d-xl-block col-xl-2 ato-toc"><div class=section-nav><nav id=TableOfContents><ul><li><a href=#dds-discovery-fundamentals>DDS Discovery Fundamentals</a></li><li><a href=#zenoh>Zenoh</a></li><li><a href=#real-world-use-case>Real World Use Case</a></li><li><a href=#dds-scenario>DDS Scenario</a></li><li><a href=#zenoh-scenario>Zenoh Scenario</a><ul><li><a href=#zenohs-discovery-and-resource-generalisation>Zenoh&rsquo;s Discovery and Resource Generalisation</a></li><li><a href=#leveraging-resource-generalisation>Leveraging Resource Generalisation</a></li><li><a href=#cold-and-warm-start>Cold and Warm Start</a></li></ul></li><li><a href=#measuring-discovery-data>Measuring Discovery Data</a><ul><li><a href=#dds>DDS</a></li><li><a href=#zenoh-1>Zenoh</a></li></ul></li><li><a href=#experimental-results>Experimental Results</a></li></ul></nav></div></div><main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 ato-content ato-docs"><h1 class=ato-title>Minimizing Discovery Overhead in ROS2</h1><p class=ato-date>23 March 2021 -- Paris.</p><p>The amount of discovery traffic generated by ROS2 is a problem that has
received an increasing attention in the community. The discovery overhead
issue becomes extremely severe when running over wireless technologies,
such as WiFi, and in particular in combination with more complex robots, robot
swarms and tele-operation. The <a href=https://docs.ros.org/en/foxy/Tutorials/Discovery-Server/Discovery-Server.html>ROS2 Discovery Service</a> has been proposed
as a way to alleviate the problem, not necessarily to solve it.</p><p>In the reminder of this post I&rsquo;ll explain the essence of problem,
remind what was tried in the past and unveils a <a href=https://github.com/eclipse-zenoh/zenoh><strong>Zenoh</strong></a> based solution that
(1) drastically reduces DDS discovery overhead &ndash; from 97% to 99,9% in tested scenarios,
(2) allows for peer-to-peer communication when useful,
(3) enables efficient Internet-scale routing when necessary, and
(3) does not require any changes to your existing ROS2 systems.</p><p>Ready, let&rsquo;s go!</p><h1 id=understanding-the-problem>Understanding the Problem</h1><p>As many of you should know, ROS2 uses the <a href=https://www.omg.org/omg-dds-portal/>Data Distribution Service (DDS)</a> as the mean to communicate and share data
across ROS2 nodes. Thus, when people discuss about ROS2 discovery,
they really mean DDS discovery &ndash; in any case, this is what is used
under-the-hood.</p><p>The problem of DDS discovery has been known for quite some time. The oldest
trace I can find of a public reference to the issue goes back to this
<a href=https://www.slideshare.net/Angelo.Corsaro/scaling-the-data-distribution-service-to-global-networks>presentation</a> I gave back in 2009.
As a team we did work hard to address this problem and already in 2012 we
had products, such as <a href=https://www.slideshare.net/Angelo.Corsaro/building-and-scaling-internet-of-things-applications-with-vortex-cloud-37188676>Vortex Cloud</a> (now Vortex Link), used by our customers to either scale DDS over a wired WAN or to reduce discovery traffic. One notable user of Vortex Cloud was
<a href=https://www.adlinktech.com/en/News_18100302503788216.aspx>NASA SMART NAS</a>. Thus I can humbly claim that, in a way, we&rsquo;ve been there and we&rsquo;ve done that long time back. The experience gathered during those years, was one of the main drivers for coming up with <a href=https://github.com/eclipse-zenoh/zenoh><strong>Zenoh</strong></a>. But before we get there, let me try to explain what the DDS discovery problem is and why it is inevitably entangled with the very nature of DDS.</p><h2 id=dds-discovery-fundamentals>DDS Discovery Fundamentals</h2><p>DDS has two discovery protocols, one called the SPDP (Simple Participant Discovery Protocol) and one called SEDP (Simple Entity Discovery Protocol).
The SPDP essentially takes care of finding out who is around, in DDS jargon
it finds domain participants. Once discovered a new domain participant the
SEPD kicks-in to mutually exchange the full list of data-readers, data-writers and optionally topics. As a consequence the amount of discovery data generated by real-world applications grows quadratically in the number of nodes. More precisely, assuming we have a system with <strong>n</strong> domain participants each of which has
<strong>r</strong> readers and <strong>w</strong> writers, then the amount of discovery traffic scales with <strong>n*(n-1)*(r+w)</strong>.</p><p>Additionally to the generated traffic, the DDS discovery model forces every domain participant to retain all discovery information. In other terms, every participant
has to keep track of every single reader and writer available on any other participant within the same domain &ndash; all of this in spite of whether
that is of interest or not.</p><p>As we did in <a href=https://www.slideshare.net/Angelo.Corsaro/building-and-scaling-internet-of-things-applications-with-vortex-cloud-37188676>Vortex Cloud</a> some of this can be alleviated, yet the bulk of the problem is tied to design decisions that are at the very heart of DDS. Its end-points matching and reliability model is probably the main one, not to mention that DDS was designed with wired network in mind, networks in which bandwidth is plentiful and packet losses are relatively rare.</p><p>These are the reasons for the known challenges on WiFi and the hard truth about how far can we get with DDS because
of its inherent model and assumptions.</p><p>As I mentioned above, our efforts trying to scale DDS made it evident that Discovery was one of the elephants in the room,
but not the only one. This led us to look at things differently, it led us into designing <a href=https://github.com/eclipse-zenoh/zenoh><strong>Zenoh</strong></a>.</p><h2 id=zenoh>Zenoh</h2><p>When designing <a href=https://github.com/eclipse-zenoh/zenoh><strong>Zenoh</strong></a>, discovery overhead was one of the issues we wanted to
tackle along with the ability to support Internet-scale applications, constrained devices and networks.</p><p>Another problem we wanted to solve, that is interesting per-se but not relevant for this blog, was the unification of data
in motion an data at rest. This makes it much easier to support robot swarms, tele-operation and in general any kind of
applications in where you have to deal with data in motion as well geographically dispersed data at rest.
Will provide some coverage on later instalment of this blog series, for now let&rsquo;s get back to the protocol aspects.</p><p>Zenoh manages to drastically lower discovery traffic because (1) it only advertises resource interests, in other terms
does not need to advertise publishers, (2) resource interests can be generalized to &ldquo;compress&rdquo; discovery data,
(3) discovery messages are extremely wire efficient, and (4) the reliability protocol is between run-times as opposed
to every couple of reader and writers as in DDS.</p><p>In this blog we will see how the design decisions summarized above significantly impact discovery traffic and more importantly how
you can leverage <strong>zenoh</strong> along with your favorite DDS &ndash; which I hope is
<a href=http://github.com/eclipse-cyclonedds/cyclonedds><strong>Eclipse Cyclone DDS</strong></a> &ndash; in order to massively reduce the discovery traffic,
and take advantage of the many super-cool features zenoh has to provide, including Internet-scale routing, geo-distributed storages, distributed queries, etc.</p><h2 id=real-world-use-case>Real World Use Case</h2><p>Instead of crafting a synthetic benchmark, we decided to run a real-world <strong>ROS2</strong> application and measure the
discovery overhead induced by <strong>DDS</strong> and <strong>zenoh</strong> in the context of this application. As shown below, we run
<a href=https://www.stereolabs.com/docs/ros2/rviz2/>RVIZ2</a> in combination with the <a href=https://emanual.robotis.com/docs/en/platform/turtlebot3/overview/#overview>turtlebot burger</a>
<a href=https://emanual.robotis.com/docs/en/platform/turtlebot3/slam/>SLAM</a> application and measured the discovery traffic generated
by each of the two technologies.</p><p><img src=../../img/2021.03.18-disco-scenario.png alt=msg-sec></p><p>The <a href=https://emanual.robotis.com/docs/en/platform/turtlebot3/overview/#overview>turtlebot burger</a> was running
<a href=https://docs.ros.org/en/foxy/Installation.html>ROS2 Foxy</a> and was connected to a WiFi network powered by a
<a href=https://www.netgear.com/home/wifi/routers/r6020/>NetGear NightHawk</a> router. <a href=https://www.stereolabs.com/docs/ros2/rviz2/>RVIZ2</a> for <a href=https://docs.ros.org/en/foxy/Installation.html>ROS2 Foxy</a> was running on a <a href=https://system76.com/laptops/galago>System76 Galago</a> Linux laptop.</p><h2 id=dds-scenario>DDS Scenario</h2><p>To measure the discovery traffic, we started the SLAM application on the turtlebot and awaited for it to be ready. Only then, we started, simultaneously, Wireshark and RVIZ2 on the laptop and captured DDS packets until RVIZ2 was showing the map created by the robot &ndash; the setup is depicted in the diagram below.</p><p><img src=../../img/2021.03.18-dds-scenario.png alt=msg-sec></p><p>The command used on the turtlebot was:</p><pre><code>$ ros2 launch turtlebot3_bringup robot.launch.py
</code></pre><p>The command used on the laptop to start RVIZ2 was:</p><pre><code>$ ros2 launch turtlebot3_cartographer cartographer.launch.py
</code></pre><h2 id=zenoh-scenario>Zenoh Scenario</h2><p>The first question you may have, is how can you use zenoh to transparently bridge ROS2/DDS communication?
The <a href=https://github.com/eclipse-zenoh>Eclipse Zenoh Project</a> makes available the <a href=https://github.com/eclipse-zenoh/zenoh-plugin-dds>zenoh-plugin-dds</a> to transparently bridge DDS communication over zenoh and vice-versa. You can use this service to route DDS traffic over zenoh, for instance to tele-operate a robot over the internet, or to interact with a DDS or a ROS2 application through the zenoh ecosystem &ndash; will show how to do that on our next blog.</p><p>To measure the discovery overhead introduced by zenoh, we configured ROS on the robot and the laptop to use
different domains &ndash; to ensure that they could not discover each other via DDS &ndash; then we deployed an instance of <a href=https://github.com/eclipse-zenoh/zenoh-plugin-dds>zenoh-plugin-dds</a> respectively on the robot and on the laptop. As a consequence all data flowing through the network was going over zenoh. Locally, to the robot and to the laptop, we had the <a href=https://github.com/eclipse-zenoh/zenoh-plugin-dds>zenoh-plugin-dds</a> bridging from DDS to zenoh and zenoh to DDS.</p><p>To ensure that the scenario was as close as possible to that using DDS, we configured the <a href=https://github.com/eclipse-zenoh/zenoh-plugin-dds>zenoh-plugin-dds</a> to operate as a peer. Thus from a functional perspective it is important to understand the peer-to-peer communication model supported by ROS2 was maintained without any functional degradation. It is also important to say that the RVIZ2 application was running without no limitations or degradations.</p><p>The scenario used to measure zenoh discovery overhead is depicted below.</p><p><img src=../../img/2021.03.18-zenoh-scenario.png alt=msg-sec></p><p>The application we ran on the robot were:</p><pre><code> $ cargo run --release -- dzd -m peer -d 21
 $ ROS_DOMAIN_ID=21 ros2 launch turtlebot3_bringup robot.launch.py
</code></pre><p>and on the laptop:</p><pre><code> $ cargo run --release -- dzd -m peer -d 42
 $ ROS_DOMAIN_ID=42 ros2 launch turtlebot3_cartographer cartographer.launch.py
</code></pre><h3 id=zenohs-discovery-and-resource-generalisation>Zenoh&rsquo;s Discovery and Resource Generalisation</h3><p>As de briefly mentioned earlier in this post, zenoh has a very different approach to discovery when compared to DDS. In a way we could say that
DDS is very detail oriented to the level of becoming pedantic. What do I mean with this?
DDS exchanges the tiny nitty gritty details of every single writers and readers available for a given topic (an optionally the topic info too), and by the way it exchanges it even if I do not care about the majority of it.</p><p>Zenoh operates very differently. This was a conscious choice, because when designing zenoh we wanted to
make sure that we could predict the resource used by an application in spite of the number of <em>&ldquo;matching&rdquo;</em> reader/writers.
In other terms, having a writer matching one or one million readers makes a huge difference in DDS in terms of discovery traffic generated, reliability protocol overhead, and discovery data to keep in memory. When designing <strong>zenoh</strong> we did not want to have this undesirable side-effect.</p><p>This lead toward a design geared toward sharing only resource interests as opposed to sharing interest as well as those who are interested, <em>i.e.</em>, readers and writers. This is a big difference and one of the areas where zenoh has much better scalability. The other trick we play in zenoh is that, our protocol may decide
to make generalizations &ndash; to make a parallel with what I was mentioning above, it raises the level of abstraction and tries to detach itself from the details. What do I mean with that? This is best explained with an example, suppose that your robot publishes data for <code>/mybot/sensor/lidar</code>,
<code>/mybot/sensor/camera</code>, <code>/mybot/dynamics/odometry</code>, etc. Zenoh, when looking at these resources may decide that the only thing the rest of the world needs to know is that they have to come to this robot when looking for anything that matches<code>/mybot/**</code>. This is in simple terms what we mean by resource generalization. This is an important mechanism to compress discovery information and to ensure that the discovery information can withstand Internet scale applications. As a result, in zenoh all routing and matching is performed using set-theoretic operations and set-coverage &ndash; for instance to figure out the minimal set of storages that can answer a query.
The zenoh protocol performs resource generalization automatically whenever it makes sense but it also exposes an API for the user to give hints.</p><h3 id=leveraging-resource-generalisation>Leveraging Resource Generalisation</h3><p>To demonstrate the effectiveness of zenoh&rsquo;s resource generalization we ran an additional scenario whereby using an option
of our <a href=https://github.com/eclipse-zenoh/zenoh-plugin-dds>zenoh-plugin-dds</a> we made the resource space for the robot
rooted by simply prefixing it with <code>/bot</code>. Then we also gave hint to aggressively generalize resources matching this
prefix.</p><p>Thus to measure zenoh&rsquo;s discovery overhead when leveraging resource generalization, we ran the same scenario as above, with the following arguments:</p><pre><code># On the Turtlebot

$ cargo run --release -- dzd -m peer -d 21 -s /bot -r /bot/** -w /bot/**
$ ROS_DOMAIN_ID=21 ros2 launch turtlebot3_bringup robot.launch.py



# On the Laptop

$ cargo run --release -- dzd -m peer -d 21 -s /bot -r /bot/** -w /bot/**
$ ROS_DOMAIN_ID=42 ros2 launch turtlebot3_cartographer cartographer.launch.py
</code></pre><p>For your reference these are the options supported by our <strong>dzd</strong> bridge:</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#099>$</span><span style=color:#bbb> </span>dzd<span style=color:#bbb> </span><span style=color:#555>--</span>help<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>dzd<span style=color:#bbb> </span>zenoh<span style=color:#bbb> </span>router<span style=color:#bbb> </span><span style=color:#069;font-weight:700>for</span><span style=color:#bbb> </span>DDS<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>USAGE:
</span></span><span style=display:flex><span>        <span style=color:#0a8;font-weight:700>dzd</span><span style=color:#bbb> </span>[OPTIONS]<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>FLAGS:
</span></span><span style=display:flex><span>        <span style=color:#555>-</span>h,<span style=color:#bbb> </span><span style=color:#555>--</span>help<span style=color:#bbb>       </span>Prints<span style=color:#bbb> </span>help<span style=color:#bbb> </span>information<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#555>-</span>V,<span style=color:#bbb> </span><span style=color:#555>--</span>version<span style=color:#bbb>    </span>Prints<span style=color:#bbb> </span>version<span style=color:#bbb> </span>information<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>OPTIONS:
</span></span><span style=display:flex><span>        <span style=color:#555>-</span>a,<span style=color:#bbb> </span><span style=color:#555>--</span>allow<span style=color:#bbb> </span><span style=color:#555>&lt;</span><span style=color:#366>String</span><span style=color:#555>&gt;</span><span style=color:#bbb>                </span>The<span style=color:#bbb> </span>regular<span style=color:#bbb> </span>expression<span style=color:#bbb> </span>describing<span style=color:#bbb> </span>set<span style=color:#bbb> </span>of<span style=color:#bbb> </span><span style=color:#555>/</span>partition<span style=color:#555>/</span>topic<span style=color:#555>-</span>name<span style=color:#bbb> </span>that<span style=color:#bbb> </span>should<span style=color:#bbb> </span>be<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>                                            </span>bridged,<span style=color:#bbb> </span>everything<span style=color:#bbb> </span>is<span style=color:#bbb> </span>forwarded<span style=color:#bbb> </span>by<span style=color:#bbb> </span>default.<span style=color:#555>&#39;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#555>-</span>c,<span style=color:#bbb> </span><span style=color:#555>--</span>config<span style=color:#bbb> </span><span style=color:#555>&lt;</span>FILE<span style=color:#555>&gt;</span><span style=color:#bbb>                 </span>A<span style=color:#bbb> </span>configuration<span style=color:#bbb> </span>file.<span style=color:#555>&#39;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#555>-</span>d,<span style=color:#bbb> </span><span style=color:#555>--</span>domain<span style=color:#bbb> </span><span style=color:#555>&lt;</span>ID<span style=color:#555>&gt;</span><span style=color:#bbb>                   </span>The<span style=color:#bbb> </span>DDS<span style=color:#bbb> </span>Domain<span style=color:#bbb> </span>ID<span style=color:#bbb> </span>(<span style=color:#069;font-weight:700>if</span><span style=color:#bbb> </span>using<span style=color:#bbb> </span>with<span style=color:#bbb> </span>ROS<span style=color:#bbb> </span>this<span style=color:#bbb> </span>should<span style=color:#bbb> </span>be<span style=color:#bbb> </span>the<span style=color:#bbb> </span>same<span style=color:#bbb> </span><span style=color:#069;font-weight:700>as</span><span style=color:#bbb> </span>ROS_DOMAIN_ID).<span style=color:#555>&#39;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#555>-</span>w,<span style=color:#bbb> </span><span style=color:#555>--</span>generalise<span style=color:#555>-</span><span style=color:#069;font-weight:700>pub</span><span style=color:#bbb> </span><span style=color:#555>&lt;</span><span style=color:#366>String</span><span style=color:#555>&gt;..</span>.<span style=color:#bbb>    </span>A<span style=color:#bbb> </span>comma<span style=color:#bbb> </span>separated<span style=color:#bbb> </span>list<span style=color:#bbb> </span>of<span style=color:#bbb> </span>key<span style=color:#bbb> </span>expression<span style=color:#bbb> </span>to<span style=color:#bbb> </span><span style=color:#069;font-weight:700>use</span><span style=color:#bbb> </span><span style=color:#069;font-weight:700>for</span><span style=color:#bbb> </span>generalising<span style=color:#bbb> </span>pubblications.<span style=color:#555>&#39;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#555>-</span>r,<span style=color:#bbb> </span><span style=color:#555>--</span>generalise<span style=color:#555>-</span>sub<span style=color:#bbb> </span><span style=color:#555>&lt;</span><span style=color:#366>String</span><span style=color:#555>&gt;..</span>.<span style=color:#bbb>    </span>A<span style=color:#bbb> </span>comma<span style=color:#bbb> </span>separated<span style=color:#bbb> </span>list<span style=color:#bbb> </span>of<span style=color:#bbb> </span>key<span style=color:#bbb> </span>expression<span style=color:#bbb> </span>to<span style=color:#bbb> </span><span style=color:#069;font-weight:700>use</span><span style=color:#bbb> </span><span style=color:#069;font-weight:700>for</span><span style=color:#bbb> </span>generalising<span style=color:#bbb> </span>subscriptions.<span style=color:#555>&#39;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#555>-</span>l,<span style=color:#bbb> </span><span style=color:#555>--</span>listener<span style=color:#bbb> </span><span style=color:#555>&lt;</span>LOCATOR<span style=color:#555>&gt;..</span>.<span style=color:#bbb>         </span>Locators<span style=color:#bbb> </span>to<span style=color:#bbb> </span>listen<span style=color:#bbb> </span>on.<span style=color:#555>&#39;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#555>-</span>m,<span style=color:#bbb> </span><span style=color:#555>--</span>mode<span style=color:#bbb> </span><span style=color:#555>&lt;</span>MODE<span style=color:#555>&gt;</span><span style=color:#bbb>                   </span>The<span style=color:#bbb> </span>zenoh<span style=color:#bbb> </span>session<span style=color:#bbb> </span>mode.<span style=color:#555>&#39;</span><span style=color:#bbb> </span>[default: <span style=color:#0a8;font-weight:700>client</span>]<span style=color:#bbb>  </span>[possible<span style=color:#bbb> </span>values: <span style=color:#0a8;font-weight:700>peer</span>,<span style=color:#bbb> </span>client]<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#555>-</span>e,<span style=color:#bbb> </span><span style=color:#555>--</span>peer<span style=color:#bbb> </span><span style=color:#555>&lt;</span>LOCATOR<span style=color:#555>&gt;..</span>.<span style=color:#bbb>             </span>Peer<span style=color:#bbb> </span>locator<span style=color:#bbb> </span>used<span style=color:#bbb> </span>to<span style=color:#bbb> </span>initiate<span style=color:#bbb> </span>the<span style=color:#bbb> </span>zenoh<span style=color:#bbb> </span>session.<span style=color:#555>&#39;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#555>-</span>s,<span style=color:#bbb> </span><span style=color:#555>--</span>scope<span style=color:#bbb> </span><span style=color:#555>&lt;</span><span style=color:#366>String</span><span style=color:#555>&gt;..</span>.<span style=color:#bbb>             </span>A<span style=color:#bbb> </span>string<span style=color:#bbb> </span>used<span style=color:#bbb> </span><span style=color:#069;font-weight:700>as</span><span style=color:#bbb> </span>prefix<span style=color:#bbb> </span>to<span style=color:#bbb> </span>scope<span style=color:#bbb> </span>DDS<span style=color:#bbb> </span>traffic.<span style=color:#555>&#39;</span><span style=color:#bbb>
</span></span></span></code></pre></div><h3 id=cold-and-warm-start>Cold and Warm Start</h3><p>Another aspect that we need to consider when using zenoh in this configuration is whether we measure the discovery traffic assuming that nothing is running on the laptop, in other terms we start <code>dzd</code> after we start capturing zenoh packets, or else we assume that the zenoh infrastructure is already up and running and we only start <code>RVIZ2</code>. We call <strong>cold start</strong> the case in which nothing is running on the laptop before we start measuring zenoh discovery data and <strong>warm start</strong> the case in which <code>dzd</code> is already running. On a real-world scenario you would have dzd running, but we prefer to measure the two cases to show the worst case scenario.</p><h2 id=measuring-discovery-data>Measuring Discovery Data</h2><h3 id=dds>DDS</h3><p>To evaluate the traffic generated by DDS discovery data we take into account the SPDP (Single Participant Discovery Protocol) and SEDP (Simple Entity Discovery Protocol) generated from the start of RVIZ2 to the last SEDP &ndash; which is the last reader or writer declaration. After the last SEPD message nothing else is taken into account. We think this is a fair measure since it represents the amount of discovery data necessary to establish proper communication between the two DDS applications.</p><h3 id=zenoh-1>Zenoh</h3><p>To evaluate the traffic generated by zenoh we measure the overhead coming from the session opening and the link-state algorithm along with all the packets containing resource declarations. You may wonder why zenoh peers run a link-state algorithm, well they do it to be able to support communication on <a href=http://zenoh.io/docs/getting-started/key-concepts/>arbitrary mesh topologies</a>, we&rsquo;ll share more details on some later blog post.</p><h2 id=experimental-results>Experimental Results</h2><p>The experiments described above were run five times each and for each run we measured discovery data. While for zenoh the measured data was stable across experiment, on DDS we saw a fluctuation of roughly 50Kbytes. To make the comparison even more compelling, we decided to take the best measure for DDS. Once again for zenoh we did not see variability across experiments.</p><p>The table below shows, for DDS, zenoh and for each of the scenarios described above, the number of discovery packets, their average size in bytes and more importantly the total number of bytes exchanged. The last column shows the percentage of discovery traffic reduction measured for zenoh.</p><table class="table table-striped table-bordered"><thead><tr><th style=text-align:right></th><th style=text-align:center>Packets</th><th style=text-align:center>Avg Size (Bytes)</th><th style=text-align:center>Total Bytes</th><th style=text-align:center>Zenoh Discovery Reduction %</th></tr></thead><tbody><tr><td style=text-align:right>DDS</td><td style=text-align:center>686</td><td style=text-align:center>366.73</td><td style=text-align:center>251576</td><td style=text-align:center></td></tr><tr><td style=text-align:right>Zenoh</td><td style=text-align:center>31</td><td style=text-align:center>213.45</td><td style=text-align:center>6617</td><td style=text-align:center>97.37%</td></tr><tr><td style=text-align:right>Zenoh RG</td><td style=text-align:center>13</td><td style=text-align:center>136,54</td><td style=text-align:center>1775</td><td style=text-align:center>99.29%</td></tr><tr><td style=text-align:right>Zenoh WS</td><td style=text-align:center>17</td><td style=text-align:center>276,41</td><td style=text-align:center>4699</td><td style=text-align:center>98.13%</td></tr><tr><td style=text-align:right>Zenoh RGWS</td><td style=text-align:center>1</td><td style=text-align:center>82</td><td style=text-align:center>82</td><td style=text-align:center>99.97%</td></tr></tbody></table><p>Where:</p><ul><li><strong>RG</strong> stands for <strong>R</strong>esorce <strong>G</strong>eneralisation</li><li><strong>WS</strong> stands for <em><strong>W</strong></em>arm <em><strong>S</strong></em>tart</li></ul><p>By looking at the table it is clear how much zenoh can drastically reduce the discovery overhead. In the measured scenarios,
zenoh is already able to reduce discovery by <strong>97.37%</strong> in the worst case. It gets to <strong>99.29%</strong> reduction in discovery traffic as soon as
we add some structure to the turtlebot ROS2 topics by prefixing them with <code>/bot</code> and gets to the incredible <strong>99.97%</strong> reduction in discovery traffic when combining resource generalization with warm start.</p><p>We think these results are extremely encouraging and in a way explain why those who have moved to zenoh for Robot to Everything (R2X) communication have
experienced huge improvements over wireless networks and in particular WiFi. The other good news is that to leverage zenoh you do not have to change anything to your application.
Just drop-in the <a href=https://github.com/eclipse-zenoh/zenoh-plugin-dds>zenoh-plugin-dds</a> and have fun!</p><p>But there is even more that you can do, such as writing native zenoh applications and have them seamlessly interact with ROS2. We&rsquo;ll cover these and other cool matters in upcoming posts.</p><p>Good Hacking!</p><p><a href=https://github.com/kydos/><strong>A+</strong></a></p><div class=ato-next><b>Next up</b>: <a href=../../blog/2020-10-08-aithusa/>Zenoh Aithusa Hatched Out!</a></div></main></div></div><footer class="ato-footer text-muted"><div class="container-fluid p-6 p-md-5"><div class=row><div class=col-md-2><h5>Eclipse Incubation</h5><p><img src=../../img/eclipse-incubation.png style=width:100px></p><p>Eclipse zenoh &trade; is an incubating project under the Eclipse Foundation.</p></div><div class=col-md-2><h5>More Information</h5><p><a href=https://www.eclipse.org/legal target=_blank>Legal</a></p><p><a href=https://www.eclipse.org/legal/privacy.php target=_blank>Privacy policy</a></p><p><a href=https://www.eclipse.org/legal/termsofuse.php target=_blank>Terms of use</a></p><p><a href=https://www.eclipse.org/legal/copyright.php target=_blank>Copyright</a></p><p><a href=https://www.eclipse.org/security/ target=_blank>Report a security issue</a></p><p><a href=https://www.eclipse.org/legal/epl-2.0/ target=_blank>Eclipse Public License 2.0</a></p><p><a href=https://www.apache.org/licenses/LICENSE-2.0 target=_blank>Apache License 2.0</a></p><p><a href=https://www.eclipse.org/ target=_blank>Eclipse Foundation</a></p></div><div class=col-md-2><h5>Sponsored by:</h5><p><a href=https://www.eclipse.org target=_blank><img src=../../img/eclipse-foundation.svg style=width:120px></a></p><p><a href=https://zettascale.tech target=_blank><img src=../../img/zettascale-dark.svg style=width:120px></a></p></div><div class=col-md-2><h5>Follow us</h5><p><a href=https://github.com/eclipse-zenoh/zenoh><i class="fa fa-github" aria-hidden=true></i>
GitHub</a></p><p><a href=https://discord.gg/vSDSpqnbkm><i class="fa fa fa-comments-o" aria-hidden=true></i>
Discord</a></p><p><a href=https://www.youtube.com/channel/UCslbiyiqgOAPMjCrPWIfQ5Q><i class="fa fa-youtube-play" aria-hidden=true></i> Youtube</a></p><p><a href=../../docs/overview/what-is-zenoh><i class="fa fa-info-circle" aria-hidden=true></i> About</a></p></div><div class=col-md-2><p><img src=../../img/zenoh-dragon-150x163.png style=width:45px></p><p>Eclipse zenoh &trade; is free, open source and always will be.</p><p>Copyright &copy 2022 Eclipse Foundation</p><p>Built with <a href=https://gohugo.io/ target=_blank>HUGO</a></p></div></div></div></footer><script src=https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js integrity=sha384-3ceskX3iaEnIogmQchP8opvBy3Mi7Ce34nWjpBIwVTHfGYWQS9jwHDVRnpKKHJg7 crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/tether/1.3.7/js/tether.min.js integrity=sha384-XTs3FgkjiBgo8qjEjBk0tGmf3wPrWtA6coPfQDfFEY8AnYJwjalXCiosYRBIBZX8 crossorigin=anonymous></script>
<script src=../../js/bootstrap.min.js></script>
<script src=../../js/highlight.min.js></script>
<script>$(function(){$("pre code").each(function(e,t){if(t.className.indexOf("language-rust")>=0){for(var s="",n=t.textContent.split(`
`),e=0;e<n.length;e++){if(n[e].indexOf("# ")==0||n[e]=="#")continue;s+=n[e].trimRight()+`
`}t.textContent=s.replace(/\n\n\n/g,`

`).trimRight()}hljs.highlightBlock(t)})})</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-PBD6MS51QL"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-PBD6MS51QL",{anonymize_ip:!1})}</script></body></html>