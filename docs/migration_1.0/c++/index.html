<!doctype html><html lang=en><head><link rel=apple-touch-icon sizes=180x180 href=../../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../../favicon-16x16.png><link rel=manifest href=../../../site.webmanifest><link rel=mask-icon href=../../../safari-pinned-tab.png><meta name=msapplication-TileImage content="/safari-pinned-tab.png"><meta name=msapplication-TileColor content="#7da7d8"><meta name=theme-color content="#7da7d8"><meta charset=utf-8><meta name=description content="Eclipse Zenoh, unify data in motion, data at rest and computations."><meta name=keywords content="pub/sub,query,geo distributed storage,Rust,protocol,DDS,MQTT,Edge,IoT,MEC"><meta name=author content="The Zenoh Team"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta http-equiv=x-ua-compatible content="ie=edge"><link rel=stylesheet href=../../../css/bootstrap-reboot.css><link rel=stylesheet href=../../../css/bootstrap.css><link rel=stylesheet href=../../../css/font-awesome.min.css><link rel=stylesheet href=../../../css/ato.css><link rel=stylesheet href=../../../css/syntax.css><link rel=alternate type=application/rss+xml href=../../../blog/index.xml><title>C++ · Zenoh - pub/sub, geo distributed storage, query</title></head><body><header class="navbar-expand navbar-dark d-flex flex-column flex-md-row align-items-md-center ato-navbar"><div class="d-flex flex-row justify-content-between pl-2 pr-2"><a class=navbar-brand href=../../../><img src=../../../img/zenoh-dragon-bg-150x163.png class=align-middle alt></a>
<button class="btn btn-link d-md-none p-0" type=button data-toggle=collapse data-target=#ato-nav aria-controls=ato-nav aria-expanded=false aria-label="Toggle navigation"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 30 30" width="30" height="30" focusable="false"><title>Menu</title><path stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-miterlimit="10" d="M4 7h22M4 15h22M4 23h22"/></svg></button></div><div class="ato-links collapse pl-4 pl-md-0" id=ato-nav><ul class="navbar-nav flex-column flex-md-row"><li class=nav-item><a class=nav-link href=../../../>Home</a></li><li class=nav-item><a class="nav-link active" href=../../../docs/getting-started/first-app/>Documentation</a></li><li class=nav-item><a class=nav-link href=../../../usecases/>Use Cases</a></li><li class=nav-item><a class=nav-link href=../../../community/>Community</a></li><li class=nav-item><a class=nav-link href=../../../adopters/>Adopters</a></li><li class=nav-item><a class=nav-link href=../../../media/>Media</a></li><li class=nav-item><a class=nav-link href=../../../blog/2024-04-30-zenoh-electrode/>Blog</a></li></ul></div><ul class="navbar-nav flex-row ml-md-auto d-none d-md-flex"><li class=nav-item><a class="nav-link p-2" href=https://github.com/eclipse-zenoh/zenoh target=_blank rel=noopener aria-label=GitHub><svg class="navbar-nav-svg" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 512 499.36" focusable="false"><title>GitHub</title><path d="M256 0C114.64.0.0 114.61.0 256c0 113.09 73.34 209 175.08 242.9 12.8 2.35 17.47-5.56 17.47-12.34.0-6.08-.22-22.18-.35-43.54-71.2 15.49-86.2-34.34-86.2-34.34-11.64-29.57-28.42-37.45-28.42-37.45-23.27-15.84 1.73-15.55 1.73-15.55 25.69 1.81 39.21 26.38 39.21 26.38 22.84 39.12 59.92 27.82 74.5 21.27 2.33-16.54 8.94-27.82 16.25-34.22-56.84-6.43-116.6-28.43-116.6-126.49.0-27.95 10-50.8 26.35-68.69-2.63-6.48-11.42-32.5 2.51-67.75.0.0 21.49-6.88 70.4 26.24a242.65 242.65.0 01128.18.0c48.87-33.13 70.33-26.24 70.33-26.24 14 35.25 5.18 61.27 2.55 67.75 16.41 17.9 26.31 40.75 26.31 68.69.0 98.35-59.85 120-116.88 126.32 9.19 7.9 17.38 23.53 17.38 47.41.0 34.22-.31 61.83-.31 70.23.0 6.85 4.61 14.81 17.6 12.31C438.72 464.97 512 369.08 512 256.02 512 114.62 397.37.0 256 0z" fill="currentcolor" fill-rule="evenodd"/></svg></a></li><li class=nav-item><a class="nav-link p-2" href=https://twitter.com/zettascaletech target=_blank rel=noopener aria-label=Twitter><svg class="navbar-nav-svg" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 512 416.32" focusable="false"><title>Twitter</title><path d="M160.83 416.32c193.2.0 298.92-160.22 298.92-298.92.0-4.51.0-9-.2-13.52A214 214 0 00512 49.38a212.93 212.93.0 01-60.44 16.6 105.7 105.7.0 0046.3-58.19 209 209 0 01-66.79 25.37 105.09 105.09.0 00-181.73 71.91 116.12 116.12.0 002.66 24c-87.28-4.3-164.73-46.3-216.56-109.82A105.48 105.48.0 0068 159.6a106.27 106.27.0 01-47.53-13.11v1.43a105.28 105.28.0 0084.21 103.06 105.67 105.67.0 01-47.33 1.84 105.06 105.06.0 0098.14 72.94A210.72 210.72.0 0125 370.84a202.17 202.17.0 01-25-1.43 298.85 298.85.0 00160.83 46.92" fill="currentcolor"/></svg></a></li><li class=nav-item><a class="nav-link p-2" href=https://discord.gg/2GJ958VuHs target=_blank rel=noopener aria-label=Discord><svg class="navbar-nav-svg" xmlns="http://www.w3.org/2000/svg" focusable="false"><title>Discord</title><path fill="currentcolor" d="M13.545 2.907a13.227 13.227.0 00-3.257-1.011.05.05.0 00-.052.025c-.141.25-.297.577-.406.833a12.19 12.19.0 00-3.658.0 8.258 8.258.0 00-.412-.833.051.051.0 00-.052-.025c-1.125.194-2.22.534-3.257 1.011a.041.041.0 00-.021.018C.356 6.024-.213 9.047.066 12.032c.001.014.01.028.021.037a13.276 13.276.0 003.995 2.02.05.05.0 00.056-.019c.308-.42.582-.863.818-1.329a.05.05.0 00-.01-.059.051.051.0 00-.018-.011 8.875 8.875.0 01-1.248-.595.05.05.0 01-.02-.066.051.051.0 01.015-.019c.084-.063.168-.129.248-.195a.05.05.0 01.051-.007c2.619 1.196 5.454 1.196 8.041.0a.052.052.0 01.053.007c.08.066.164.132.248.195a.051.051.0 01-.004.085 8.254 8.254.0 01-1.249.594.05.05.0 00-.03.03.052.052.0 00.003.041c.24.465.515.909.817 1.329a.05.05.0 00.056.019 13.235 13.235.0 004.001-2.02.049.049.0 00.021-.037c.334-3.451-.559-6.449-2.366-9.106a.034.034.0 00-.02-.019zm-8.198 7.307c-.789.0-1.438-.724-1.438-1.612.0-.889.637-1.613 1.438-1.613.807.0 1.45.73 1.438 1.613.0.888-.637 1.612-1.438 1.612zm5.316.0c-.788.0-1.438-.724-1.438-1.612.0-.889.637-1.613 1.438-1.613.807.0 1.451.73 1.438 1.613.0.888-.631 1.612-1.438 1.612z"/></svg></a></li><li class=nav-item><a class="nav-link p-2" href=https://www.youtube.com/channel/UCslbiyiqgOAPMjCrPWIfQ5Q target=_blank rel=noopener aria-label=Youtube><svg class="navbar-nav-svg" xmlns="http://www.w3.org/2000/svg" focusable="false"><title>Youtube</title><path fill="currentcolor" d="M8.051 1.999h.089c.822.003 4.987.033 6.11.335a2.01 2.01.0 011.415 1.42c.101.38.172.883.22 1.402l.01.104.022.26.008.104c.065.914.073 1.77.074 1.957v.075c-.001.194-.01 1.108-.082 2.06l-.008.105-.009.104c-.05.572-.124 1.14-.235 1.558a2.007 2.007.0 01-1.415 1.42c-1.16.312-5.569.334-6.18.335h-.142c-.309.0-1.587-.006-2.927-.052l-.17-.006-.087-.004-.171-.007-.171-.007c-1.11-.049-2.167-.128-2.654-.26a2.007 2.007.0 01-1.415-1.419c-.111-.417-.185-.986-.235-1.558L.09 9.82.082 9.716A31.4 31.4.0 010 7.68v-.123c.002-.215.01-.958.064-1.778l.007-.103.003-.052.008-.104.022-.26.01-.104c.048-.519.119-1.023.22-1.402a2.007 2.007.0 011.415-1.42c.487-.13 1.544-.21 2.654-.26l.17-.007.172-.006.086-.003.171-.007A99.788 99.788.0 017.858 2h.193zM6.4 5.209v4.818l4.157-2.408L6.4 5.209z"/></svg></a></li></ul><script async src="https://www.googletagmanager.com/gtag/js?id=G-PBD6MS51QL"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-PBD6MS51QL")</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":""},"articleSection":"docs","name":"C\u002b\u002b","headline":"C\u002b\u002b","datePublished":"0001-01-01 00:00:00 \u002b0000 UTC","dateModified":"0001-01-01 00:00:00 \u002b0000 UTC","url":"\/docs\/migration_1.0\/c\u002b\u002b\/","inLanguage":"en-US","author":"","creator":"","publisher":"","accountablePerson":"","copyrightHolder":"","copyrightYear":"1011","wordCount":"1526","keywords":[],"description":"Zenoh 1.0.0 brings a number of changes to the API, with a concentrated effort to bring the C\u002b\u002b API to more closely resemble the Rust API in usage.\nThe improvements we bring in this update include:\nA simpler organization of the Zenoh classes, abstracting away the notion of View and Closure. Improved and more flexible Error Handling through error codes and exceptions. Support for serialization of common types like strings, numbers, vectors through Codecs."}</script></header><div class="container-fluid ato-docs"><div class="row flex-xl-nowrap"><div class="col-12 col-md-3 col-xl-2 ato-sidebar"><div class="ato-search d-flex justify-content-end"><button class="btn btn-link ato-search-docs-toggle d-md-none p-0 ml-3" type=button data-toggle=collapse data-target=#ato-docs-nav aria-controls=ato-docs-nav aria-expanded=false aria-label="Toggle docs navigation"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 30 30" width="30" height="30" focusable="false"><title>Menu</title><path stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-miterlimit="10" d="M4 7h22M4 15h22M4 23h22"/></svg></button></div><nav class="ato-links collapse" id=ato-docs-nav><div class=ato-toc-item><a class=ato-toc-link href=../../../docs/overview/what-is-zenoh/>Overview</a><ul class="nav ato-sidenav"><li><a href=../../../docs/overview/what-is-zenoh/>What is Zenoh?</a></li><li><a href=../../../docs/overview/zenoh-in-action/>Zenoh in action</a></li></ul></div><div class=ato-toc-item><a class=ato-toc-link href=../../../docs/getting-started/first-app/>Getting started</a><ul class="nav ato-sidenav"><li><a href=../../../docs/getting-started/first-app/>Your first Zenoh app</a></li><li><a href=../../../docs/getting-started/installation/>Installation</a></li><li><a href=../../../docs/getting-started/deployment/>Deployment</a></li><li><a href=../../../docs/getting-started/quick-test/>For a quick test using Docker</a></li><li><a href=../../../docs/getting-started/troubleshooting/>Troubleshooting</a></li></ul></div><div class=ato-toc-item><a class=ato-toc-link href=../../../docs/manual/abstractions/>Reference manual</a><ul class="nav ato-sidenav"><li><a href=../../../docs/manual/abstractions/>Abstractions</a></li><li><a href=../../../docs/manual/configuration/>Configuration</a></li><li><a href=../../../docs/manual/plugins/>Zenoh plugins</a></li><li><a href=../../../docs/manual/plugin-http/>REST plugin</a></li><li><a href=../../../docs/manual/plugin-storage-manager/>Storage manager plugin</a></li><li><a href=../../../docs/manual/tls/>TLS authentication</a></li><li><a href=../../../docs/manual/quic/>QUIC transport</a></li><li><a href=../../../docs/manual/user-password/>User-Password authentication</a></li></ul></div><div class=ato-toc-item><a class=ato-toc-link href=../../../docs/apis/rust/>API</a><ul class="nav ato-sidenav"><li><a href=../../../docs/apis/rust/>Rust API</a></li><li><a href=../../../docs/apis/c/>C API</a></li><li><a href=../../../docs/apis/cpp/>C++ API</a></li><li><a href=../../../docs/apis/python/>Python API</a></li><li><a href=../../../docs/apis/rest/>REST API</a></li><li><a href=../../../docs/apis/kotlin/>Kotlin API</a></li></ul></div><div class=ato-toc-item><a class=ato-toc-link href=../../../docs/migration_0.5_to_0.6/migrationguide-v0.5.x-v0.6.x/>Migration guides v0.5.x → v0.6.x</a><ul class="nav ato-sidenav"><li><a href=../../../docs/migration_0.5_to_0.6/migrationguide-v0.5.x-v0.6.x/>Migrating from Zenoh v0.5.x to Zenoh v0.6.x</a></li><li><a href=../../../docs/migration_0.5_to_0.6/migrationguide-rust-v0.5.x-v0.6.x/>Migrating from Zenoh v0.5.x Rust API to Zenoh v0.6.x Rust API</a></li><li><a href=../../../docs/migration_0.5_to_0.6/migrationguide-c-v0.5.x-v0.6.x/>Migrating from Zenoh-C v0.5.x zenoh-net API to Zenoh-C v0.6.x zenoh API</a></li><li><a href=../../../docs/migration_0.5_to_0.6/migrationguide-python-v0.5.x-v0.6.x/>Migrating from Zenoh v0.5.x Python API to Zenoh v0.6.x Python API</a></li><li><a href=../../../docs/migration_0.5_to_0.6/migrationguide-pico-v0.5.x-v0.6.x/>Migrating from Zenoh-Pico v0.5.x to Zenoh-Pico v0.6.x</a></li><li><a href=../../../docs/migration_0.5_to_0.6/migrationguide-zenohc-zenohpico/>Migrating from Zenoh-C to Zenoh-Pico (and vice-versa)</a></li></ul></div><div class="ato-toc-item active"><a class=ato-toc-link href=../../../docs/migration_1.0/concepts/>Migration guides v0.11 → v1.0</a><ul class="nav ato-sidenav"><li><a href=../../../docs/migration_1.0/concepts/>Concepts</a></li><li><a href=../../../docs/migration_1.0/rust/>Rust</a></li><li><a href=../../../docs/migration_1.0/c++/ class=active>C++</a></li><li><a href=../../../docs/migration_1.0/c_pico/>C / Pico</a></li><li><a href=../../../docs/migration_1.0/python/>Python</a></li><li><a href=../../../docs/migration_1.0/java/>Java</a></li><li><a href=../../../docs/migration_1.0/kotlin/>Kotlin</a></li></ul></div></nav></div><div class="d-none d-xl-block col-xl-2 ato-toc"><div class=section-nav><nav id=TableOfContents><ul><li><a href=#error-handling>Error Handling</a></li><li><a href=#serialization--and-deserialization>Serialization and Deserialization</a></li><li><a href=#stream-handlers-and-callbacks>Stream Handlers and Callbacks</a></li><li><a href=#attachment>Attachment</a></li></ul></nav></div></div><main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 ato-content ato-docs"><h1 class=ato-title>C++</h1><div class=github-edit><a class="fa fa-github" href=https://github.com/atolab/zenoh-web/tree/master/content/docs/migration_1.0/C++.md>Edit on GitHub</a></div><p>Zenoh 1.0.0 brings a number of changes to the API, with a concentrated effort to bring the C++ API to more closely resemble the Rust API in usage.</p><p>The improvements we bring in this update include:</p><ul><li>A simpler organization of the Zenoh classes, abstracting away the notion of View and Closure.</li><li>Improved and more flexible Error Handling through error codes and exceptions.</li><li>Support for serialization of common types like strings, numbers, vectors through Codecs.</li><li>Ability for users to define their own Codecs (for their own types or to overwrite the default one)!</li><li>Improved stream handlers and callback support.</li><li>Simpler attachment API.</li></ul><p>Now that the <em>amuse bouche</em> is served, let&rsquo;s get into the main course!</p><h2 id=error-handling>Error Handling</h2><p>In version 0.11.0 all Zenoh call failures were handled by either returning a <code>bool</code> value indicating success or failure (and probably returning an error code) or returning an <code>std::variant&lt;ReturnType, ErrorMessage></code>. For instance:</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span>std<span style=color:#555>::</span>variant<span style=color:#555>&lt;</span>z<span style=color:#555>::</span>Config, ErrorMessage<span style=color:#555>&gt;</span> config_client(<span style=color:#069;font-weight:700>const</span> z<span style=color:#555>::</span>StrArrayView<span style=color:#555>&amp;</span> peers);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#078;font-weight:700>bool</span> <span style=color:#c0f>put</span>(<span style=color:#069;font-weight:700>const</span> z<span style=color:#555>::</span>BytesView<span style=color:#555>&amp;</span> payload, <span style=color:#069;font-weight:700>const</span> z<span style=color:#555>::</span>PublisherPutOptions<span style=color:#555>&amp;</span> options, ErrNo<span style=color:#555>&amp;</span> error);
</span></span></code></pre></div><p>In 1.0.0, all functions that can fail on the Zenoh side now offer 2 options for error handling:</p><p><strong>A</strong>. Exceptions</p><p><strong>B</strong>. Error Codes</p><p>Any function that can fail now accepts an optional parameter <code>ZError* err</code> pointer to the error code. If it is not provided (or set to <code>nullptr</code>), an instance of <code>ZException</code> will be thrown, otherwise the error code will be written into the <code>err</code> pointer.</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#069;font-weight:700>static</span> Config <span style=color:#c0f>client</span>(<span style=color:#069;font-weight:700>const</span> std<span style=color:#555>::</span>vector<span style=color:#555>&lt;</span>std<span style=color:#555>::</span>string<span style=color:#555>&gt;&amp;</span> peers, ZError<span style=color:#555>*</span> err <span style=color:#555>=</span> <span style=color:#069;font-weight:700>nullptr</span>);
</span></span></code></pre></div><p>This also applies to constructors: if a failure occurs, either an exception is thrown or the error code is written to the provided pointer. In the latter case, the returned object will be in an &ldquo;empty&rdquo; state (i.e. converting it to a boolean returns <code>false</code>).</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span>Config config <span style=color:#555>=</span> Config<span style=color:#555>::</span>create_default();
</span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>// Receiving an error code
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span>Zerror err <span style=color:#555>=</span> Z_OK;
</span></span><span style=display:flex><span><span style=color:#069;font-weight:700>auto</span> session <span style=color:#555>=</span> Session<span style=color:#555>::</span>open(std<span style=color:#555>::</span>move(config), <span style=color:#555>&amp;</span>err);
</span></span><span style=display:flex><span><span style=color:#069;font-weight:700>if</span> (err <span style=color:#555>!=</span> Z_OK) { <span style=color:#09f;font-style:italic>// or alternatively if (!session)
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span>  <span style=color:#09f;font-style:italic>// handle failure
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>// Catching exception
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span>Zenoh<span style=color:#555>::</span>session s(<span style=color:#069;font-weight:700>nullptr</span>); <span style=color:#09f;font-style:italic>// Empty session object
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span><span style=color:#069;font-weight:700>try</span> {
</span></span><span style=display:flex><span>  s <span style=color:#555>=</span> Session<span style=color:#555>::</span>open(std<span style=color:#555>::</span>move(config), <span style=color:#555>&amp;</span>err);
</span></span><span style=display:flex><span>} <span style=color:#069;font-weight:700>catch</span> (<span style=color:#069;font-weight:700>const</span> ZException<span style=color:#555>&amp;</span> e) {
</span></span><span style=display:flex><span>  <span style=color:#09f;font-style:italic>// handle failure
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span>}
</span></span></code></pre></div><p>All returned and <code>std::move</code>&rsquo;d-in objects are guaranteed to be left in an “empty” state in case of function call failure.</p><h2 id=serialization--and-deserialization>Serialization and Deserialization</h2><p>In version 0.11.0 it was only possible to send <code>std::string</code>/ <code>const char*</code> or <code>std::vector&lt;uint8_t></code> / <code>uint8_t*</code> using the <code>BytesView</code> class:</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span>publisher.put(<span style=color:#c30>&#34;my_payload&#34;</span>);
</span></span></code></pre></div><p>In 1.0.0, the <code>BytesView</code> class is gone and we introduced the <code>Bytes</code> object which represents a serialized payload.</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#078;font-weight:700>void</span> <span style=color:#c0f>publish_data</span>(<span style=color:#069;font-weight:700>const</span> Publisher<span style=color:#555>&amp;</span> publisher, <span style=color:#069;font-weight:700>const</span> MyData<span style=color:#555>&amp;</span> data) {
</span></span><span style=display:flex><span>	publisher.put(Bytes<span style=color:#555>&lt;</span>MyCodec<span style=color:#555>&gt;::</span>serialize(data));
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#078;font-weight:700>void</span> <span style=color:#c0f>receive_data</span>(<span style=color:#069;font-weight:700>const</span> Sample <span style=color:#555>&amp;</span>sample) {
</span></span><span style=display:flex><span>  std<span style=color:#555>::</span>cout <span style=color:#555>&lt;&lt;</span><span style=color:#c30>&#34;Received: &#34;</span> 
</span></span><span style=display:flex><span>					  <span style=color:#555>&lt;&lt;</span> sample.get_payload().deserialize<span style=color:#555>&lt;</span>MyData, MyCodec<span style=color:#555>&gt;</span>() 
</span></span><span style=display:flex><span>            <span style=color:#555>&lt;&lt;</span> <span style=color:#c30>&#34;</span><span style=color:#c30;font-weight:700>\n</span><span style=color:#c30>&#34;</span>;
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><p>We added a default <code>ZenohCodec</code>, which provides default serialization / deserialization for common numerical types, strings, and containers:</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span>  <span style=color:#09f;font-style:italic>// stream of bytes serialization
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span>  std<span style=color:#555>::</span>vector<span style=color:#555>&lt;</span><span style=color:#078;font-weight:700>uint8_t</span><span style=color:#555>&gt;</span> data <span style=color:#555>=</span> {<span style=color:#f60>0</span>, <span style=color:#f60>1</span>, <span style=color:#f60>2</span>, <span style=color:#f60>3</span>, <span style=color:#f60>4</span>, <span style=color:#f60>5</span>, <span style=color:#f60>6</span>, <span style=color:#f60>7</span>, <span style=color:#f60>8</span>, <span style=color:#f60>9</span>};
</span></span><span style=display:flex><span>  Bytes b <span style=color:#555>=</span> Bytes<span style=color:#555>::</span>serialize(data);
</span></span><span style=display:flex><span>  assert(b.deserialize<span style=color:#555>&lt;</span>std<span style=color:#555>::</span>vector<span style=color:#555>&lt;</span><span style=color:#078;font-weight:700>uint8_t</span><span style=color:#555>&gt;&gt;</span>() <span style=color:#555>==</span> data);
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#09f;font-style:italic>// arithmetic type serialization
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span>  <span style=color:#078;font-weight:700>double</span> pi <span style=color:#555>=</span> <span style=color:#f60>3.1415926</span>;
</span></span><span style=display:flex><span>  Bytes b <span style=color:#555>=</span> Bytes<span style=color:#555>::</span>serialize(pi);
</span></span><span style=display:flex><span>  assert(b.deserialize<span style=color:#555>&lt;</span>TYPE<span style=color:#555>&gt;</span>() <span style=color:#555>==</span> pi);
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#09f;font-style:italic>// Composite types serialization
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span>  std<span style=color:#555>::</span>vector<span style=color:#555>&lt;</span><span style=color:#078;font-weight:700>float</span><span style=color:#555>&gt;</span> v <span style=color:#555>=</span> {<span style=color:#f60>0.1f</span>, <span style=color:#f60>.2f</span>, <span style=color:#f60>0.3f</span>};
</span></span><span style=display:flex><span>  <span style=color:#069;font-weight:700>auto</span> b <span style=color:#555>=</span> Bytes<span style=color:#555>::</span>serialize(v);
</span></span><span style=display:flex><span>  assert(b.deserialize<span style=color:#555>&lt;</span><span style=color:#069;font-weight:700>decltype</span>(v)<span style=color:#555>&gt;</span>() <span style=color:#555>==</span> v);
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  std<span style=color:#555>::</span>map<span style=color:#555>&lt;</span>std<span style=color:#555>::</span>string, std<span style=color:#555>::</span>deque<span style=color:#555>&lt;</span><span style=color:#078;font-weight:700>double</span><span style=color:#555>&gt;&gt;</span> m <span style=color:#555>=</span> {
</span></span><span style=display:flex><span>    {<span style=color:#c30>&#34;a&#34;</span>, {<span style=color:#f60>0.5</span>, <span style=color:#f60>0.2</span>}},
</span></span><span style=display:flex><span>    {<span style=color:#c30>&#34;b&#34;</span>, {<span style=color:#555>-</span><span style=color:#f60>123.45</span>, <span style=color:#f60>0.4</span>}},
</span></span><span style=display:flex><span>    {<span style=color:#c30>&#34;abc&#34;</span>, {<span style=color:#f60>3.1415926</span>, <span style=color:#555>-</span><span style=color:#f60>1.0</span>} }
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  b <span style=color:#555>=</span> Bytes<span style=color:#555>::</span>serialize(m);
</span></span><span style=display:flex><span>  assert(b.deserialize<span style=color:#555>&lt;</span><span style=color:#069;font-weight:700>decltype</span>(m2)<span style=color:#555>&gt;</span>() <span style=color:#555>==</span> m); 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#09f;font-style:italic>// alternatively serialize via move 
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span>  <span style=color:#09f;font-style:italic>// the string keys will not be copied in this case, but rather move into Bytes
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span>  b_move <span style=color:#555>=</span> Bytes<span style=color:#555>::</span>serialize(std<span style=color:#555>::</span>move(m));
</span></span></code></pre></div><p>Please note that this serialization functionality is only provided for prototyping and demonstration purposes and, as such, might be less efficient than custom-written serialization methods.</p><p>Users can easily define their own serialization/deserialization functions by providing a custom codec:</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span>MyType <span style=color:#c0f>my_data</span>(...);
</span></span><span style=display:flex><span>MyCodec <span style=color:#c0f>my_codec</span>(...);
</span></span><span style=display:flex><span>Bytes b <span style=color:#555>=</span> Bytes<span style=color:#555>::</span>serialize(my_data, my_codec);
</span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>// or Bytes::serialize&lt;MyCodec&gt;(my_data) if MyCodec is a stateless codec with an empty constructor 
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span>assert(b.deserialize<span style=color:#555>&lt;</span>std<span style=color:#555>::</span>vector<span style=color:#555>&lt;</span>MyType<span style=color:#555>&gt;&gt;</span>(my_codec) <span style=color:#555>==</span> my_data);
</span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>// or assert(b.deserialize&lt;std::vector&lt;MyType, MyCodec&gt;&gt;() == my_data); if MyCodec is a stateless with an empty constructor
</span></span></span></code></pre></div><p>For finer control on serialization / deserialization implementation <code>Bytes::Iterator</code>, <code>Bytes::Writer</code> and <code>Bytes::Reader</code> classes are also introduced.</p><p>A working example with custom-defined serialization / deserialization can be found here:</p><p><a href=https://github.com/eclipse-zenoh/zenoh-cpp/blob/dev/1.0.0/examples/simple/universal/z_simple.cxx>https://github.com/eclipse-zenoh/zenoh-cpp/blob/dev/1.0.0/examples/simple/universal/z_simple.cxx</a></p><h2 id=stream-handlers-and-callbacks>Stream Handlers and Callbacks</h2><p>In version 0.11.0 stream handlers were only supported for <code>get</code> :</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#09f;font-style:italic>// callback
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span>session.get(keyexpr, <span style=color:#c30>&#34;&#34;</span>, {on_reply, on_done}, opts);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>// stream handlers interface
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span><span style=color:#069;font-weight:700>auto</span> [send, recv] <span style=color:#555>=</span> reply_fifo_new(<span style=color:#f60>16</span>);
</span></span><span style=display:flex><span>session.get(keyexpr, <span style=color:#c30>&#34;&#34;</span>, std<span style=color:#555>::</span>move(send), opts);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Reply <span style=color:#c0f>reply</span>(<span style=color:#069;font-weight:700>nullptr</span>);
</span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>// blocking
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span><span style=color:#069;font-weight:700>for</span> (recv(reply); reply.check(); recv(reply)) {
</span></span><span style=display:flex><span>    <span style=color:#069;font-weight:700>auto</span> sample <span style=color:#555>=</span> expect<span style=color:#555>&lt;</span>Sample<span style=color:#555>&gt;</span>(reply.get());
</span></span><span style=display:flex><span>    std<span style=color:#555>::</span>cout <span style=color:#555>&lt;&lt;</span> <span style=color:#c30>&#34;Received (&#39;&#34;</span> <span style=color:#555>&lt;&lt;</span> sample.get_keyexpr().as_string_view() <span style=color:#555>&lt;&lt;</span> <span style=color:#c30>&#34;&#39; : &#39;&#34;</span>
</span></span><span style=display:flex><span>              <span style=color:#555>&lt;&lt;</span> sample.get_payload().as_string_view() <span style=color:#555>&lt;&lt;</span> <span style=color:#c30>&#34;&#39;)</span><span style=color:#c30;font-weight:700>\n</span><span style=color:#c30>&#34;</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>// non-blocking
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span><span style=color:#069;font-weight:700>for</span> (<span style=color:#078;font-weight:700>bool</span> call_success <span style=color:#555>=</span> recv(reply); <span style=color:#555>!</span>call_success <span style=color:#555>||</span> reply.check(); call_success <span style=color:#555>=</span> recv(reply)) {
</span></span><span style=display:flex><span>  <span style=color:#069;font-weight:700>if</span> (<span style=color:#555>!</span>call_success) {
</span></span><span style=display:flex><span>    std<span style=color:#555>::</span>cout <span style=color:#555>&lt;&lt;</span> <span style=color:#c30>&#34;.&#34;</span>;
</span></span><span style=display:flex><span>    Sleep(<span style=color:#f60>1</span>);
</span></span><span style=display:flex><span>    <span style=color:#069;font-weight:700>continue</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#069;font-weight:700>auto</span> sample <span style=color:#555>=</span> expect<span style=color:#555>&lt;</span>Sample<span style=color:#555>&gt;</span>(reply.get());
</span></span><span style=display:flex><span>  std<span style=color:#555>::</span>cout <span style=color:#555>&lt;&lt;</span> <span style=color:#c30>&#34;</span><span style=color:#c30;font-weight:700>\n</span><span style=color:#c30>Received (&#39;&#34;</span> <span style=color:#555>&lt;&lt;</span> sample.get_keyexpr().as_string_view() <span style=color:#555>&lt;&lt;</span> <span style=color:#c30>&#34;&#39; : &#39;&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#555>&lt;&lt;</span> sample.get_payload().as_string_view() <span style=color:#555>&lt;&lt;</span> <span style=color:#c30>&#34;&#39;)&#34;</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>In 1.0.0, <code>Subscriber</code>, <code>Queryable</code> and <code>get</code> can now use either a callable object or a stream handler. Currently, Zenoh provides 2 types of handlers:</p><ul><li><code>FifoHandler</code> - serving messages in Fifo order, <em>blocking</em> once full.</li><li><code>RingHandler</code> - serving messages in Fifo order, <em>dropping older messages</em> once full to make room for new ones.</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#09f;font-style:italic>// callback
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span>session.get(
</span></span><span style=display:flex><span>  keyexpr, <span style=color:#c30>&#34;&#34;</span>, on_reply, on_done,
</span></span><span style=display:flex><span>  {.target <span style=color:#555>=</span> Z_QUERY_TARGET_ALL}
</span></span><span style=display:flex><span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>// stream handlers interface
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span><span style=color:#069;font-weight:700>auto</span> replies <span style=color:#555>=</span> session.get(
</span></span><span style=display:flex><span>  keyexpr, <span style=color:#c30>&#34;&#34;</span>, channels<span style=color:#555>::</span>FifoChannel(<span style=color:#f60>16</span>), 
</span></span><span style=display:flex><span>  {.target <span style=color:#555>=</span> QueryTarget<span style=color:#555>::</span>Z_QUERY_TARGET_ALL}
</span></span><span style=display:flex><span>);
</span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>// blocking
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span><span style=color:#069;font-weight:700>for</span> (<span style=color:#069;font-weight:700>auto</span> res <span style=color:#555>=</span> replies.recv(); std<span style=color:#555>::</span>has_alternative<span style=color:#555>&lt;</span>Reply<span style=color:#555>&gt;</span>(res); res <span style=color:#555>=</span> replies.recv()) {
</span></span><span style=display:flex><span>  <span style=color:#069;font-weight:700>const</span> <span style=color:#069;font-weight:700>auto</span><span style=color:#555>&amp;</span> sample <span style=color:#555>=</span> std<span style=color:#555>::</span>get<span style=color:#555>&lt;</span>Reply<span style=color:#555>&gt;</span>(res).get_ok();
</span></span><span style=display:flex><span>  std<span style=color:#555>::</span>cout <span style=color:#555>&lt;&lt;</span> <span style=color:#c30>&#34;Received (&#39;&#34;</span> <span style=color:#555>&lt;&lt;</span> sample.get_keyexpr().as_string_view() <span style=color:#555>&lt;&lt;</span> <span style=color:#c30>&#34;&#39; : &#39;&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#555>&lt;&lt;</span> sample.get_payload().deserialize<span style=color:#555>&lt;</span>std<span style=color:#555>::</span>string<span style=color:#555>&gt;</span>() <span style=color:#555>&lt;&lt;</span> <span style=color:#c30>&#34;&#39;)</span><span style=color:#c30;font-weight:700>\n</span><span style=color:#c30>&#34;</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>// non-blocking
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span><span style=color:#069;font-weight:700>while</span> (<span style=color:#366>true</span>) {
</span></span><span style=display:flex><span>  <span style=color:#069;font-weight:700>auto</span> res <span style=color:#555>=</span> replies.try_recv();
</span></span><span style=display:flex><span>  <span style=color:#069;font-weight:700>if</span> (std<span style=color:#555>::</span>has_alternative<span style=color:#555>&lt;</span>Reply<span style=color:#555>&gt;</span>(res)) {
</span></span><span style=display:flex><span>    <span style=color:#069;font-weight:700>const</span> <span style=color:#069;font-weight:700>auto</span><span style=color:#555>&amp;</span> sample <span style=color:#555>=</span> std<span style=color:#555>::</span>get<span style=color:#555>&lt;</span>Reply<span style=color:#555>&gt;</span>(res).get_ok();
</span></span><span style=display:flex><span>	  std<span style=color:#555>::</span>cout <span style=color:#555>&lt;&lt;</span> <span style=color:#c30>&#34;Received (&#39;&#34;</span> <span style=color:#555>&lt;&lt;</span> sample.get_keyexpr().as_string_view() <span style=color:#555>&lt;&lt;</span> <span style=color:#c30>&#34;&#39; : &#39;&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#555>&lt;&lt;</span> sample.get_payload().deserialize<span style=color:#555>&lt;</span>std<span style=color:#555>::</span>string<span style=color:#555>&gt;</span>() <span style=color:#555>&lt;&lt;</span> <span style=color:#c30>&#34;&#39;)</span><span style=color:#c30;font-weight:700>\n</span><span style=color:#c30>&#34;</span>;
</span></span><span style=display:flex><span>  } <span style=color:#069;font-weight:700>else</span> <span style=color:#c0f>if</span> (std<span style=color:#555>::</span>get<span style=color:#555>&lt;</span>channels<span style=color:#555>::</span>RecvError<span style=color:#555>&gt;</span>(res) <span style=color:#555>==</span> channels<span style=color:#555>::</span>RecvError<span style=color:#555>::</span>Z_NODATA) {
</span></span><span style=display:flex><span>	  <span style=color:#09f;font-style:italic>// try_recv is non-blocking call, so may fail to return a reply if the Fifo buffer is empty
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span>	  std<span style=color:#555>::</span>cout <span style=color:#555>&lt;&lt;</span> <span style=color:#c30>&#34;.&#34;</span>;
</span></span><span style=display:flex><span>    std<span style=color:#555>::</span>this_thread<span style=color:#555>::</span>sleep_for(<span style=color:#f60>1</span>s);
</span></span><span style=display:flex><span>    <span style=color:#069;font-weight:700>continue</span>;
</span></span><span style=display:flex><span>  } <span style=color:#069;font-weight:700>else</span> { <span style=color:#09f;font-style:italic>// std::get&lt;channels::RecvError&gt;(res) == channels::RecvError::Z_DISCONNECTED
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span>	  <span style=color:#069;font-weight:700>break</span>; <span style=color:#09f;font-style:italic>// no more replies will arrive
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>std<span style=color:#555>::</span>cout <span style=color:#555>&lt;&lt;</span> std<span style=color:#555>::</span>endl;
</span></span><span style=display:flex><span>  
</span></span></code></pre></div><p>The same works for <code>Subscriber</code> and <code>Queryable</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#09f;font-style:italic>// callback
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span><span style=color:#069;font-weight:700>auto</span> data_callback <span style=color:#555>=</span> [](<span style=color:#069;font-weight:700>const</span> Sample <span style=color:#555>&amp;</span>sample) {
</span></span><span style=display:flex><span>  std<span style=color:#555>::</span>cout <span style=color:#555>&lt;&lt;</span> <span style=color:#c30>&#34;&gt;&gt; [Subscriber] Received (&#39;&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#555>&lt;&lt;</span> sample.get_keyexpr().as_string_view() 
</span></span><span style=display:flex><span>            <span style=color:#555>&lt;&lt;</span> <span style=color:#c30>&#34;&#39; : &#39;&#34;</span> <span style=color:#555>&lt;&lt;</span> sample.get_payload().deserialize<span style=color:#555>&lt;</span>std<span style=color:#555>::</span>string<span style=color:#555>&gt;</span>() 
</span></span><span style=display:flex><span>            <span style=color:#555>&lt;&lt;</span> <span style=color:#c30>&#34;&#39;)</span><span style=color:#c30;font-weight:700>\n</span><span style=color:#c30>&#34;</span>;
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#069;font-weight:700>auto</span> subscriber <span style=color:#555>=</span> session.declare_subscriber(
</span></span><span style=display:flex><span>  keyexpr, data_callback, closures<span style=color:#555>::</span>none <span style=color:#09f;font-style:italic>// or dedicated function to call when subscriber is undeclared
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span>);
</span></span><span style=display:flex><span>std<span style=color:#555>::</span>cout <span style=color:#555>&lt;&lt;</span> <span style=color:#c30>&#34;Press CTRL-C to quit...</span><span style=color:#c30;font-weight:700>\n</span><span style=color:#c30>&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#069;font-weight:700>while</span> (<span style=color:#366>true</span>) {
</span></span><span style=display:flex><span>  std<span style=color:#555>::</span>this_thread<span style=color:#555>::</span>sleep_for(<span style=color:#f60>1</span>s);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>// stream handlers interface
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span><span style=color:#069;font-weight:700>auto</span> subscriber <span style=color:#555>=</span> session.declare_subscriber(keyexpr, channels<span style=color:#555>::</span>FifoChannel(<span style=color:#f60>16</span>));
</span></span><span style=display:flex><span><span style=color:#069;font-weight:700>const</span> <span style=color:#069;font-weight:700>auto</span><span style=color:#555>&amp;</span> messages <span style=color:#555>=</span> subscriber.handler();
</span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>//blocking
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span><span style=color:#069;font-weight:700>for</span> (<span style=color:#069;font-weight:700>auto</span> res <span style=color:#555>=</span> messages.recv(); std<span style=color:#555>::</span>has_alternative<span style=color:#555>&lt;</span>Sample<span style=color:#555>&gt;</span>(res); res <span style=color:#555>=</span> messages.recv()) {
</span></span><span style=display:flex><span>		<span style=color:#09f;font-style:italic>// recv will block until there is at least one sample in the Fifo buffer
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span>		<span style=color:#09f;font-style:italic>// it will return an empty sample and alive=false once subscriber gets disconnected
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span>		<span style=color:#069;font-weight:700>const</span> Sample<span style=color:#555>&amp;</span> sample <span style=color:#555>=</span> std<span style=color:#555>::</span>get<span style=color:#555>&lt;</span>Sample<span style=color:#555>&gt;</span>(res);
</span></span><span style=display:flex><span>    std<span style=color:#555>::</span>cout <span style=color:#555>&lt;&lt;</span> <span style=color:#c30>&#34;Received (&#39;&#34;</span> <span style=color:#555>&lt;&lt;</span> sample.get_keyexpr().as_string_view() <span style=color:#555>&lt;&lt;</span> <span style=color:#c30>&#34;&#39; : &#39;&#34;</span>
</span></span><span style=display:flex><span>              <span style=color:#555>&lt;&lt;</span> sample.get_payload().deserialize<span style=color:#555>&lt;</span>std<span style=color:#555>::</span>string<span style=color:#555>&gt;</span>() <span style=color:#555>&lt;&lt;</span> <span style=color:#c30>&#34;&#39;)</span><span style=color:#c30;font-weight:700>\n</span><span style=color:#c30>&#34;</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>// non-blocking
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span><span style=color:#069;font-weight:700>while</span> (<span style=color:#366>true</span>) {
</span></span><span style=display:flex><span>  <span style=color:#069;font-weight:700>auto</span> res <span style=color:#555>=</span> messages.try_recv();
</span></span><span style=display:flex><span>  <span style=color:#069;font-weight:700>if</span> (std<span style=color:#555>::</span>has_alternative<span style=color:#555>&lt;</span>Sample<span style=color:#555>&gt;</span>(res)) {
</span></span><span style=display:flex><span>    <span style=color:#069;font-weight:700>const</span> <span style=color:#069;font-weight:700>auto</span><span style=color:#555>&amp;</span> sample <span style=color:#555>=</span> std<span style=color:#555>::</span>get<span style=color:#555>&lt;</span>Sample<span style=color:#555>&gt;</span>(res);
</span></span><span style=display:flex><span>	  std<span style=color:#555>::</span>cout <span style=color:#555>&lt;&lt;</span> <span style=color:#c30>&#34;Received (&#39;&#34;</span> <span style=color:#555>&lt;&lt;</span> sample.get_keyexpr().as_string_view() <span style=color:#555>&lt;&lt;</span> <span style=color:#c30>&#34;&#39; : &#39;&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#555>&lt;&lt;</span> sample.get_payload().deserialize<span style=color:#555>&lt;</span>std<span style=color:#555>::</span>string<span style=color:#555>&gt;</span>() <span style=color:#555>&lt;&lt;</span> <span style=color:#c30>&#34;&#39;)</span><span style=color:#c30;font-weight:700>\n</span><span style=color:#c30>&#34;</span>;
</span></span><span style=display:flex><span>  } <span style=color:#069;font-weight:700>else</span> <span style=color:#c0f>if</span> (std<span style=color:#555>::</span>get<span style=color:#555>&lt;</span>channels<span style=color:#555>::</span>RecvError<span style=color:#555>&gt;</span>(res) <span style=color:#555>==</span> channels<span style=color:#555>::</span>RecvError<span style=color:#555>::</span>Z_NODATA) {
</span></span><span style=display:flex><span>	  <span style=color:#09f;font-style:italic>// try_recv is non-blocking call, so may fail to return a sample if the Fifo buffer is empty
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span>	  std<span style=color:#555>::</span>cout <span style=color:#555>&lt;&lt;</span> <span style=color:#c30>&#34;.&#34;</span>;
</span></span><span style=display:flex><span>    std<span style=color:#555>::</span>this_thread<span style=color:#555>::</span>sleep_for(<span style=color:#f60>1</span>s);
</span></span><span style=display:flex><span>  } <span style=color:#069;font-weight:700>else</span> { <span style=color:#09f;font-style:italic>// std::get&lt;channels::RecvError&gt;(res) == channels::RecvError::Z_DISCONNECTED
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span>	  <span style=color:#069;font-weight:700>break</span>; <span style=color:#09f;font-style:italic>// no more samples will arrive
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>std<span style=color:#555>::</span>cout <span style=color:#555>&lt;&lt;</span> std<span style=color:#555>::</span>endl;
</span></span></code></pre></div><h2 id=attachment>Attachment</h2><p>In version 0.11.0 an attachment could only represent a set of key-value pairs and had a somewhat complicated interface:</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#09f;font-style:italic>// publish message with attachment
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span>options.set_encoding(Z_ENCODING_PREFIX_TEXT_PLAIN);
</span></span><span style=display:flex><span>std<span style=color:#555>::</span>unordered_map<span style=color:#555>&lt;</span>std<span style=color:#555>::</span>string, std<span style=color:#555>::</span>string<span style=color:#555>&gt;</span> attachment_map <span style=color:#555>=</span> {
</span></span><span style=display:flex><span>  {<span style=color:#c30>&#34;source&#34;</span>, <span style=color:#c30>&#34;C++&#34;</span>},
</span></span><span style=display:flex><span>  {<span style=color:#c30>&#34;index&#34;</span>, <span style=color:#c30>&#34;0&#34;</span>}
</span></span><span style=display:flex><span>};    
</span></span><span style=display:flex><span>options.set_attachment(attachment_map);
</span></span><span style=display:flex><span>pub.put(s, options);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>// subscriber callback function receiving message with attachment
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span>data_handler(<span style=color:#069;font-weight:700>const</span> Sample <span style=color:#555>&amp;</span>sample) {
</span></span><span style=display:flex><span>  std<span style=color:#555>::</span>cout <span style=color:#555>&lt;&lt;</span> <span style=color:#c30>&#34;&gt;&gt; [Subscriber] Received &#34;</span> (<span style=color:#a00;background-color:#faa>&#39;</span><span style=color:#c30>&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#555>&lt;&lt;</span> sample.get_keyexpr().as_string_view() 
</span></span><span style=display:flex><span>            <span style=color:#555>&lt;&lt;</span> <span style=color:#c30>&#34;&#39; : &#39;&#34;</span> 
</span></span><span style=display:flex><span>            <span style=color:#555>&lt;&lt;</span> sample.get_payload().as_string_view()
</span></span><span style=display:flex><span>		        <span style=color:#555>&lt;&lt;</span> <span style=color:#c30>&#34;&#39;)</span><span style=color:#c30;font-weight:700>\n</span><span style=color:#c30>&#34;</span>;
</span></span><span style=display:flex><span>  <span style=color:#069;font-weight:700>if</span> (sample.get_attachment().check()) {
</span></span><span style=display:flex><span>      <span style=color:#09f;font-style:italic>// reads full attachment
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span>      sample.get_attachment().iterate([](<span style=color:#069;font-weight:700>const</span> BytesView <span style=color:#555>&amp;</span>key, <span style=color:#069;font-weight:700>const</span> BytesView <span style=color:#555>&amp;</span>value) <span style=color:#555>-&gt;</span> <span style=color:#078;font-weight:700>bool</span> {
</span></span><span style=display:flex><span>          std<span style=color:#555>::</span>cout <span style=color:#555>&lt;&lt;</span> <span style=color:#c30>&#34;   attachment: &#34;</span> <span style=color:#555>&lt;&lt;</span> key.as_string_view() <span style=color:#555>&lt;&lt;</span> <span style=color:#c30>&#34;: &#39;&#34;</span> <span style=color:#555>&lt;&lt;</span> value.as_string_view() <span style=color:#555>&lt;&lt;</span> <span style=color:#c30>&#34;&#39;</span><span style=color:#c30;font-weight:700>\n</span><span style=color:#c30>&#34;</span>;
</span></span><span style=display:flex><span>          <span style=color:#069;font-weight:700>return</span> <span style=color:#366>true</span>;
</span></span><span style=display:flex><span>      });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#09f;font-style:italic>// or read particular attachment item
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span>      <span style=color:#069;font-weight:700>auto</span> index <span style=color:#555>=</span> sample.get_attachment().get(<span style=color:#c30>&#34;index&#34;</span>);
</span></span><span style=display:flex><span>      <span style=color:#069;font-weight:700>if</span> (index <span style=color:#555>!=</span> <span style=color:#c30>&#34;&#34;</span>) {
</span></span><span style=display:flex><span>          std<span style=color:#555>::</span>cout <span style=color:#555>&lt;&lt;</span> <span style=color:#c30>&#34;   message number: &#34;</span> <span style=color:#555>&lt;&lt;</span> index.as_string_view() <span style=color:#555>&lt;&lt;</span> std<span style=color:#555>::</span>endl;
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><p>In 1.0.0, attachment handling was greatly simplified. It is now represented as <code>Bytes</code> (i.e. the same class we use to represent serialized data) and can thus contain data in any format.</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span><span style=color:#09f;font-style:italic>// publish a message with attachment
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span><span style=color:#069;font-weight:700>auto</span> session <span style=color:#555>=</span> Session<span style=color:#555>::</span>open(std<span style=color:#555>::</span>move(config));
</span></span><span style=display:flex><span><span style=color:#069;font-weight:700>auto</span> pub <span style=color:#555>=</span> session.declare_publisher(KeyExpr(keyexpr));
</span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>// send some key-value pairs as attachment
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>// allocate attachment map
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span>std<span style=color:#555>::</span>unordered_map<span style=color:#555>&lt;</span>std<span style=color:#555>::</span>string, std<span style=color:#555>::</span>string<span style=color:#555>&gt;</span> attachment_map <span style=color:#555>=</span> {
</span></span><span style=display:flex><span>  {<span style=color:#c30>&#34;source&#34;</span>, <span style=color:#c30>&#34;C++&#34;</span>},
</span></span><span style=display:flex><span>  {<span style=color:#c30>&#34;index&#34;</span>, <span style=color:#c30>&#34;0&#34;</span>}
</span></span><span style=display:flex><span>};    
</span></span><span style=display:flex><span>pub.put(
</span></span><span style=display:flex><span>  Bytes<span style=color:#555>::</span>serialize(<span style=color:#c30>&#34;my_payload&#34;</span>), 
</span></span><span style=display:flex><span>  {.encoding <span style=color:#555>=</span> Encoding(<span style=color:#c30>&#34;text/plain&#34;</span>), .attachment <span style=color:#555>=</span> std<span style=color:#555>::</span>move(attachment_map)}
</span></span><span style=display:flex><span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>// subscriber callback function receiving a message with attachment
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span><span style=color:#078;font-weight:700>void</span> <span style=color:#c0f>data_handler</span>(<span style=color:#069;font-weight:700>const</span> Sample <span style=color:#555>&amp;</span>sample) {
</span></span><span style=display:flex><span>  std<span style=color:#555>::</span>cout <span style=color:#555>&lt;&lt;</span> <span style=color:#c30>&#34;&gt;&gt; [Subscriber] Received (&#39;&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#555>&lt;&lt;</span> sample.get_keyexpr().as_string_view() 
</span></span><span style=display:flex><span>            <span style=color:#555>&lt;&lt;</span> <span style=color:#c30>&#34;&#39; : &#39;&#34;</span> 
</span></span><span style=display:flex><span>            <span style=color:#555>&lt;&lt;</span> sample.get_payload().deserialize<span style=color:#555>&lt;</span>std<span style=color:#555>::</span>string<span style=color:#555>&gt;</span>()
</span></span><span style=display:flex><span>            <span style=color:#555>&lt;&lt;</span> <span style=color:#c30>&#34;&#39;)</span><span style=color:#c30;font-weight:700>\n</span><span style=color:#c30>&#34;</span>;
</span></span><span style=display:flex><span>  <span style=color:#069;font-weight:700>auto</span> attachment <span style=color:#555>=</span> sample.get_attachment();
</span></span><span style=display:flex><span>  <span style=color:#069;font-weight:700>if</span> (<span style=color:#555>!</span>attachment.has_value()) <span style=color:#069;font-weight:700>return</span>;
</span></span><span style=display:flex><span>  <span style=color:#09f;font-style:italic>// we expect attachment in the form of key-value pairs
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic></span>  <span style=color:#069;font-weight:700>auto</span> attachment_deserialized <span style=color:#555>=</span> attachment<span style=color:#555>-&gt;</span>get().deserialize<span style=color:#555>&lt;</span>std<span style=color:#555>::</span>unordered_map<span style=color:#555>&lt;</span>std<span style=color:#555>::</span>string, std<span style=color:#555>::</span>string<span style=color:#555>&gt;&gt;</span>();
</span></span><span style=display:flex><span>  <span style=color:#069;font-weight:700>for</span> (<span style=color:#069;font-weight:700>auto</span><span style=color:#555>&amp;&amp;</span> [key, value]<span style=color:#555>:</span> attachment) {
</span></span><span style=display:flex><span>    std<span style=color:#555>::</span>cout <span style=color:#555>&lt;&lt;</span> <span style=color:#c30>&#34;   attachment: &#34;</span> <span style=color:#555>&lt;&lt;</span> key <span style=color:#555>&lt;&lt;</span> <span style=color:#c30>&#34;: &#39;&#34;</span> <span style=color:#555>&lt;&lt;</span> value <span style=color:#555>&lt;&lt;</span> <span style=color:#c30>&#34;&#39;</span><span style=color:#c30;font-weight:700>\n</span><span style=color:#c30>&#34;</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><h1 id=optional-parameters>Optional Parameters</h1><p>Handling for optional parameters for Zenoh functions was simplified. There are no more getters/setters and all fields of option structures are public. Also option arguments are automatically set to their default values, and if your compiler has support for designated initializers, it is sufficient to only set the fields that are needed to be different from default ones.</p><p>In version 0.11.0:</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span>GetOptions opts;
</span></span><span style=display:flex><span>opts.set_target(Z_QUERY_TARGET_ALL);
</span></span><span style=display:flex><span>opts.set_value(value);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>session.get(keyexpr, <span style=color:#c30>&#34;&#34;</span>, {on_reply, on_done}, opts);
</span></span></code></pre></div><p>In 1.0.0:</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span>session.get(keyexpr, <span style=color:#c30>&#34;&#34;</span>, on_reply, on_done, {.target <span style=color:#555>=</span> Z_QUERY_TARGET_ALL, .payload <span style=color:#555>=</span> Bytes<span style=color:#555>::</span>serialize(value)});
</span></span></code></pre></div><div class=ato-next><b>Next up</b>: <a href=/docs/migration_1.0/c_pico/>C / Pico</a></div></main></div></div><footer class="ato-footer text-muted"><div class="container-fluid p-6 p-md-5"><div class=row><div class=col-md-2><h5>Eclipse Incubation</h5><p><img src=../../../img/eclipse-incubation.png style=width:100px></p><p>Eclipse zenoh &trade; is an incubating project under the Eclipse Foundation.</p></div><div class=col-md-2><h5>More Information</h5><p><a href=https://www.eclipse.org/legal target=_blank>Legal</a></p><p><a href=https://www.eclipse.org/legal/privacy.php target=_blank>Privacy policy</a></p><p><a href=https://www.eclipse.org/legal/termsofuse.php target=_blank>Terms of use</a></p><p><a href=https://www.eclipse.org/legal/copyright.php target=_blank>Copyright</a></p><p><a href=https://www.eclipse.org/security/ target=_blank>Report a security issue</a></p><p><a href=https://www.eclipse.org/legal/epl-2.0/ target=_blank>Eclipse Public License 2.0</a></p><p><a href=https://www.apache.org/licenses/LICENSE-2.0 target=_blank>Apache License 2.0</a></p><p><a href=https://www.eclipse.org/ target=_blank>Eclipse Foundation</a></p></div><div class=col-md-2><h5>Sponsored by:</h5><p><a href=https://www.eclipse.org target=_blank><img src=../../../img/eclipse-foundation.svg style=width:120px></a></p><p><a href=https://zettascale.tech target=_blank><img src=../../../img/zettascale-dark.svg style=width:120px></a></p></div><div class=col-md-2><h5>Follow us</h5><p><a href=https://github.com/eclipse-zenoh/zenoh><i class="fa fa-github" aria-hidden=true></i>
GitHub</a></p><p><a href=https://discord.gg/vSDSpqnbkm><i class="fa fa fa-comments-o" aria-hidden=true></i>
Discord</a></p><p><a href=https://www.youtube.com/channel/UCslbiyiqgOAPMjCrPWIfQ5Q><i class="fa fa-youtube-play" aria-hidden=true></i> Youtube</a></p><p><a href=../../../docs/overview/what-is-zenoh><i class="fa fa-info-circle" aria-hidden=true></i> About</a></p></div><div class=col-md-2><p><img src=../../../img/zenoh-dragon-150x163.png style=width:45px></p><p>Eclipse zenoh &trade; is free, open source and always will be.</p><p>Copyright &copy 2022 Eclipse Foundation</p><p>Built with <a href=https://gohugo.io/ target=_blank>HUGO</a></p></div></div></div></footer><script src=https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js integrity=sha384-3ceskX3iaEnIogmQchP8opvBy3Mi7Ce34nWjpBIwVTHfGYWQS9jwHDVRnpKKHJg7 crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/tether/1.3.7/js/tether.min.js integrity=sha384-XTs3FgkjiBgo8qjEjBk0tGmf3wPrWtA6coPfQDfFEY8AnYJwjalXCiosYRBIBZX8 crossorigin=anonymous></script>
<script src=../../../js/bootstrap.min.js></script>
<script src=../../../js/highlight.min.js></script>
<script>$(function(){$("pre code").each(function(e,t){if(t.className.indexOf("language-rust")>=0){for(var s="",n=t.textContent.split(`
`),e=0;e<n.length;e++){if(n[e].indexOf("# ")==0||n[e]=="#")continue;s+=n[e].trimRight()+`
`}t.textContent=s.replace(/\n\n\n/g,`

`).trimRight()}hljs.highlightBlock(t)})})</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-PBD6MS51QL"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-PBD6MS51QL",{anonymize_ip:!1})}</script></body></html>